function getStackTrace(a){var b=[];try{throw 1==arguments.length?a:new Error}catch(a){a.stack&&(b=(a.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n"),b.shift())}for(var c=0;c<b.length;++c)""===b[c]&&(b.splice(c,1),--c);return b}var osg={};osg.version="0.8.0",osg.copyright="Cedric Pinson - cedric.pinson@plopbyte.com",osg.DEBUG=0,osg.INFO=1,osg.NOTICE=2,osg.WARN=3,osg.ERROR=4,osg.setNotifyLevel=function(a){var b=function(a){void 0!==window.console&&window.console.log(a,getStackTrace())},c=function(a){void 0!==window.console&&window.console.info(a,getStackTrace())},d=function(a){void 0!==window.console&&window.console.warn(a,getStackTrace())},e=function(a){void 0!==window.console&&window.console.error(a,getStackTrace())},f=function(a){void 0!==window.console&&window.console.debug(a,getStackTrace())},g=function(){};osg.debug=g,osg.info=g,osg.log=g,osg.warn=g,osg.error=g,a<=osg.DEBUG&&(osg.debug=f),a<=osg.INFO&&(osg.info=c),a<=osg.NOTICE&&(osg.log=b),a<=osg.WARN&&(osg.warn=d),a<=osg.ERROR&&(osg.error=e)},osg.setNotifyLevel(osg.NOTICE),osg.reportWebGLError=!1,osg.memoryPools={},osg.init=function(){osg.memoryPools.stateGraph=new OsgObjectMemoryPool(osg.StateGraph).grow(50)},osg.isArray=function(a){return"[object Array]"===toString.call(a)},osg.extend=function(){var a,b,c,d,e=Object.prototype.toString,f=Object.prototype.hasOwnProperty,g=function(a){return"[object Function]"===e.call(a)},h=osg.isArray,i=function(a){if(!a||"[object Object]"!==e.call(a)||a.nodeType||a.setInterval)return!1;if(a.constructor&&!f.call(a,"constructor")&&!f.call(a.constructor.prototype,"isPrototypeOf"))return!1;var b;for(b in a);return void 0===b||f.call(a,b)},j=arguments[0]||{},k=1,l=arguments.length,m=!1;for("boolean"==typeof j&&(m=j,j=arguments[1]||{},k=2),"object"==typeof j||g(j)||(j={}),l===k&&(j=this,--k);l>k;k++)if(null!==(a=arguments[k]))for(b in a)if(c=j[b],d=a[b],j!==d)if(m&&d&&(i(d)||h(d))){var n=c&&(i(c)||h(c))?c:h(d)?[]:{};j[b]=osg.extend(m,n,d)}else void 0!==d&&(j[b]=d);return j},osg.objectInehrit=osg.objectInherit=function(a){function b(){}b.prototype=a;for(var c=new b,d=1;d<arguments.length;d++)osg.objectMix(c,arguments[d],!1);return c},osg.objectMix=function(a,b,c){for(var d in b)c&&a[d]||(a[d]=b[d]);return a},osg.objectLibraryClass=function(a,b,c){a.className=function(){return c},a.libraryName=function(){return b};var d=b+"::"+c;return a.libraryClassName=function(){return d},a},osg.objectType={},osg.objectType.type=0,osg.objectType.generate=function(a){var b=osg.objectType.type;return osg.objectType[b]=a,osg.objectType[a]=b,osg.objectType.type+=1,b},osg.Float32Array="undefined"!=typeof Float32Array?Float32Array:null,osg.Int32Array="undefined"!=typeof Int32Array?Int32Array:null,osg.Uint16Array="undefined"!=typeof Uint16Array?Uint16Array:null,osg.Vec2={copy:function(a,b){return b[0]=a[0],b[1]=a[1],b},valid:function(a){return isNaN(a[0])?!1:isNaN(a[1])?!1:!0},mult:function(a,b,c){return c[0]=a[0]*b,c[1]=a[1]*b,c},length2:function(a){return a[0]*a[0]+a[1]*a[1]},length:function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},distance:function(a,b){var c=a[0]-b[0],d=a[1]-b[1];return Math.sqrt(c*c+d*d)},normalize:function(a,b){var c=this.length2(a);if(c>0){var d=1/Math.sqrt(c);b[0]=a[0]*d,b[1]=a[1]*d}else b[0]=a[0],b[1]=a[1];return b},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},sub:function(a,b,c){return c[0]=a[0]-b[0],c[1]=a[1]-b[1],c},add:function(a,b,c){return c[0]=a[0]+b[0],c[1]=a[1]+b[1],c},neg:function(a,b){return b[0]=-a[0],b[1]=-a[1],b},lerp:function(a,b,c,d){var e=1-a;return d[0]=b[0]*e+a*c[0],d[1]=b[1]*e+a*c[1],d}},osg.Vec3={init:function(a){return a[0]=0,a[1]=0,a[2]=0,a},copy:function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},cross:function(a,b,c){var d=a[1]*b[2]-a[2]*b[1],e=a[2]*b[0]-a[0]*b[2],f=a[0]*b[1]-a[1]*b[0];return c[0]=d,c[1]=e,c[2]=f,c},valid:function(a){return isNaN(a[0])?!1:isNaN(a[1])?!1:isNaN(a[2])?!1:!0},mult:function(a,b,c){return c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b,c},length2:function(a){return a[0]*a[0]+a[1]*a[1]+a[2]*a[2]},length:function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},distance:function(a,b){var c=a[0]-b[0],d=a[1]-b[1],e=a[2]-b[2];return Math.sqrt(c*c+d*d+e*e)},normalize:function(a,b){var c=this.length2(a);if(c>0){var d=1/Math.sqrt(c);b[0]=a[0]*d,b[1]=a[1]*d,b[2]=a[2]*d}else b[0]=a[0],b[1]=a[1],b[2]=a[2];return b},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},sub:function(a,b,c){return c[0]=a[0]-b[0],c[1]=a[1]-b[1],c[2]=a[2]-b[2],c},add:function(a,b,c){return c[0]=a[0]+b[0],c[1]=a[1]+b[1],c[2]=a[2]+b[2],c},neg:function(a,b){return b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b},lerp:function(a,b,c,d){return d[0]=b[0]+(c[0]-b[0])*a,d[1]=b[1]+(c[1]-b[1])*a,d[2]=b[2]+(c[2]-b[2])*a,d}},osg.Vec4={dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},copy:function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},sub:function(a,b,c){return c[0]=a[0]-b[0],c[1]=a[1]-b[1],c[2]=a[2]-b[2],c[3]=a[3]-b[3],c},mult:function(a,b){return r[0]=a[0]*b,r[1]=a[1]*b,r[2]=a[2]*b,r[3]=a[3]*b,r},add:function(a,b,c){return c[0]=a[0]+b[0],c[1]=a[1]+b[1],c[2]=a[2]+b[2],c[3]=a[3]+b[3],c},neg:function(a,b){return b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=-a[3],b},lerp:function(a,b,c,d){var e=1-a;return d[0]=b[0]*e+a*c[0],d[1]=b[1]*e+a*c[1],d[2]=b[2]*e+a*c[2],d[3]=b[3]*e+a*c[3],d}},osg.Object=function(){this._name=void 0,this._userdata=void 0},osg.Object.prototype=osg.objectLibraryClass({setName:function(a){this._name=a},getName:function(){return this._name},setUserData:function(a){this._userdata=a},getUserData:function(){return this._userdata}},"osg","Object"),osg.Matrix={_tmp0:[],_tmp1:[],valid:function(a){for(var b=0;16>b;b++)if(isNaN(a[b]))return!1;return!0},setRow:function(a,b,c,d,e,f){var g=4*b;a[g+0]=c,a[g+1]=d,a[g+2]=e,a[g+3]=f},innerProduct:function(a,b,c,d){var e=4*c;return a[e+0]*b[0+d]+a[e+1]*b[4+d]+a[e+2]*b[8+d]+a[e+3]*b[12+d]},set:function(a,b,c,d){return a[4*b+c]=d,d},get:function(a,b,c){return a[4*b+c]},makeIdentity:function(a){return void 0===a&&(a=[],osg.log("osg.Matrix.makeIdentity without matrix destination is deprecated")),osg.Matrix.setRow(a,0,1,0,0,0),osg.Matrix.setRow(a,1,0,1,0,0),osg.Matrix.setRow(a,2,0,0,1,0),osg.Matrix.setRow(a,3,0,0,0,1),a},makeTranslate:function(a,b,c,d){return void 0===d&&(d=[]),osg.Matrix.setRow(d,0,1,0,0,0),osg.Matrix.setRow(d,1,0,1,0,0),osg.Matrix.setRow(d,2,0,0,1,0),osg.Matrix.setRow(d,3,a,b,c,1),d},setTrans:function(a,b,c,d){return a[12]=b,a[13]=c,a[14]=d,a},getTrans:function(a,b){return b[0]=a[12],b[1]=a[13],b[2]=a[14],b},preMult:function(a,b){var c,d,e,f;return c=b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12],d=b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12],e=b[8]*a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12],f=b[12]*a[0]+b[13]*a[4]+b[14]*a[8]+b[15]*a[12],a[0]=c,a[4]=d,a[8]=e,a[12]=f,c=b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13],d=b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13],e=b[8]*a[1]+b[9]*a[5]+b[10]*a[9]+b[11]*a[13],f=b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13],a[1]=c,a[5]=d,a[9]=e,a[13]=f,c=b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14],d=b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14],e=b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14],f=b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14],a[2]=c,a[6]=d,a[10]=e,a[14]=f,c=b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15],d=b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15],e=b[8]*a[3]+b[9]*a[7]+b[10]*a[11]+b[11]*a[15],f=b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15],a[3]=c,a[7]=d,a[11]=e,a[15]=f,a},postMult:function(a,b){return btmp0=b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12],btmp1=b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13],btmp2=b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14],btmp3=b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15],b[0]=btmp0,b[1]=btmp1,b[2]=btmp2,b[3]=btmp3,btmp0=b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12],btmp1=b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13],btmp2=b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14],btmp3=b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15],b[4]=btmp0,b[5]=btmp1,b[6]=btmp2,b[7]=btmp3,btmp0=b[8]*a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12],btmp1=b[8]*a[1]+b[9]*a[5]+b[10]*a[9]+b[11]*a[13],btmp2=b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14],btmp3=b[8]*a[3]+b[9]*a[7]+b[10]*a[11]+b[11]*a[15],b[8]=btmp0,b[9]=btmp1,b[10]=btmp2,b[11]=btmp3,btmp0=b[12]*a[0]+b[13]*a[4]+b[14]*a[8]+b[15]*a[12],btmp1=b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13],btmp2=b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14],btmp3=b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15],b[12]=btmp0,b[13]=btmp1,b[14]=btmp2,b[15]=btmp3,b},multa:function(a,b,c){return c===a?this.preMult(a,b):c===b?this.postMult(a,b):(void 0===c&&(c=[]),c[0]=b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12],c[1]=b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13],c[2]=b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14],c[3]=b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15],c[4]=b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12],c[5]=b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13],c[6]=b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14],c[7]=b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15],c[8]=b[8]*a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12],c[9]=b[8]*a[1]+b[9]*a[5]+b[10]*a[9]+b[11]*a[13],c[10]=b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14],c[11]=b[8]*a[3]+b[9]*a[7]+b[10]*a[11]+b[11]*a[15],c[12]=b[12]*a[0]+b[13]*a[4]+b[14]*a[8]+b[15]*a[12],c[13]=b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13],c[14]=b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14],c[15]=b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15],c)},mult:function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=a[0],u=a[1],v=a[2],w=a[3],x=a[4],y=a[5],z=a[6],A=a[7],B=a[8],C=a[9],D=a[10],E=a[11],F=a[12],G=a[13],H=a[14],I=a[15];return c[0]=d*t+e*x+f*B+g*F,c[1]=d*u+e*y+f*C+g*G,c[2]=d*v+e*z+f*D+g*H,c[3]=d*w+e*A+f*E+g*I,c[4]=h*t+i*x+j*B+k*F,c[5]=h*u+i*y+j*C+k*G,c[6]=h*v+i*z+j*D+k*H,c[7]=h*w+i*A+j*E+k*I,c[8]=l*t+m*x+n*B+o*F,c[9]=l*u+m*y+n*C+o*G,c[10]=l*v+m*z+n*D+o*H,c[11]=l*w+m*A+n*E+o*I,c[12]=p*t+q*x+r*B+s*F,c[13]=p*u+q*y+r*C+s*G,c[14]=p*v+q*z+r*D+s*H,c[15]=p*w+q*A+r*E+s*I,c},multOrig:function(a,b,c){var d;if(c===a){d=[];for(var e=0;4>e;e++)d[0]=osg.Matrix.innerProduct(b,a,0,e),d[1]=osg.Matrix.innerProduct(b,a,1,e),d[2]=osg.Matrix.innerProduct(b,a,2,e),d[3]=osg.Matrix.innerProduct(b,a,3,e),a[0+e]=d[0],a[4+e]=d[1],a[8+e]=d[2],a[12+e]=d[3];return a}if(c===b){d=[];for(var f=0;4>f;f++)d[0]=osg.Matrix.innerProduct(b,a,f,0),d[1]=osg.Matrix.innerProduct(b,a,f,1),d[2]=osg.Matrix.innerProduct(b,a,f,2),d[3]=osg.Matrix.innerProduct(b,a,f,3),this.setRow(b,f,d[0],d[1],d[2],d[3]);return b}void 0===c&&(c=[]);var g=b[0],h=b[1],i=b[2],j=b[3],k=b[4],l=b[5],m=b[6],n=b[7],o=b[8],p=b[9],q=b[10],r=b[11],s=b[12],t=b[13],u=b[14],v=b[15],w=a[0],x=a[1],y=a[2],z=a[3],A=a[4],B=a[5],C=a[6],D=a[7],E=a[8],F=a[9],G=a[10],H=a[11],I=a[12],J=a[13],K=a[14],L=a[15];return c[0]=g*w+h*A+i*E+j*I,c[1]=g*x+h*B+i*F+j*J,c[2]=g*y+h*C+i*G+j*K,c[3]=g*z+h*D+i*H+j*L,c[4]=k*w+l*A+m*E+n*I,c[5]=k*x+l*B+m*F+n*J,c[6]=k*y+l*C+m*G+n*K,c[7]=k*z+l*D+m*H+n*L,c[8]=o*w+p*A+q*E+r*I,c[9]=o*x+p*B+q*F+r*J,c[10]=o*y+p*C+q*G+r*K,c[11]=o*z+p*D+q*H+r*L,c[12]=s*w+t*A+u*E+v*I,c[13]=s*x+t*B+u*F+v*J,c[14]=s*y+t*C+u*G+v*K,c[15]=s*z+t*D+u*H+v*L,c},makeLookAt:function(a,b,c,d){void 0===d&&(d=[]);var e=osg.Vec3.sub(b,a,[]);osg.Vec3.normalize(e,e);var f=osg.Vec3.cross(e,c,[]);osg.Vec3.normalize(f,f);var g=osg.Vec3.cross(f,e,[]);return osg.Vec3.normalize(g,g),d[0]=f[0],d[1]=g[0],d[2]=-e[0],d[3]=0,d[4]=f[1],d[5]=g[1],d[6]=-e[1],d[7]=0,d[8]=f[2],d[9]=g[2],d[10]=-e[2],d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,osg.Matrix.multTranslate(d,osg.Vec3.neg(a,[]),d),d},makeOrtho:function(a,b,c,d,e,f,g){void 0===g&&(g=[]);var h=-(b+a)/(b-a),i=-(d+c)/(d-c),j=-(f+e)/(f-e),k=osg.Matrix.setRow;return k(g,0,2/(b-a),0,0,0),k(g,1,0,2/(d-c),0,0),k(g,2,0,0,-2/(f-e),0),k(g,3,h,i,j,1),g},getLookAt:function(a,b,c,d,e){void 0===e&&(e=1);var f=[],g=osg.Matrix.inverse(a,f);g||osg.Matrix.makeIdentity(f),osg.Matrix.transformVec3(f,[0,0,0],b),osg.Matrix.transform3x3(a,[0,1,0],d),osg.Matrix.transform3x3(a,[0,0,-1],c),osg.Vec3.normalize(c,c),osg.Vec3.add(osg.Vec3.mult(c,e,[]),b,c)},getRotate:function(a,b){void 0===b&&(b=[]);var c,d,e,f=[],g=a[0],h=a[5],i=a[10];for(f[0]=1+g+h+i,f[1]=1+g-h-i,f[2]=1-g+h-i,f[3]=1-g-h+i,e=0,d=1;4>d;d++)e=f[d]>f[e]?d:e;return 0===e?(b[3]=f[0],b[0]=a[6]-a[9],b[1]=a[8]-a[2],b[2]=a[1]-a[4]):1==e?(b[3]=a[6]-a[9],b[0]=f[1],b[1]=a[1]+a[4],b[2]=a[8]+a[2]):2==e?(b[3]=a[8]-a[2],b[0]=a[1]+a[4],b[1]=f[2],b[2]=a[6]+a[9]):(b[3]=a[1]-a[4],b[0]=a[8]+a[2],b[1]=a[6]+a[9],b[2]=f[3]),c=Math.sqrt(.25/f[e]),b[3]*=c,b[0]*=c,b[1]*=c,b[2]*=c,b},preMultTranslate:function(a,b){return 0!==b[0]&&(val=b[0],a[12]+=val*a[0],a[13]+=val*a[1],a[14]+=val*a[2],a[15]+=val*a[3]),0!==b[1]&&(val=b[1],a[12]+=val*a[4],a[13]+=val*a[5],a[14]+=val*a[6],a[15]+=val*a[7]),0!==b[2]&&(val=b[2],a[12]+=val*a[8],a[13]+=val*a[9],a[14]+=val*a[10],a[15]+=val*a[11]),a},multTranslate:function(a,b,c){void 0===c&&(c=[]),c!==a&&osg.Matrix.copy(a,c);var d;return 0!==b[0]&&(d=b[0],c[12]+=d*a[0],c[13]+=d*a[1],c[14]+=d*a[2],c[15]+=d*a[3]),0!==b[1]&&(d=b[1],c[12]+=d*a[4],c[13]+=d*a[5],c[14]+=d*a[6],c[15]+=d*a[7]),0!==b[2]&&(d=b[2],c[12]+=d*a[8],c[13]+=d*a[9],c[14]+=d*a[10],c[15]+=d*a[11]),c},makeRotate:function(a,b,c,d,e){void 0===e&&(osg.log("osg.makeRotate without given matrix destination is deprecated"),e=[]);var f=Math.sqrt(b*b+c*c+d*d),g=Math.sin(a),h=Math.cos(a);if(f>0){var i,j,k,l,m,n,o,p,q,r;return f=1/f,b*=f,c*=f,d*=f,i=b*b,j=c*c,k=d*d,l=b*c,m=c*d,n=d*b,o=b*g,p=c*g,q=d*g,r=1-h,e[0]=r*i+h,e[1]=r*l-q,e[2]=r*n+p,e[3]=0,e[4]=r*l+q,e[5]=r*j+h,e[6]=r*m-o,e[7]=0,e[8]=r*n-p,e[9]=r*m+o,e[10]=r*k+h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}return osg.Matrix.makeIdentity(e)},transform3x3:function(a,b,c){return void 0===c&&(c=[]),c[0]=a[0]*b[0]+a[1]*b[1]+a[2]*b[2],c[1]=a[4]*b[0]+a[5]*b[1]+a[6]*b[2],c[2]=a[8]*b[0]+a[9]*b[1]+a[10]*b[2],c},transformVec3:function(a,b,c){var d=1/(a[3]*b[0]+a[7]*b[1]+a[11]*b[2]+a[15]);void 0===c&&(osg.warn("deprecated, osg.Matrix.transformVec3 needs a third parameter as result"),c=[]);var e;return e=c===b?[]:c,e[0]=(a[0]*b[0]+a[4]*b[1]+a[8]*b[2]+a[12])*d,e[1]=(a[1]*b[0]+a[5]*b[1]+a[9]*b[2]+a[13])*d,e[2]=(a[2]*b[0]+a[6]*b[1]+a[10]*b[2]+a[14])*d,c===b&&osg.Vec3.copy(e,c),c},transformVec4:function(a,b,c){void 0===c&&(c=[]);var d;return d=c===b?[]:c,d[0]=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],d[1]=a[4]*b[0]+a[5]*b[1]+a[6]*b[2]+a[7]*b[3],d[2]=a[8]*b[0]+a[9]*b[1]+a[10]*b[2]+a[11]*b[3],d[3]=a[12]*b[0]+a[13]*b[1]+a[14]*b[2]+a[15]*b[3],c===b&&osg.Vec4.copy(d,c),c},copy:function(a,b){return void 0===b&&(b=[]),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},inverse:function(a,b){return b===a&&(osg.Matrix.copy(a,osg.Matrix._tmp1),a=osg.Matrix._tmp1),0===a[3]&&0===a[7]&&0===a[11]&&1===a[15]?this.inverse4x3(a,b):this.inverse4x4(a,b)},inverse4x4:function(a,b){var c=a[10]*a[15],d=a[14]*a[11],e=a[6]*a[15],f=a[14]*a[7],g=a[6]*a[11],h=a[10]*a[7],i=a[2]*a[15],j=a[14]*a[3],k=a[2]*a[11],l=a[10]*a[3],m=a[2]*a[7],n=a[6]*a[3],o=a[8]*a[13],p=a[12]*a[9],q=a[4]*a[13],r=a[12]*a[5],s=a[4]*a[9],t=a[8]*a[5],u=a[0]*a[13],v=a[12]*a[1],w=a[0]*a[9],x=a[8]*a[1],y=a[0]*a[5],z=a[4]*a[1],A=c*a[5]+f*a[9]+g*a[13]-(d*a[5]+e*a[9]+h*a[13]),B=d*a[1]+i*a[9]+l*a[13]-(c*a[1]+j*a[9]+k*a[13]),C=e*a[1]+j*a[5]+m*a[13]-(f*a[1]+i*a[5]+n*a[13]),D=h*a[1]+k*a[5]+n*a[9]-(g*a[1]+l*a[5]+m*a[9]),E=a[0]*A+a[4]*B+a[8]*C+a[12]*D;if(Math.abs(E)<1e-5)return osg.log("Warning can't inverse matrix "+a),!1;var F=1/E,G=F*A,H=F*B,I=F*C,J=F*D,K=F*(d*a[4]+e*a[8]+h*a[12]-(c*a[4]+f*a[8]+g*a[12])),L=F*(c*a[0]+j*a[8]+k*a[12]-(d*a[0]+i*a[8]+l*a[12])),M=F*(f*a[0]+i*a[4]+n*a[12]-(e*a[0]+j*a[4]+m*a[12])),N=F*(g*a[0]+l*a[4]+m*a[8]-(h*a[0]+k*a[4]+n*a[8])),O=F*(o*a[7]+r*a[11]+s*a[15]-(p*a[7]+q*a[11]+t*a[15])),P=F*(p*a[3]+u*a[11]+x*a[15]-(o*a[3]+v*a[11]+w*a[15])),Q=F*(q*a[3]+v*a[7]+y*a[15]-(r*a[3]+u*a[7]+z*a[15])),R=F*(t*a[3]+w*a[7]+z*a[11]-(s*a[3]+x*a[7]+y*a[11])),S=F*(q*a[10]+t*a[14]+p*a[6]-(s*a[14]+o*a[6]+r*a[10])),T=F*(w*a[14]+o*a[2]+v*a[10]-(u*a[10]+x*a[14]+p*a[2])),U=F*(u*a[6]+z*a[14]+r*a[2]-(y*a[14]+q*a[2]+v*a[6])),V=F*(y*a[10]+s*a[2]+x*a[6]-(w*a[6]+z*a[10]+t*a[2]));return b[0]=G,b[1]=H,b[2]=I,b[3]=J,b[4]=K,b[5]=L,b[6]=M,b[7]=N,b[8]=O,b[9]=P,b[10]=Q,b[11]=R,b[12]=S,b[13]=T,b[14]=U,b[15]=V,!0},inverse4x3:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],h=a[6],i=a[8],j=a[9],k=a[10];b[0]=g*k-h*j,b[1]=e*j-d*k,b[2]=d*h-e*g;var l=1/(c*b[0]+f*b[1]+i*b[2]);c*=l,f*=l,i*=l,b[0]*=l,b[1]*=l,b[2]*=l,b[3]=0,b[4]=h*i-f*k,b[5]=c*k-e*i,b[6]=e*f-c*h,b[7]=0,b[8]=f*j-g*i,b[9]=d*i-c*j,b[10]=c*g-d*f,b[11]=0,b[15]=1;var m,n,o,p=a[15],q=p-1;if(q*q>1e-6){var r=osg.Matrix._tmp0;b[12]=b[13]=b[14]=0;var s=a[3],t=a[7],u=a[11],v=b[0]*s+b[1]*t+b[2]*u,w=b[4]*s+b[5]*t+b[6]*u,x=b[8]*s+b[9]*t+b[10]*u;m=a[12],n=a[13],o=a[14];var y=1/(p-(m*v+n*w+o*x));m*=y,n*=y,o*=y,r[0]=m*v+1,r[1]=n*v,r[2]=o*v,r[3]=-v*y,r[4]=m*w,r[5]=n*w+1,r[6]=o*w,r[7]=-w*y,r[8]=m*x,r[9]=n*x,r[10]=o*x+1,r[11]=-x*y,r[12]=-m,r[13]=-n,r[14]=-o,r[15]=y,osg.Matrix.preMult(b,r)}else m=a[12],n=a[13],o=a[14],b[12]=-(m*b[0]+n*b[4]+o*b[8]),b[13]=-(m*b[1]+n*b[5]+o*b[9]),b[14]=-(m*b[2]+n*b[6]+o*b[10]);return!0},transpose:function(a,b){if(a===b){var c=a[1],d=a[2],e=a[3],f=a[6],g=a[7],h=a[11];return a[1]=a[4],a[2]=a[8],a[3]=a[12],a[4]=c,a[6]=a[9],a[7]=a[13],a[8]=d,a[9]=f,a[11]=a[14],a[12]=e,a[13]=g,a[14]=h,a}return b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15],b},makePerspective:function(a,b,c,d,e){void 0===e&&(e=[]);var f=c*Math.tan(a*Math.PI/360),g=-f,h=g*b,i=f*b;return osg.Matrix.makeFrustum(h,i,g,f,c,d,e)},getFrustum:function(a,b){var c=0,d=0,e=0,f=0;if(0!==a[3]||0!==a[7]||-1!==a[11]||0!==a[15])return!1;var g=a[14]/(a[10]-1),h=a[14]/(1+a[10]);return d=g*(a[8]-1)/a[0],c=g*(1+a[8])/a[0],e=g*(1+a[9])/a[5],f=g*(a[9]-1)/a[5],zNear=g,zFar=h,b.left=d,b.right=c,b.top=e,b.bottom=f,b.zNear=zNear,b.zFar=zFar,!0},getPerspective:function(a,b){var c={right:0,left:0,top:0,bottom:0,zNear:0,zFar:0},d=this.getFrustum(a,c);return d&&(b.fovy=180/Math.PI*(Math.atan(c.top/c.zNear)-Math.atan(c.bottom/c.zNear)),b.aspectRatio=(c.right-c.left)/(c.top-c.bottom)),b.zNear=c.zNear,b.zFar=c.zFar,b},makeScale:function(a,b,c,d){return void 0===d&&(d=[]),this.setRow(d,0,a,0,0,0),this.setRow(d,1,0,b,0,0),this.setRow(d,2,0,0,c,0),this.setRow(d,3,0,0,0,1),d},computeFrustrumCornersVectors:function(a,b){a[14]/(a[10]-1),a[14]/(a[10]+1);var c=1/a[0],d=1/a[5];return b[0]=[-c,d,1],b[1]=[-c,-d,1],b[2]=[c,-d,1],b[3]=[c,d,1],b},makeFrustum:function(a,b,c,d,e,f,g){void 0===g&&(g=[]);var h=2*e/(b-a),i=2*e/(d-c),j=(b+a)/(b-a),k=(d+c)/(d-c),l=-(f+e)/(f-e),m=-2*f*e/(f-e);return this.setRow(g,0,h,0,0,0),this.setRow(g,1,0,i,0,0),this.setRow(g,2,j,k,l,-1),this.setRow(g,3,0,0,m,0),g},makeRotateFromQuat:function(a,b){return this.makeIdentity(b),this.setRotateFromQuat(b,a)},setRotateFromQuat:function(a,b){var c=osg.Quat.length2(b);if(Math.abs(c)<=Number.MIN_VALUE)a[0]=0,a[1]=0,a[2]=0,a[4]=0,a[5]=0,a[6]=0,a[8]=0,a[9]=0,a[10]=0;else{var d;d=1!==c?2/c:2;var e,f,g,h,i,j,k,l,m,n,o,p;n=d*b[0],o=d*b[1],p=d*b[2],h=b[0]*n,k=b[0]*o,l=b[0]*p,i=b[1]*o,j=b[1]*p,m=b[2]*p,e=b[3]*n,f=b[3]*o,g=b[3]*p,a[0]=1-(i+m),a[4]=k-g,a[8]=l+f,a[1]=k+g,a[5]=1-(h+m),a[9]=j-e,a[2]=l-f,a[6]=j+e,a[10]=1-(h+i)}return a}},osg.ShaderGeneratorType={VertexInit:0,VertexFunction:1,VertexMain:2,VertexEnd:3,FragmentInit:5,FragmentFunction:6,FragmentMain:7,FragmentEnd:8},osg.Shader=function(a,b){var c=a;"string"==typeof a&&(c=osg.Shader[a]),this.type=c,this.setText(b)},osg.Shader.VERTEX_SHADER=35633,osg.Shader.FRAGMENT_SHADER=35632,osg.Shader.prototype={setText:function(a){this.text=a},getText:function(){return this.text},compile:function(){if(this.shader=gl.createShader(this.type),gl.shaderSource(this.shader,this.text),gl.compileShader(this.shader),!gl.getShaderParameter(this.shader,gl.COMPILE_STATUS)&&!gl.isContextLost()){osg.log("can't compile shader:\n"+this.text+"\n");for(var a="\n"+this.text,b=a.split("\n"),c="\n",d=0,e=b.length;e>d;++d)c+=d+" "+b[d]+"\n";osg.log(c),osg.log(gl.getShaderInfoLog(this.shader))}}},osg.Shader.create=function(a,b){return osg.log("osg.Shader.create is deprecated, use new osg.Shader with the same arguments instead"),new osg.Shader(a,b)},osg.StateAttribute=function(){osg.Object.call(this),this._dirty=!0},osg.StateAttribute.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Object.prototype,{isDirty:function(){return this._dirty},dirty:function(){this._dirty=!0},setDirty:function(a){this._dirty=a}}),"osg","StateAttribute"),osg.StateAttribute.OFF=0,osg.StateAttribute.ON=1,osg.StateAttribute.OVERRIDE=2,osg.StateAttribute.PROTECTED=4,osg.StateAttribute.INHERIT=8,osg.Uniform=function(){this.transpose=!1,this._dirty=!0,this.name="",this.type=void 0},osg.Uniform.isUniform=function(a){return a.prototype===osg.Uniform.prototype?!0:!1},osg.Uniform.prototype={getName:function(){return this.name},getType:function(){return this.type},get:function(){return this.data},set:function(a){this.data=a,this.dirty()},dirty:function(){this._dirty=!0},apply:function(a){this._dirty&&(this.update.call(this.glData,this.data),this._dirty=!1),this.glCall(a,this.glData)},applyMatrix:function(a){this._dirty&&(this.update.call(this.glData,this.data),this._dirty=!1),this.glCall(a,this.transpose,this.glData)},update:function(a){for(var b=0,c=a.length;c>b;++b)this[b]=a[b]},_updateArray:function(a){for(var b=0,c=a.length;c>b;++b)this[b]=a[b]},_updateFloat1:function(a){this[0]=a[0]},_updateFloat2:function(a){this[0]=a[0],this[1]=a[1]},_updateFloat3:function(a){this[0]=a[0],this[1]=a[1],this[2]=a[2]},_updateFloat4:function(a){this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]=a[3]},_updateFloat9:function(a){this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]=a[3],this[4]=a[4],this[5]=a[5],this[6]=a[6],this[7]=a[7],this[8]=a[8]},_updateFloat16:function(a){this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]=a[3],this[4]=a[4],this[5]=a[5],this[6]=a[6],this[7]=a[7],this[8]=a[8],this[9]=a[9],this[10]=a[10],this[11]=a[11],this[12]=a[12],this[13]=a[13],this[14]=a[14],this[15]=a[15]}},osg.Uniform.createFloat1=function(a,b){var c=a,d=b;void 0===d&&(d=c,c=[0]);var e=new osg.Uniform;return e.data=[c],e.glCall=function(a,b){gl.uniform1fv(a,b)},e.glData=new osg.Float32Array(e.data),e.update=osg.Uniform.prototype._updateFloat1,e.set=function(a){"number"==typeof a?this.data[0]=a:this.data=a,this.dirty()},e.name=d,e.type="float",e},osg.Uniform.createFloat=osg.Uniform.createFloat1,osg.Uniform["float"]=osg.Uniform.createFloat1,osg.Uniform.createFloatArray=function(a,b){var c=osg.Uniform.createFloat.call(this,a,b);return c.update=osg.Uniform.prototype._updateArray,c},osg.Uniform.createFloat2=function(a,b){var c=a,d=b;void 0===d&&(d=c,c=[0,0]);var e=new osg.Uniform;return e.data=c,e.glCall=function(a,b){gl.uniform2fv(a,b)},e.glData=new osg.Float32Array(e.data),e.update=osg.Uniform.prototype._updateFloat2,e.name=d,e.type="vec2",e},osg.Uniform.vec2=osg.Uniform.createFloat2,osg.Uniform.createFloat2Array=function(a,b){var c=osg.Uniform.createFloat2.call(this,a,b);return c.update=osg.Uniform.prototype._updateArray,c},osg.Uniform.createFloat3=function(a,b){var c=a,d=b;void 0===d&&(d=c,c=[0,0,0]);var e=new osg.Uniform;return e.data=c,e.glCall=function(a,b){gl.uniform3fv(a,b)},e.glData=new osg.Float32Array(e.data),e.update=osg.Uniform.prototype._updateFloat3,e.name=d,e.type="vec3",e},osg.Uniform.vec3=osg.Uniform.createFloat3,osg.Uniform.createFloat3Array=function(a,b){var c=osg.Uniform.createFloat3.call(this,a,b);return c.update=osg.Uniform.prototype._updateArray,c},osg.Uniform.createFloat4=function(a,b){var c=a,d=b;void 0===d&&(d=c,c=[0,0,0,0]);var e=new osg.Uniform;return e.data=c,e.glCall=function(a,b){gl.uniform4fv(a,b)},e.glData=new osg.Float32Array(e.data),e.update=osg.Uniform.prototype._updateFloat4,e.name=d,e.type="vec4",e},osg.Uniform.vec4=osg.Uniform.createFloat4,osg.Uniform.createFloat4Array=function(a,b){var c=osg.Uniform.createFloat4.call(this,a,b);return c.update=osg.Uniform.prototype._updateArray,c},osg.Uniform.createInt1=function(a,b){var c=a,d=b;void 0===d&&(d=c,c=[0]);var e=new osg.Uniform;return e.data=[c],e.glCall=function(a,b){gl.uniform1iv(a,b)},e.set=function(a){"number"==typeof a?this.data[0]=a:this.data=a,this.dirty()},e.glData=new osg.Int32Array(e.data),e.name=d,e.type="int",e},osg.Uniform["int"]=osg.Uniform.createInt1,osg.Uniform.createInt=osg.Uniform.createInt1,osg.Uniform.createIntArray=function(a,b){var c=osg.Uniform.createInt.call(this,a,b);return c.update=osg.Uniform.prototype._updateArray,c},osg.Uniform.createInt2=function(a,b){var c=a,d=b;void 0===d&&(d=c,c=[0,0]);var e=new osg.Uniform;return e.data=c,e.glCall=function(a,b){gl.uniform2iv(a,b)},e.glData=new osg.Int32Array(e.data),e.name=d,e.type="vec2i",e},osg.Uniform.vec2i=osg.Uniform.createInt2,osg.Uniform.createInt2Array=function(a,b){var c=osg.Uniform.createInt2.call(this,a,b);return c.update=osg.Uniform.prototype._updateArray,c},osg.Uniform.createInt3=function(a,b){var c=a,d=b;void 0===d&&(d=c,c=[0,0,0]);var e=new osg.Uniform;return e.data=c,e.glCall=function(a,b){gl.uniform3iv(a,b)},e.glData=new osg.Int32Array(e.data),e.name=d,e.type="vec3i",e},osg.Uniform.vec3i=osg.Uniform.createInt3,osg.Uniform.createInt3Array=function(a,b){var c=osg.Uniform.createInt3.call(this,a,b);return c.update=osg.Uniform.prototype._updateArray,c},osg.Uniform.createInt4=function(a,b){var c=a,d=b;void 0===d&&(d=c,c=[0,0,0,0]);var e=new osg.Uniform;return e.data=c,e.glCall=function(a,b){gl.uniform4iv(a,b)},e.glData=new osg.Int32Array(e.data),e.name=d,e.type="vec4i",e},osg.Uniform.vec4i=osg.Uniform.createInt4,osg.Uniform.createInt4Array=function(a,b){var c=osg.Uniform.createInt4.call(this,a,b);return c.update=osg.Uniform.prototype._updateArray,c},osg.Uniform.createMatrix2=function(a,b){var c=a,d=b;void 0===d&&(d=c,c=[1,0,0,1]);var e=new osg.Uniform;return e.data=c,e.glCall=function(a,b,c){gl.uniformMatrix2fv(a,b,c)},e.apply=e.applyMatrix,e.transpose=!1,e.glData=new osg.Float32Array(e.data),e.update=osg.Uniform.prototype._updateFloat4,e.name=d,e.type="mat2",e},osg.Uniform.createMat2=osg.Uniform.createMatrix2,osg.Uniform.mat2=osg.Uniform.createMat2,osg.Uniform.createMatrix3=function(a,b){var c=a,d=b;void 0===d&&(d=c,c=[1,0,0,0,1,0,0,0,1]);var e=new osg.Uniform;return e.data=c,e.glCall=function(a,b,c){gl.uniformMatrix3fv(a,b,c)},e.apply=e.applyMatrix,e.transpose=!1,e.glData=new osg.Float32Array(e.data),e.update=osg.Uniform.prototype._updateFloat9,e.name=d,e.type="mat3",e},osg.Uniform.createMat3=osg.Uniform.createMatrix3,osg.Uniform.mat3=osg.Uniform.createMatrix3,osg.Uniform.createMatrix4=function(a,b){var c=a,d=b;void 0===d&&(d=c,c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);var e=new osg.Uniform;return e.data=c,e.glCall=function(a,b,c){gl.uniformMatrix4fv(a,b,c)},e.apply=e.applyMatrix,e.transpose=!1,e.glData=new osg.Float32Array(e.data),e.update=osg.Uniform.prototype._updateFloat16,e.name=d,e.type="mat4",e},osg.Uniform.createMat4=osg.Uniform.createMatrix4,osg.Uniform.mat4=osg.Uniform.createMatrix4,osg.Node=function(){osg.Object.call(this),this.children=[],this.parents=[],this.nodeMask=-1,this.boundingSphere=new osg.BoundingSphere,this.boundingSphereComputed=!1,this._updateCallbacks=[],this._cullCallback=void 0},osg.Node.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Object.prototype,{getOrCreateStateSet:function(){return void 0===this.stateset&&(this.stateset=new osg.StateSet),this.stateset},getStateSet:function(){return this.stateset},accept:function(a){a.validNodeMask(this)&&(a.pushOntoNodePath(this),a.apply(this),a.popFromNodePath())},dirtyBound:function(){if(this.boundingSphereComputed===!0){this.boundingSphereComputed=!1;for(var a=0,b=this.parents.length;b>a;a++)this.parents[a].dirtyBound()}},setNodeMask:function(a){this.nodeMask=a},getNodeMask:function(){return this.nodeMask},setStateSet:function(a){this.stateset=a},setUpdateCallback:function(a){this._updateCallbacks[0]=a},getUpdateCallback:function(){return this._updateCallbacks[0]},addUpdateCallback:function(a){this._updateCallbacks.push(a)},removeUpdateCallback:function(a){var b=this._updateCallbacks.indexOf(a);-1!==b&&this._updateCallbacks.splice(b,1)},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(a){this._cullCallback=a},getCullCallback:function(){return this._cullCallback},hasChild:function(a){for(var b=0,c=this.children.length;c>b;b++)if(this.children[b]===a)return!0;return!1},addChild:function(a){var b=this.children.push(a);return a.addParent(this),this.dirtyBound(),b},getChildren:function(){return this.children},getParents:function(){return this.parents},addParent:function(a){this.parents.push(a)},removeParent:function(a){for(var b=0,c=this.parents.length,d=this.parents;c>b;b++)if(d[b]===a)return d.splice(b,1),void 0},removeChildren:function(){var a=this.children;if(0!==a.length){for(var b=0,c=a.length;c>b;b++)a[b].removeParent(this);this.children.splice(0,this.children.length),this.dirtyBound()}},removeChild:function(a){for(var b=0,c=this.children.length;c>b;b++)this.children[b]===a&&(a.removeParent(this),this.children.splice(b,1),this.dirtyBound())},traverse:function(a){for(var b=0,c=this.children.length;c>b;b++){var d=this.children[b];d.accept(a)}},ascend:function(a){for(var b=0,c=this.parents.length;c>b;b++){var d=this.parents[b];d.accept(a)}},getBound:function(){return this.boundingSphereComputed||(this.computeBound(this.boundingSphere),this.boundingSphereComputed=!0),this.boundingSphere},computeBound:function(a){var b=new osg.BoundingBox;b.init(),a.init();for(var c=0,d=this.children.length;d>c;c++){var e=this.children[c];(void 0===e.referenceFrame||e.referenceFrame===osg.Transform.RELATIVE_RF)&&b.expandBySphere(e.getBound())}if(!b.valid())return a;a._center=b.center(),a._radius=0;for(var f=0,g=this.children.length;g>f;f++){var h=this.children[f];(void 0===h.referenceFrame||h.referenceFrame===osg.Transform.RELATIVE_RF)&&a.expandRadiusBySphere(h.getBound())}return a},getWorldMatrices:function(a){var b=function(a){this.nodePaths=[],this.halt=a,osg.NodeVisitor.call(this,osg.NodeVisitor.TRAVERSE_PARENTS)};b.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{apply:function(a){0===a.parents.length||a===this.halt?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(a)}});var c=new b(a);this.accept(c);for(var d=[],e=0,f=c.nodePaths.length;f>e;e++){var g=c.nodePaths[e];0===g.length?d.push(osg.Matrix.makeIdentity([])):d.push(osg.computeLocalToWorld(g))}return d}}),"osg","Node"),osg.Node.prototype.objectType=osg.objectType.generate("Node"),osg.NodeVisitor=function(a){this.traversalMask=-1,this.nodeMaskOverride=0,this.traversalMode=a,void 0===a&&(this.traversalMode=osg.NodeVisitor.TRAVERSE_ALL_CHILDREN),this.nodePath=[]},osg.NodeVisitor.TRAVERSE_PARENTS=1,osg.NodeVisitor.TRAVERSE_ALL_CHILDREN=2,osg.NodeVisitor._traversalFunctions={},osg.NodeVisitor._traversalFunctions[osg.NodeVisitor.TRAVERSE_PARENTS]=function(a){a.ascend(this)},osg.NodeVisitor._traversalFunctions[osg.NodeVisitor.TRAVERSE_ALL_CHILDREN]=function(a){a.traverse(this)},osg.NodeVisitor._pushOntoNodePath={},osg.NodeVisitor._pushOntoNodePath[osg.NodeVisitor.TRAVERSE_PARENTS]=function(a){this.nodePath.unshift(a)},osg.NodeVisitor._pushOntoNodePath[osg.NodeVisitor.TRAVERSE_ALL_CHILDREN]=function(a){this.nodePath.push(a)},osg.NodeVisitor._popFromNodePath={},osg.NodeVisitor._popFromNodePath[osg.NodeVisitor.TRAVERSE_PARENTS]=function(){return this.nodePath.shift()},osg.NodeVisitor._popFromNodePath[osg.NodeVisitor.TRAVERSE_ALL_CHILDREN]=function(){this.nodePath.pop()},osg.NodeVisitor.prototype={setNodeMaskOverride:function(a){this.nodeMaskOverride=a},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(a){this.traversalMask=a},getTraversalMask:function(){return this.traversalMask},pushOntoNodePath:function(a){osg.NodeVisitor._pushOntoNodePath[this.traversalMode].call(this,a)},popFromNodePath:function(){osg.NodeVisitor._popFromNodePath[this.traversalMode].call(this)
},validNodeMask:function(a){var b=a.getNodeMask();return 0!==(this.traversalMask&(this.nodeMaskOverride|b))},apply:function(a){this.traverse(a)},traverse:function(a){osg.NodeVisitor._traversalFunctions[this.traversalMode].call(this,a)}},osg.Transform=function(){osg.Node.call(this),this.referenceFrame=osg.Transform.RELATIVE_RF},osg.Transform.RELATIVE_RF=0,osg.Transform.ABSOLUTE_RF=1,osg.Transform.prototype=osg.objectInehrit(osg.Node.prototype,{setReferenceFrame:function(a){this.referenceFrame=a},getReferenceFrame:function(){return this.referenceFrame},computeBound:function(a){if(osg.Node.prototype.computeBound.call(this,a),!a.valid())return a;var b=osg.Matrix.makeIdentity([]);this.computeLocalToWorldMatrix(b);var c=osg.Vec3.copy(a._center,[]);c[0]+=a._radius,osg.Matrix.transformVec3(b,c,c);var d=osg.Vec3.copy(a._center,[]);d[1]+=a._radius,osg.Matrix.transformVec3(b,d,d);var e=osg.Vec3.copy(a._center,[]);e[2]+=a._radius,osg.Matrix.transformVec3(b,e,e),osg.Matrix.transformVec3(b,a._center,a._center),osg.Vec3.sub(c,a._center,c);var f=osg.Vec3.length(c);osg.Vec3.sub(d,a._center,d);var g=osg.Vec3.length(d);osg.Vec3.sub(e,a._center,e);var h=osg.Vec3.length(e);return a._radius=f,a._radius<g&&(a._radius=g),a._radius<h&&(a._radius=h),a}}),osg.computeLocalToWorld=function(a,b){var c=b;void 0===c&&(c=!0);var d=osg.Matrix.makeIdentity([]),e=0;if(c)for(e=a.length-1;e>0;e--){var f=a[e];if(f.objectType===osg.Camera.prototype.objectType&&(f.getReferenceFrame!==osg.Transform.RELATIVE_RF||0===f.getParents().length))break}for(var g=e,h=a.length;h>g;g++){var i=a[g];i.computeLocalToWorldMatrix&&i.computeLocalToWorldMatrix(d)}return d},osg.MatrixTransform=function(){osg.Transform.call(this),this.matrix=osg.Matrix.makeIdentity([])},osg.MatrixTransform.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Transform.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(a){this.matrix=a},computeLocalToWorldMatrix:function(a){return this.referenceFrame===osg.Transform.RELATIVE_RF?osg.Matrix.preMult(a,this.matrix):a=this.matrix,!0},computeWorldToLocalMatrix:function(a){var b=[];return osg.Matrix.inverse(this.matrix,b),this.referenceFrame===osg.Transform.RELATIVE_RF?osg.Matrix.postMult(b,a):a=inverse,!0}}),"osg","MatrixTransform"),osg.MatrixTransform.prototype.objectType=osg.objectType.generate("MatrixTransform"),osg.BlendFunc=function(a,b,c,d){osg.StateAttribute.call(this),this._sourceFactor=osg.BlendFunc.ONE,this._destinationFactor=osg.BlendFunc.ZERO,this._sourceFactorAlpha=this._sourceFactor,this._destinationFactorAlpha=this._destinationFactor,this._separate=!1,void 0!==a&&this.setSource(a),void 0!==b&&this.setDestination(b),void 0!==c&&this.setSourceAlpha(c),void 0!==d&&this.setDestinationAlpha(d)},osg.BlendFunc.ZERO=0,osg.BlendFunc.ONE=1,osg.BlendFunc.SRC_COLOR=768,osg.BlendFunc.ONE_MINUS_SRC_COLOR=769,osg.BlendFunc.SRC_ALPHA=770,osg.BlendFunc.ONE_MINUS_SRC_ALPHA=771,osg.BlendFunc.DST_ALPHA=772,osg.BlendFunc.ONE_MINUS_DST_ALPHA=773,osg.BlendFunc.DST_COLOR=774,osg.BlendFunc.ONE_MINUS_DST_COLOR=775,osg.BlendFunc.SRC_ALPHA_SATURATE=776,osg.BlendFunc.BLEND_DST_RGB=32968,osg.BlendFunc.BLEND_SRC_RGB=32969,osg.BlendFunc.BLEND_DST_ALPHA=32970,osg.BlendFunc.BLEND_SRC_ALPHA=32971,osg.BlendFunc.CONSTANT_COLOR=32769,osg.BlendFunc.ONE_MINUS_CONSTANT_COLOR=32770,osg.BlendFunc.CONSTANT_ALPHA=32771,osg.BlendFunc.ONE_MINUS_CONSTANT_ALPHA=32772,osg.BlendFunc.BLEND_COLOR=32773,osg.BlendFunc.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"BlendFunc",cloneType:function(){return new osg.BlendFunc},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setSource:function(a){this.setSourceRGB(a),this.setSourceAlpha(a)},setDestination:function(a){this.setDestinationRGB(a),this.setDestinationAlpha(a)},checkSeparate:function(){return this._sourceFactor!==this._sourceFactorAlpha||this._destinationFactor!==this._destinationFactorAlpha},setSourceRGB:function(a){this._sourceFactor="string"==typeof a?osg.BlendFunc[a]:a,this._separate=this.checkSeparate()},setSourceAlpha:function(a){this._sourceFactorAlpha="string"==typeof a?osg.BlendFunc[a]:a,this._separate=this.checkSeparate()},setDestinationRGB:function(a){this._destinationFactor="string"==typeof a?osg.BlendFunc[a]:a,this._separate=this.checkSeparate()},setDestinationAlpha:function(a){this._destinationFactorAlpha="string"==typeof a?osg.BlendFunc[a]:a,this._separate=this.checkSeparate()},apply:function(a){var b=a.getGraphicContext();b.enable(b.BLEND),this._separate?b.blendFuncSeparate(this._sourceFactor,this._destinationFactor,this._sourceFactorAlpha,this._destinationFactorAlpha):b.blendFunc(this._sourceFactor,this._destinationFactor)}}),"osg","BlendFunc"),osg.BlendColor=function(a){osg.StateAttribute.call(this),this._constantColor=new Array(4),this._constantColor[0]=this._constantColor[1]=this._constantColor[2]=this._constantColor[3]=1,void 0!==a&&this.setConstantColor(a)},osg.BlendColor.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"BlendColor",cloneType:function(){return new osg.BlendColor},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setConstantColor:function(a){osg.Vec4.copy(a,this._constantColor)},getConstantColor:function(){return this._constantColor},apply:function(a){var b=a.getGraphicContext();b.blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3]),this._dirty=!1}}),"osg","BlendColor"),osg.BoundingBox=function(){this.init()},osg.BoundingBox.prototype=osg.objectLibraryClass({_cache_radius2_tmp:[0,0,0],init:function(){this._min=[1/0,1/0,1/0],this._max=[-1/0,-1/0,-1/0]},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandBySphere:function(a){if(a.valid()){var b=this._max,c=this._min;c[0]=Math.min(c[0],a._center[0]-a._radius),c[1]=Math.min(c[1],a._center[1]-a._radius),c[2]=Math.min(c[2],a._center[2]-a._radius),b[0]=Math.max(b[0],a._center[0]+a._radius),b[1]=Math.max(b[1],a._center[1]+a._radius),b[2]=Math.max(b[2],a._center[2]+a._radius)}},expandByVec3:function(a){var b=this._min,c=this._max;b[0]=Math.min(b[0],a[0]),b[1]=Math.min(b[1],a[1]),b[2]=Math.min(b[2],a[2]),c[0]=Math.max(c[0],a[0]),c[1]=Math.max(c[1],a[1]),c[2]=Math.max(c[2],a[2])},center:function(){var a=this._min,b=this._max;return[.5*(a[0]+b[0]),.5*(a[1]+b[1]),.5*(a[2]+b[2])]},radius:function(){return Math.sqrt(this.radius2())},radius2:function(){var a=this._min,b=this._max,c=this._cache_radius2_tmp;return c[0]=b[0]-a[0],c[1]=b[1]-a[1],c[2]=b[2]-a[2],.25*(c[0]*c[0]+c[1]*c[1]+c[2]*c[2])},corner:function(a){return ret=[0,0,0],ret[0]=1&a?this._max[0]:this._min[0],ret[1]=2&a?this._max[1]:this._min[1],ret[2]=4&a?this._max[2]:this._min[2],ret}},"osg","BoundingBox"),osg.BoundingSphere=function(){this._center=[0,0,0],this._radius=-1},osg.BoundingSphere.prototype={init:function(){this._center=[0,0,0],this._radius=-1},valid:function(){return this._radius>=0},set:function(a,b){this._center=a,this._radius=b},center:function(){return this._center},radius:function(){return this._radius},radius2:function(){return this._radius*this._radius},expandByBox:function(a){if(a.valid()){var b;if(this.valid()){var c=new osg.BoundingBox;c._min[0]=a._min[0],c._min[1]=a._min[1],c._min[2]=a._min[2],c._max[0]=a._max[0],c._max[1]=a._max[1],c._max[2]=a._max[2];for(var d=0;8>d;d++){var e=osg.Vec3.sub(a.corner(b),this._center,[]);osg.Vec3.normalize(e,e),nv[0]*=-this._radius,nv[1]*=-this._radius,nv[2]*=-this._radius,nv[0]+=this._center[0],nv[1]+=this._center[1],nv[2]+=this._center[2],c.expandBy(nv)}b=c.center(),this._center[0]=b[0],this._center[1]=b[1],this._center[2]=b[2],this._radius=c.radius()}else b=a.center(),this._center[0]=b[0],this._center[1]=b[1],this._center[2]=b[2],this._radius=a.radius()}},expandByVec3:function(a){if(this.valid()){var b=osg.Vec3.sub(a,this.center(),[]);r=osg.Vec3.length(b),r>this.radius()&&(dr=.5*(r-this.radius()),this._center[0]+=b[0]*(dr/r),this._center[1]+=b[1]*(dr/r),this._center[2]+=b[2]*(dr/r),this._radius+=dr)}else this._center[0]=a[0],this._center[1]=a[1],this._center[2]=a[2],this._radius=0},expandRadiusBySphere:function(a){if(a.valid())if(this.valid()){var b=osg.Vec3.sub,c=osg.Vec3.length,d=c(b(a._center,this._center,[]))+a._radius;d>this._radius&&(this._radius=d)}else this._center=osg.Vec3.copy(a._center,[]),this._radius=a._radius},expandBy:function(a){if(a.valid()){if(!this.valid())return this._center[0]=a._center[0],this._center[1]=a._center[1],this._center[2]=a._center[2],this._radius=a.radius(),void 0;var b=osg.Vec3.sub(this.center(),a.center(),[]);if(d=osg.Vec3.length(b),!(d+a.radius()<=this.radius())){if(d+this.radius()<=a.radius())return this._center[0]=a._center[0],this._center[1]=a._center[1],this._center[2]=a._center[2],this._radius=a._radius,void 0;new_radius=.5*(this.radius()+d+a.radius()),ratio=(new_radius-this.radius())/d,this._center[0]+=(a._center[0]-this._center[0])*ratio,this._center[1]+=(a._center[1]-this._center[1])*ratio,this._center[2]+=(a._center[2]-this._center[2])*ratio,this._radius=new_radius}}},contains:function(a){var b=osg.Vec3.sub(a,this.center(),[]);return valid()&&osg.Vec3.length2(b)<=radius2()},intersects:function(a){var b=osg.Vec3.length2(osg.Vec3.sub(this.center(),a.center(),[]));return valid()&&a.valid()&&b<=(this.radius()+a.radius())*(this.radius()+a.radius())}},osg.BufferArray=function(a,b,c){void 0===osg.BufferArray.instanceID&&(osg.BufferArray.instanceID=0),this.instanceID=osg.BufferArray.instanceID,osg.BufferArray.instanceID+=1,this.dirty(),this._itemSize=c,"string"==typeof a&&(a=osg.BufferArray[a]),this._type=a,void 0!==b&&(this._elements=this._type===osg.BufferArray.ELEMENT_ARRAY_BUFFER?new osg.Uint16Array(b):new osg.Float32Array(b))},osg.BufferArray.ELEMENT_ARRAY_BUFFER=34963,osg.BufferArray.ARRAY_BUFFER=34962,osg.BufferArray.prototype={setItemSize:function(a){this._itemSize=a},isValid:function(){return void 0!==this._buffer||void 0!==this._elements?!0:!1},releaseGLObjects:function(a){void 0!==this._buffer&&null!==this._buffer&&a.deleteBuffer(this._buffer),this._buffer=void 0},bind:function(a){var b=this._type,c=this._buffer;return c?(a.bindBuffer(b,c),void 0):(!c&&this._elements.length>0&&(this._buffer=a.createBuffer(),this._numItems=this._elements.length/this._itemSize,a.bindBuffer(b,this._buffer)),void 0)},getItemSize:function(){return this._itemSize},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},compile:function(a){this._dirty&&(a.bufferData(this._type,this._elements,a.STATIC_DRAW),this._dirty=!1)},getElements:function(){return this._elements},setElements:function(a){this._elements=a,this._dirty=!0}},osg.BufferArray.create=function(a,b,c){return osg.log("osg.BufferArray.create is deprecated, use new osg.BufferArray with same arguments instead"),new osg.BufferArray(a,b,c)},osg.CullFace=function(a){osg.StateAttribute.call(this),void 0===a&&(a=osg.CullFace.BACK),this.setMode(a)},osg.CullFace.DISABLE=0,osg.CullFace.FRONT=1028,osg.CullFace.BACK=1029,osg.CullFace.FRONT_AND_BACK=1032,osg.CullFace.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"CullFace",cloneType:function(){return new osg.CullFace},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setMode:function(a){"string"==typeof a&&(a=osg.CullFace[a]),this._mode=a},getMode:function(){return this._mode},apply:function(a){var b=a.getGraphicContext();this._mode===osg.CullFace.DISABLE?b.disable(b.CULL_FACE):(b.enable(b.CULL_FACE),b.cullFace(this._mode)),this._dirty=!1}}),"osg","CullFace"),osg.CullSettings=function(){this._computeNearFar=!0,this._nearFarRatio=.005;var a=[0,0,-1];this.bbCornerFar=(a[0]>=0?1:0)|(a[1]>=0?2:0)|(a[2]>=0?4:0),this.bbCornerNear=7&~this.bbCornerFar},osg.CullSettings.prototype={setCullSettings:function(a){this._computeNearFar=a._computeNearFar,this._nearFarRatio=a._nearFarRatio},setNearFarRatio:function(a){this._nearFarRatio=a},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(a){this._computeNearFar=a},getComputeNearFar:function(){return this._computeNearFar}},osg.CullStack=function(){this._modelviewMatrixStack=[],this._projectionMatrixStack=[],this._viewportStack=[],this._bbCornerFar=0,this._bbCornerNear=0},osg.CullStack.prototype={getCurrentProjectionMatrix:function(){return this._projectionMatrixStack[this._projectionMatrixStack.length-1]},getCurrentModelviewMatrix:function(){return this._modelviewMatrixStack[this._modelviewMatrixStack.length-1]},getViewport:function(){return 0===this._viewportStack.length?void 0:this._viewportStack[this._viewportStack.length-1]},getLookVectorLocal:function(){var a=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];return[-a[2],-a[6],-a[10]]},pushViewport:function(a){this._viewportStack.push(a)},popViewport:function(){this._viewportStack.pop()},pushModelviewMatrix:function(a){this._modelviewMatrixStack.push(a);var b=this.getLookVectorLocal();this._bbCornerFar=(b[0]>=0?1:0)|(b[1]>=0?2:0)|(b[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar},popModelviewMatrix:function(){this._modelviewMatrixStack.pop();var a;a=0!==this._modelviewMatrixStack.length?this.getLookVectorLocal():[0,0,-1],this._bbCornerFar=(a[0]>=0?1:0)|(a[1]>=0?2:0)|(a[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar},pushProjectionMatrix:function(a){this._projectionMatrixStack.push(a)},popProjectionMatrix:function(){this._projectionMatrixStack.pop()}},osg.Camera=function(){osg.Transform.call(this),osg.CullSettings.call(this),this.viewport=void 0,this.setClearColor([0,0,0,1]),this.setClearDepth(1),this.setClearMask(osg.Camera.COLOR_BUFFER_BIT|osg.Camera.DEPTH_BUFFER_BIT),this.setViewMatrix(osg.Matrix.makeIdentity([])),this.setProjectionMatrix(osg.Matrix.makeIdentity([])),this.renderOrder=osg.Camera.NESTED_RENDER,this.renderOrderNum=0},osg.Camera.PRE_RENDER=0,osg.Camera.NESTED_RENDER=1,osg.Camera.POST_RENDER=2,osg.Camera.COLOR_BUFFER_BIT=16384,osg.Camera.DEPTH_BUFFER_BIT=256,osg.Camera.STENCIL_BUFFER_BIT=1024,osg.Camera.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.CullSettings.prototype,osg.objectInehrit(osg.Transform.prototype,{setClearDepth:function(a){this.clearDepth=a},getClearDepth:function(){return this.clearDepth},setClearMask:function(a){this.clearMask=a},getClearMask:function(){return this.clearMask},setClearColor:function(a){this.clearColor=a},getClearColor:function(){return this.clearColor},setViewport:function(a){this.viewport=a,this.getOrCreateStateSet().setAttributeAndMode(a)},getViewport:function(){return this.viewport},setViewMatrix:function(a){this.modelviewMatrix=a},setProjectionMatrix:function(a){this.projectionMatrix=a},setProjectionMatrixAsOrtho:function(a,b,c,d,e,f){osg.Matrix.makeOrtho(a,b,c,d,e,f,this.getProjectionMatrix())},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(a,b){this.renderOrder=a,this.renderOrderNum=b},attachTexture:function(a,b,c){this.frameBufferObject&&this.frameBufferObject.dirty(),void 0===c&&(c=0),void 0===this.attachments&&(this.attachments={}),this.attachments[a]={texture:b,level:c}},attachRenderBuffer:function(a,b){this.frameBufferObject&&this.frameBufferObject.dirty(),void 0===this.attachments&&(this.attachments={}),this.attachments[a]={format:b}},computeLocalToWorldMatrix:function(a){return this.referenceFrame===osg.Transform.RELATIVE_RF?osg.Matrix.preMult(a,this.modelviewMatrix):a=this.modelviewMatrix,!0},computeWorldToLocalMatrix:function(a){var b=[];return osg.Matrix.inverse(this.modelviewMatrix,b),this.referenceFrame===osg.Transform.RELATIVE_RF?osg.Matrix.postMult(b,a):a=b,!0}})),"osg","Camera"),osg.Camera.prototype.objectType=osg.objectType.generate("Camera"),osg.Depth=function(a,b,c,d){osg.StateAttribute.call(this),this._func=osg.Depth.LESS,this._near=0,this._far=1,this._writeMask=!0,void 0!==a&&(this._func="string"==typeof a?osg.Depth[a]:a),void 0!==b&&(this._near=b),void 0!==c&&(this._far=c),void 0!==d&&(this._writeMask=d)},osg.Depth.DISABLE=0,osg.Depth.NEVER=512,osg.Depth.LESS=513,osg.Depth.EQUAL=514,osg.Depth.LEQUAL=515,osg.Depth.GREATE=516,osg.Depth.NOTEQU=517,osg.Depth.GEQUAL=518,osg.Depth.ALWAYS=519,osg.Depth.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Depth",cloneType:function(){return new osg.Depth},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setRange:function(a,b){this._near=a,this._far=b},setWriteMask:function(a){this._writeMask=a},apply:function(a){var b=a.getGraphicContext();0===this._func?b.disable(b.DEPTH_TEST):(b.enable(b.DEPTH_TEST),b.depthFunc(this._func),b.depthMask(this._writeMask),b.depthRange(this._near,this._far))}}),"osg","Depth"),osg.WGS_84_RADIUS_EQUATOR=6378137,osg.WGS_84_RADIUS_POLAR=6356752.3142,osg.EllipsoidModel=function(){this._radiusEquator=osg.WGS_84_RADIUS_EQUATOR,this._radiusPolar=osg.WGS_84_RADIUS_POLAR,this.computeCoefficients()},osg.EllipsoidModel.prototype={setRadiusEquator:function(){this._radiusEquator=radius,this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(a){this._radiusPolar=a,this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(a,b,c,d){void 0===d&&(osg.warn("deprecated, use this signature convertLatLongHeightToXYZ( latitude, longitude, height, result )"),d=[]);var e=Math.sin(a),f=Math.cos(a),g=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*e*e),h=(g+c)*f*Math.cos(b),i=(g+c)*f*Math.sin(b),j=(g*(1-this._eccentricitySquared)+c)*e;return d[0]=h,d[1]=i,d[2]=j,d},convertXYZToLatLongHeight:function(a,b,c,d){void 0===d&&(osg.warn("deprecated, use this signature convertXYZToLatLongHeight( X,  Y,  Z , result)"),d=[]);var e=Math.sqrt(a*a+b*b),f=Math.atan2(c*this._radiusEquator,e*this._radiusPolar),g=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*this._radiusPolar),h=Math.sin(f),i=Math.cos(f);latitude=Math.atan((c+g*this._radiusPolar*h*h*h)/(e-this._eccentricitySquared*this._radiusEquator*i*i*i)),longitude=Math.atan2(b,a);var j=Math.sin(latitude),k=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*j*j);return height=e/Math.cos(latitude)-k,d[0]=latitude,d[1]=longitude,d[2]=height,d},computeLocalUpVector:function(a,b,c){var d,e,f,g=this.convertXYZToLatLongHeight(a,b,c,d,e,f);return d=g[0],e=g[1],f=g[2],[Math.cos(e)*Math.cos(d),Math.sin(e)*Math.cos(d),Math.sin(d)]},isWGS84:function(){return this._radiusEquator==osg.WGS_84_RADIUS_EQUATOR&&this._radiusPolar==osg.WGS_84_RADIUS_POLAR},computeCoefficients:function(){var a=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*a-a*a},computeLocalToWorldTransformFromLatLongHeight:function(a,b,c,d){void 0===d&&(osg.warn("deprecated, use this signature computeLocalToWorldTransformFromLatLongHeight(latitude, longitude, height, result)"),d=new Array(16));var e=this.convertLatLongHeightToXYZ(a,b,c,d);return osg.Matrix.makeTranslate(e[0],e[1],e[2],d),this.computeCoordinateFrame(a,b,d),d},computeLocalToWorldTransformFromXYZ:function(a,b,c){var d=this.convertXYZToLatLongHeight(a,b,c),e=osg.Matrix.makeTranslate(a,b,c);return this.computeCoordinateFrame(d[0],d[1],e),e},computeCoordinateFrame:function(a,b,c){var d=[Math.cos(b)*Math.cos(a),Math.sin(b)*Math.cos(a),Math.sin(a)],e=[-Math.sin(b),Math.cos(b),0],f=osg.Vec3.cross(d,e,[]);osg.Matrix.set(c,0,0,e[0]),osg.Matrix.set(c,0,1,e[1]),osg.Matrix.set(c,0,2,e[2]),osg.Matrix.set(c,1,0,f[0]),osg.Matrix.set(c,1,1,f[1]),osg.Matrix.set(c,1,2,f[2]),osg.Matrix.set(c,2,0,d[0]),osg.Matrix.set(c,2,1,d[1]),osg.Matrix.set(c,2,2,d[2])}},osg.FrameBufferObject=function(){osg.StateAttribute.call(this),this.fbo=void 0,this.attachments=[],this.dirty()},osg.FrameBufferObject.COLOR_ATTACHMENT0=36064,osg.FrameBufferObject.DEPTH_ATTACHMENT=36096,osg.FrameBufferObject.DEPTH_COMPONENT16=33189,osg.FrameBufferObject.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new osg.FrameBufferObject},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setAttachment:function(a){this.attachments.push(a)},_reportFrameBufferError:function(a){switch(a){case 36054:osg.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:osg.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case 36057:osg.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:osg.debug("FRAMEBUFFER_UNSUPPORTED");break;default:osg.debug("FRAMEBUFFER unknown error "+a.toString(16))}},apply:function(a){var b,c=a.getGraphicContext();if(this.attachments.length>0)if(this.isDirty()){this.fbo||(this.fbo=c.createFramebuffer()),c.bindFramebuffer(c.FRAMEBUFFER,this.fbo);for(var d=!1,e=0,f=this.attachments.length;f>e;++e)if(void 0===this.attachments[e].texture){var g=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,g),c.renderbufferStorage(c.RENDERBUFFER,this.attachments[e].format,this.attachments[e].width,this.attachments[e].height),c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachments[e].attachment,c.RENDERBUFFER,g),d=!0}else{var h=this.attachments[e].texture;a.applyTextureAttribute(0,h),c.framebufferTexture2D(c.FRAMEBUFFER,this.attachments[e].attachment,h.getTextureTarget(),h.getTextureObject(),this.attachments[e].level)}b=c.checkFramebufferStatus(c.FRAMEBUFFER),36053!==b&&this._reportFrameBufferError(b),d&&c.bindRenderbuffer(c.RENDERBUFFER,null),this.setDirty(!1)}else c.bindFramebuffer(c.FRAMEBUFFER,this.fbo),osg.reportWebGLError===!0&&(b=c.checkFramebufferStatus(c.FRAMEBUFFER),36053!==b&&this._reportFrameBufferError(b));else c.bindFramebuffer(c.FRAMEBUFFER,null)}}),osg.FrameStamp=function(){var a=0,b=0,c=0;this.setReferenceTime=function(a){b=a},this.setSimulationTime=function(a){c=a},this.getReferenceTime=function(){return b},this.getSimulationTime=function(){return c},this.setFrameNumber=function(b){a=b},this.getFrameNumber=function(){return a}},osg.Geometry=function(){osg.Node.call(this),this.primitives=[],this.attributes={},this.boundingBox=new osg.BoundingBox,this.boundingBoxComputed=!1,this.cacheAttributeList={}},osg.Geometry.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Node.prototype,{releaseGLObjects:function(a){var b;for(b in this.attributes)this.attributes[b].releaseGLObjects(a);for(var c=0,d=this.primitives.length;d>c;c++){var e=this.primitives[c];void 0!==e.getIndices&&void 0!==e.getIndices()&&null!==e.getIndices()&&e.indices.releaseGLObjects(a)}},dirtyBound:function(){this.boundingBoxComputed===!0&&(this.boundingBoxComputed=!1),osg.Node.prototype.dirtyBound.call(this)},dirty:function(){this.cacheAttributeList={}},getPrimitives:function(){return this.primitives},getAttributes:function(){return this.attributes},getVertexAttributeList:function(){return this.attributes},getPrimitiveSetList:function(){return this.primitives},drawImplementation:function(a){var b=a.getLastProgramApplied(),c=b.instanceID;if(void 0===this.cacheAttributeList[c]){var d,e=b.attributesCache,f=[],g="//generated by Geometry::implementation\n";g+="state.lazyDisablingOfVertexAttributes();\n",g+="var attr;\n";for(var h=0,i=e.attributeKeys.length;i>h;h++){var j=e.attributeKeys[h];d=e[j];var k=this.attributes[j];void 0!==k&&(f.push(d),g+='attr = this.attributes["'+j+'"];\n',g+="if (!attr.isValid()) { return; }\n",g+="state.setVertexAttribArray("+d+", attr, false);\n")}g+="state.applyDisablingOfVertexAttributes();\n";var l=this.primitives;g+="var primitives = this.primitives;\n";for(var m=0,n=l.length;n>m;++m)g+="primitives["+m+"].draw(state);\n";this.cacheAttributeList[c]=new Function("state",g)}this.cacheAttributeList[c].call(this,a)},drawImplementationDummy:function(a){var b=a.getLastProgramApplied();b.attributesCache;for(var c=this.primitives,d=0,e=c.length;e>d;++d);},getBoundingBox:function(){return this.boundingBoxComputed||(this.computeBoundingBox(this.boundingBox),this.boundingBoxComputed=!0),this.boundingBox},computeBoundingBox:function(a){var b=this.getAttributes().Vertex;if(void 0!==b&&void 0!==b.getElements()&&b.getItemSize()>2){var c=[0,0,0];vertexes=b.getElements();for(var d=0,e=vertexes.length;e>d;d+=3)c[0]=vertexes[d],c[1]=vertexes[d+1],c[2]=vertexes[d+2],a.expandByVec3(c)}return a},computeBound:function(a){a.init();var b=this.getBoundingBox();return a.expandByBox(b),a}}),"osg","Geometry"),osg.Geometry.prototype.objectType=osg.objectType.generate("Geometry"),osg.Light=function(a){osg.StateAttribute.call(this),void 0===a&&(a=0),this._ambient=[.2,.2,.2,1],this._diffuse=[.8,.8,.8,1],this._specular=[.2,.2,.2,1],this._position=[0,0,1,0],this._direction=[0,0,-1],this._spotCutoff=180,this._spotBlend=.01,this._constantAttenuation=1,this._linearAttenuation=0,this._quadraticAttenuation=0,this._lightUnit=a,this._enabled=0,this.dirty()},osg.Light.uniforms={},osg.Light.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Light",cloneType:function(){return new osg.Light(this._lightUnit)},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType+this._lightUnit},getOrCreateUniforms:function(){var a=osg.Light.uniforms,b=this.getTypeMember();if(void 0===a[b]){var c=osg.Uniform;a[b]={ambient:c.createFloat4([.2,.2,.2,1],this.getUniformName("ambient")),diffuse:c.createFloat4([.8,.8,.8,1],this.getUniformName("diffuse")),specular:c.createFloat4([.2,.2,.2,1],this.getUniformName("specular")),position:c.createFloat4([0,0,1,0],this.getUniformName("position")),direction:c.createFloat3([0,0,1],this.getUniformName("direction")),spotCutoff:c.createFloat1(180,this.getUniformName("spotCutoff")),spotBlend:c.createFloat1(.01,this.getUniformName("spotBlend")),constantAttenuation:c.createFloat1(0,this.getUniformName("constantAttenuation")),linearAttenuation:c.createFloat1(0,this.getUniformName("linearAttenuation")),quadraticAttenuation:c.createFloat1(0,this.getUniformName("quadraticAttenuation")),enable:c.createInt1(0,this.getUniformName("enable")),matrix:c.createMatrix4(osg.Matrix.makeIdentity([]),this.getUniformName("matrix")),invMatrix:c.createMatrix4(osg.Matrix.makeIdentity([]),this.getUniformName("invMatrix"))},a[b].uniformKeys=Object.keys(a[b])}return a[b]},setPosition:function(a){osg.Vec4.copy(a,this._position)},getPosition:function(){return this._position},setAmbient:function(a){this._ambient=a,this.dirty()},setSpecular:function(a){this._specular=a,this.dirty()},setDiffuse:function(a){this._diffuse=a,this.dirty()},setSpotCutoff:function(a){this._spotCutoff=a,this.dirty()},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(a){this._spotBlend=a,this.dirty()},getSpotBlend:function(){return this._spotBlend},setConstantAttenuation:function(a){this._constantAttenuation=a,this.dirty()},setLinearAttenuation:function(a){this._linearAttenuation=a,this.dirty()},setQuadraticAttenuation:function(a){this._quadraticAttenuation=a,this.dirty()},setDirection:function(a){this._direction=a,this.dirty()},getDirection:function(){return this._direction},setLightNumber:function(a){this._lightUnit=a,this.dirty()},getLightNumber:function(){return this._lightUnit},getPrefix:function(){return this.getType()+this._lightUnit},getParameterName:function(a){return this.getPrefix()+"_"+a},getUniformName:function(a){return this.getPrefix()+"_uniform_"+a},applyPositionedUniform:function(a){var b=this.getOrCreateUniforms();osg.Matrix.copy(a,b.matrix.get()),b.matrix.dirty(),osg.Matrix.copy(a,b.invMatrix.get()),b.invMatrix.get()[12]=0,b.invMatrix.get()[13]=0,b.invMatrix.get()[14]=0,osg.Matrix.inverse(b.invMatrix.get(),b.invMatrix.get()),osg.Matrix.transpose(b.invMatrix.get(),b.invMatrix.get()),b.invMatrix.dirty()},apply:function(){var a=this.getOrCreateUniforms();a.ambient.set(this._ambient),a.diffuse.set(this._diffuse),a.specular.set(this._specular),a.position.set(this._position),a.direction.set(this._direction);var b=Math.cos(this._spotCutoff*Math.PI/180);a.spotCutoff.get()[0]=b,a.spotCutoff.dirty(),a.spotBlend.get()[0]=(1-b)*this._spotBlend,a.spotBlend.dirty(),a.constantAttenuation.get()[0]=this._constantAttenuation,a.constantAttenuation.dirty(),a.linearAttenuation.get()[0]=this._linearAttenuation,a.linearAttenuation.dirty(),a.quadraticAttenuation.get()[0]=this._quadraticAttenuation,a.quadraticAttenuation.dirty(),this.setDirty(!1)},_replace:function(a,b,c,d){for(var e=0,f=b.length;f>e;e++){var g=new RegExp(a+b[e],"g");c=c.replace(g,d.call(this,b[e]))}return c},_shader:{},_shaderCommon:{},generateShader:function(a){return this._shader[a]?this._shader[a].call(this):""},generateShaderCommon:function(a){return this._shaderCommon[a]?this._shaderCommon[a].call(this):""}}),"osg","Light"),osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.VertexInit]=function(){return["","varying vec3 FragNormal;","varying vec3 FragEyeVector;","",""].join("\n")},osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.VertexFunction]=function(){return["","vec3 computeNormal() {","   return vec3(NormalMatrix * vec4(Normal, 0.0));","}","","vec3 computeEyeVertex() {","   return vec3(ModelViewMatrix * vec4(Vertex,1.0));","}","",""].join("\n")},osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.VertexMain]=function(){return["","  FragEyeVector = computeEyeVertex();","  FragNormal = computeNormal();",""].join("\n")},osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.FragmentInit]=function(){return["varying vec3 FragNormal;","varying vec3 FragEyeVector;",""].join("\n")},osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.FragmentFunction]=function(){return["","float getLightAttenuation(vec3 lightDir, float constant, float linear, float quadratic) {","    ","    float d = length(lightDir);","    float att = 1.0 / ( constant + linear*d + quadratic*d*d);","    return att;","}","vec4 computeLightContribution(vec4 materialAmbient,","                              vec4 materialDiffuse,","                              vec4 materialSpecular,","                              float materialShininess,","                              vec4 lightAmbient,","                              vec4 lightDiffuse,","                              vec4 lightSpecular,","                              vec3 normal,","                              vec3 eye,","                              vec3 lightDirection,","                              vec3 lightSpotDirection,","                              float lightCosSpotCutoff,","                              float lightSpotBlend,","                              float lightAttenuation)","{","    vec3 L = lightDirection;","    vec3 N = normal;","    float NdotL = max(dot(L, N), 0.0);","    float halfTerm = NdotL;","    vec4 ambient = lightAmbient;","    vec4 diffuse = vec4(0.0);","    vec4 specular = vec4(0.0);","    float spot = 0.0;","","    if (NdotL > 0.0) {","        vec3 E = eye;","        vec3 R = reflect(-L, N);","        float RdotE = max(dot(R, E), 0.0);","        if ( RdotE > 0.0) {","           RdotE = pow( RdotE, materialShininess );","        }","        vec3 D = lightSpotDirection;","        spot = 1.0;","        if (lightCosSpotCutoff > 0.0) {","          float cosCurAngle = dot(-L, D);","          if (cosCurAngle < lightCosSpotCutoff) {","             spot = 0.0;","          } else {","             if (lightSpotBlend > 0.0)","               spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle-lightCosSpotCutoff)/(lightSpotBlend));","          }","        }","        diffuse = lightDiffuse * ((halfTerm));","        specular = lightSpecular * RdotE;","    }","","    return (materialAmbient*ambient + (materialDiffuse*diffuse + materialSpecular*specular) * spot) * lightAttenuation;","}","float linearrgb_to_srgb1(const in float c)","{","  float v = 0.0;","  if(c < 0.0031308) {","    if ( c > 0.0)","      v = c * 12.92;","  } else {","    v = 1.055 * pow(c, 1.0/2.4) - 0.055;","  }","  return v;","}","vec4 linearrgb_to_srgb(const in vec4 col_from)","{","  vec4 col_to;","  col_to.r = linearrgb_to_srgb1(col_from.r);","  col_to.g = linearrgb_to_srgb1(col_from.g);","  col_to.b = linearrgb_to_srgb1(col_from.b);","  col_to.a = col_from.a;","  return col_to;","}","float srgb_to_linearrgb1(const in float c)","{","  float v = 0.0;","  if(c < 0.04045) {","    if (c >= 0.0)","      v = c * (1.0/12.92);","  } else {","    v = pow((c + 0.055)*(1.0/1.055), 2.4);","  }"," return v;","}","vec4 srgb2linear(const in vec4 col_from)","{","  vec4 col_to;","  col_to.r = srgb_to_linearrgb1(col_from.r);","  col_to.g = srgb_to_linearrgb1(col_from.g);","  col_to.b = srgb_to_linearrgb1(col_from.b);","  col_to.a = col_from.a;","  return col_to;","}",""].join("\n")
},osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.FragmentMain]=function(){return["","  vec3 normal = normalize(FragNormal);","  vec3 eyeVector = normalize(-FragEyeVector);","  vec4 lightColor = MaterialEmission;",""].join("\n")},osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.FragmentEnd]=function(){return["","  fragColor *= lightColor;",""].join("\n")},osg.Light.prototype._shader[osg.ShaderGeneratorType.FragmentInit]=function(){var a=["","uniform vec4 Light_position;","uniform vec3 Light_direction;","uniform mat4 Light_matrix;","uniform mat4 Light_invMatrix;","uniform float Light_constantAttenuation;","uniform float Light_linearAttenuation;","uniform float Light_quadraticAttenuation;","uniform vec4 Light_ambient;","uniform vec4 Light_diffuse;","uniform vec4 Light_specular;","uniform float Light_spotCutoff;","uniform float Light_spotBlend;",""].join("\n");return uniforms=Object.keys(this.getOrCreateUniforms()),a=this._replace("Light_",uniforms,a,this.getUniformName)},osg.Light.prototype._shader[osg.ShaderGeneratorType.FragmentMain]=function(){var a=["","  vec3 lightEye = vec3(Light_matrix * Light_position);","  vec3 lightDir;","  if (Light_position[3] == 1.0) {","    lightDir = lightEye - FragEyeVector;","  } else {","    lightDir = lightEye;","  }","  vec3 spotDirection = normalize(mat3(vec3(Light_invMatrix[0]), vec3(Light_invMatrix[1]), vec3(Light_invMatrix[2]))*Light_direction);","  float attenuation = getLightAttenuation(lightDir, Light_constantAttenuation, Light_linearAttenuation, Light_quadraticAttenuation);","  lightDir = normalize(lightDir);","  lightColor += computeLightContribution(MaterialAmbient,","                                         MaterialDiffuse, ","                                         MaterialSpecular,","                                         MaterialShininess,","                                         Light_ambient,","                                         Light_diffuse,","                                         Light_specular,","                                         normal,","                                         eyeVector,","                                         lightDir,","                                         spotDirection,","                                         Light_spotCutoff,","                                         Light_spotBlend,","                                         attenuation);",""].join("\n"),b=["lightEye","lightDir","spotDirection","attenuation"];return a=this._replace("",b,a,this.getParameterName),uniforms=Object.keys(this.getOrCreateUniforms()),a=this._replace("Light_",uniforms,a,this.getUniformName)},osg.LightSource=function(){osg.Node.call(this),this._light=void 0},osg.LightSource.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Node.prototype,{getLight:function(){return this._light},setLight:function(a){this._light=a}}),"osg","LightSource"),osg.LightSource.prototype.objectType=osg.objectType.generate("LightSource"),osg.LineWidth=function(a){osg.StateAttribute.call(this),this.lineWidth=1,void 0!==a&&(this.lineWidth=a)},osg.LineWidth.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"LineWidth",cloneType:function(){return new osg.LineWidth},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(a){a.getGraphicContext().lineWidth(this.lineWidth)}}),"osg","LineWidth"),osg.Material=function(){osg.StateAttribute.call(this),this.ambient=[.2,.2,.2,1],this.diffuse=[.8,.8,.8,1],this.specular=[0,0,0,1],this.emission=[0,0,0,1],this.shininess=12.5},osg.Material.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{setEmission:function(a){osg.Vec4.copy(a,this.emission),this._dirty=!0},setAmbient:function(a){osg.Vec4.copy(a,this.ambient),this._dirty=!0},setSpecular:function(a){osg.Vec4.copy(a,this.specular),this._dirty=!0},setDiffuse:function(a){osg.Vec4.copy(a,this.diffuse),this._dirty=!0},setShininess:function(a){this.shininess=a,this._dirty=!0},getEmission:function(){return this.emission},getAmbient:function(){return this.ambient},getSpecular:function(){return this.specular},getDiffuse:function(){return this.diffuse},getShininess:function(){return this.shininess},attributeType:"Material",cloneType:function(){return new osg.Material},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getOrCreateUniforms:function(){if(void 0===osg.Material.uniforms){osg.Material.uniforms={ambient:osg.Uniform.createFloat4([0,0,0,0],"MaterialAmbient"),diffuse:osg.Uniform.createFloat4([0,0,0,0],"MaterialDiffuse"),specular:osg.Uniform.createFloat4([0,0,0,0],"MaterialSpecular"),emission:osg.Uniform.createFloat4([0,0,0,0],"MaterialEmission"),shininess:osg.Uniform.createFloat1([0],"MaterialShininess")};var a=[];for(var b in osg.Material.uniforms)a.push(b);osg.Material.uniforms.uniformKeys=a}return osg.Material.uniforms},apply:function(){var a=this.getOrCreateUniforms();a.ambient.set(this.ambient),a.diffuse.set(this.diffuse),a.specular.set(this.specular),a.emission.set(this.emission),a.shininess.set([this.shininess]),this._dirty=!1},_shader:{},_shaderCommon:{},generateShader:function(a){return this._shader[a]?this._shader[a].call(this):""}}),"osg","Material"),osg.Material.prototype._shader[osg.ShaderGeneratorType.VertexInit]=function(){var a=["uniform vec4 MaterialAmbient;","uniform vec4 MaterialDiffuse;","uniform vec4 MaterialSpecular;","uniform vec4 MaterialEmission;","uniform float MaterialShininess;",""].join("\n");return a},osg.Material.prototype._shader[osg.ShaderGeneratorType.FragmentInit]=function(){var a=["uniform vec4 MaterialAmbient;","uniform vec4 MaterialDiffuse;","uniform vec4 MaterialSpecular;","uniform vec4 MaterialEmission;","uniform float MaterialShininess;",""].join("\n");return a},osg.PrimitiveSet=function(){},osg.PrimitiveSet.POINTS=0,osg.PrimitiveSet.LINES=1,osg.PrimitiveSet.LINE_LOOP=2,osg.PrimitiveSet.LINE_STRIP=3,osg.PrimitiveSet.TRIANGLES=4,osg.PrimitiveSet.TRIANGLE_STRIP=5,osg.PrimitiveSet.TRIANGLE_FAN=6,osg.DrawArrays=function(a,b,c){this.mode=a,this.first=b,this.count=c},osg.DrawArrays.prototype={draw:function(a){var b=a.getGraphicContext();b.drawArrays(this.mode,this.first,this.count)},getMode:function(){return this.mode},getCount:function(){return this.count},getFirst:function(){return this.first}},osg.DrawArrays.create=function(a,b,c){osg.log("osg.DrawArrays.create is deprecated, use new osg.DrawArrays with same arguments");var d=new osg.DrawArrays(a,b,c);return d},osg.DrawArrayLengths=function(a,b,c){this._mode=a,this._first=b,this._arrayLengths=c.slice(0)},osg.DrawArrayLengths.prototype={draw:function(a){for(var b=a.getGraphicContext(),c=this._mode,d=this._first,e=this._arrayLengths,f=0,g=e.length;g>f;f++){var h=e[f];b.drawArrays(c,d,h),d+=h}},getMode:function(){return this._mode},getNumIndices:function(){for(var a=0,b=this._arrayLengths,c=0,d=b.length;d>c;c++)a+=b[c];return a},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(a){this._first=a}},osg.DrawElements=function(a,b){this.mode=osg.PrimitiveSet.POINTS,void 0!==a&&(this.mode=a),this.count=0,this.offset=0,this.indices=b,void 0!==b&&this.setIndices(b)},osg.DrawElements.prototype={getMode:function(){return this.mode},draw:function(a){a.setIndexArray(this.indices);var b=a.getGraphicContext();b.drawElements(this.mode,this.count,b.UNSIGNED_SHORT,this.offset)},setIndices:function(a){this.indices=a,this.count=a.getElements().length},getIndices:function(){return this.indices},setFirst:function(a){this.offset=a},getFirst:function(){return this.offset},setCount:function(a){this.count=a},getCount:function(){return this.count}},osg.DrawElements.create=function(a,b){return osg.log("osg.DrawElements.create is deprecated, use new osg.DrawElements with same arguments"),new osg.DrawElements(a,b)},osg.Program=function(a,b){osg.StateAttribute.call(this),void 0===osg.Program.instanceID&&(osg.Program.instanceID=0),this.instanceID=osg.Program.instanceID,osg.Program.instanceID+=1,this.program=null,this.setVertexShader(a),this.setFragmentShader(b),this.dirty=!0},osg.Program.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Program",cloneType:function(){var a=new osg.Program;return a.default_program=!0,a},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setVertexShader:function(a){this.vertex=a},setFragmentShader:function(a){this.fragment=a},getVertexShader:function(){return this.vertex},getFragmentShader:function(){return this.fragment},apply:function(){if(!this.program||this.isDirty()){if(this.default_program===!0)return;if(this.vertex.shader||this.vertex.compile(),this.fragment.shader||this.fragment.compile(),this.program=gl.createProgram(),gl.attachShader(this.program,this.vertex.shader),gl.attachShader(this.program,this.fragment.shader),gl.linkProgram(this.program),gl.validateProgram(this.program),!gl.getProgramParameter(this.program,gl.LINK_STATUS)&&!gl.isContextLost())return osg.log("can't link program\nvertex shader:\n"+this.vertex.text+"\n fragment shader:\n"+this.fragment.text),osg.log(gl.getProgramInfoLog(this.program)),this.setDirty(!1),null;this.uniformsCache={},this.uniformsCache.uniformKeys=[],this.attributesCache={},this.attributesCache.attributeKeys=[],this.cacheUniformList(this.vertex.text),this.cacheUniformList(this.fragment.text),this.cacheAttributeList(this.vertex.text),this.setDirty(!1)}gl.useProgram(this.program)},cacheUniformList:function(a){var b=a.match(/uniform\s+\w+\s+\w+/g);if(null!==b)for(var c=0,d=b.length;d>c;c++){var e=b[c].match(/uniform\s+\w+\s+(\w+)/)[1],f=gl.getUniformLocation(this.program,e);void 0!==f&&null!==f&&void 0===this.uniformsCache[e]&&(this.uniformsCache[e]=f,this.uniformsCache.uniformKeys.push(e))}},cacheAttributeList:function(a){var b=a.match(/attribute\s+\w+\s+\w+/g);if(null!==b)for(var c=0,d=b.length;d>c;c++){var e=b[c].match(/attribute\s+\w+\s+(\w+)/)[1],f=gl.getAttribLocation(this.program,e);-1!==f&&void 0!==f&&void 0===this.attributesCache[e]&&(this.attributesCache[e]=f,this.attributesCache.attributeKeys.push(e))}}}),"osg","Program"),osg.Program.create=function(a,b){var c=new osg.Program(a,b);return c},osg.Projection=function(){osg.Node.call(this),this.projection=osg.Matrix.makeIdentity([])},osg.Projection.prototype=osg.objectInehrit(osg.Node.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(a){this.projection=a}}),osg.Projection.prototype.objectType=osg.objectType.generate("Projection"),osg.Quat={copy:function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},makeIdentity:function(a){return osg.Quat.init(a)},zeroRotation:function(a){return osg.Quat.init(a)},init:function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},sub:function(a,b,c){return c[0]=a[0]-b[0],c[1]=a[1]-b[1],c[2]=a[2]-b[2],c[3]=a[3]-b[3],c},add:function(a,b,c){return c[0]=a[0]+b[0],c[1]=a[1]+b[1],c[2]=a[2]+b[2],c[3]=a[3]+b[3],c},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},length2:function(a){return a[0]*a[0]+a[1]*a[1]+a[2]*a[2]+a[3]*a[3]},neg:function(a,b){return b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=-a[3],b},makeRotate:function(a,b,c,d,e){var f=1e-7,g=Math.sqrt(b*b+c*c+d*d);if(f>g)return this.init();var h=1/g,i=Math.cos(.5*a),j=Math.sin(.5*a);return void 0===e&&(e=[]),e[0]=b*j*h,e[1]=c*j*h,e[2]=d*j*h,e[3]=i,e},lerp:function(a,b,c,d){return d[0]=b[0]+(c[0]-b[0])*a,d[1]=b[1]+(c[1]-b[1])*a,d[2]=b[2]+(c[2]-b[2])*a,d[3]=b[3]+(c[3]-b[3])*a,d},slerp:function(a,b,c,d){var e=1e-5,f=c,g=this.dot(b,f);0>g&&(g=-g,this.neg(c,f));var h,i,j,k;return 1-g>e?(h=Math.acos(g),i=Math.sin(h),j=Math.sin((1-a)*h)/i,k=Math.sin(a*h)/i):(j=1-a,k=a),d[0]=b[0]*j+f[0]*k,d[1]=b[1]*j+f[1]*k,d[2]=b[2]*j+f[2]*k,d[3]=b[3]*j+f[3]*k,d},normalize:function(a,b){var c=1/this.length2(a);return b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c,b[3]=a[3]*c,b},conj:function(a,b){return b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=a[3],b},inverse:function(a,b){var c=1/this.length2(a);return this.conj(a,b),b[0]*=c,b[1]*=c,b[2]*=c,b[3]*=c,b},mult:function(a,b,c){return c[0]=a[0]*b[3]+a[1]*b[2]-a[2]*b[1]+a[3]*b[0],c[1]=-a[0]*b[2]+a[1]*b[3]+a[2]*b[0]+a[3]*b[1],c[2]=a[0]*b[1]-a[1]*b[0]+a[2]*b[3]+a[3]*b[2],c[3]=-a[0]*b[0]-a[1]*b[1]-a[2]*b[2]+a[3]*b[3],c},div:function(a,b,c){var d=1/b;return c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d,c},exp:function(a,b){var c=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),d=Math.exp(a[3]),e=0;return c>1e-5&&(e=d*Math.sin(c)/c),void 0===b&&(b=[]),b[0]=e*a[0],b[1]=e*a[1],b[2]=e*a[2],b[3]=d*Math.cos(c),b},ln:function(a,b){var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],d=Math.sqrt(c),e=0;return d>1e-5&&(e=Math.atan2(d,a[3])/d),void 0===b&&(b=[]),c+=a[3]*a[3],b[0]=e*a[0],b[1]=e*a[1],b[2]=e*a[2],b[3]=.5*Math.log(c),b},squad:function(a,b,c,d,e,f){var g=this.slerp(a,b,e),h=this.slerp(a,c,d);return this.slerp(2*a*(1-a),g,h,f)},computeTangent:function(a,b,c,d){var e,f,g=this.inv(b);return this.mult(c,g,e),this.ln(e,e),this.mult(a,g,f),this.ln(f,f),this.add(e,f,e),this.div(e,-4,e),this.exp(e,f),this.mult(f,q1,d)}},osg.RenderBin=function(){this._leafs=[],this.positionedAttribute=[],this._renderStage=void 0,this._bins={},this.stateGraphList=[],this._parent=void 0,this._binNum=0,this._sorted=!1,this._sortMode=osg.RenderBin.SORT_BY_STATE},osg.RenderBin.SORT_BY_STATE=0,osg.RenderBin.SORT_BACK_TO_FRONT=1,osg.RenderBin.BinPrototypes={RenderBin:function(){return new osg.RenderBin},DepthSortedBin:function(){var a=new osg.RenderBin;return a._sortMode=osg.RenderBin.SORT_BACK_TO_FRONT,a}},osg.RenderBin.prototype={_createRenderBin:function(a){return void 0===a||void 0===osg.RenderBin.BinPrototypes[a]?osg.RenderBin.BinPrototypes.RenderBin():osg.RenderBin.BinPrototypes[a]()},getStateGraphList:function(){return this.stateGraphList},copyLeavesFromStateGraphListToRenderLeafList:function(){this._leafs.splice(0,this._leafs.length);for(var a=!1,b=0,c=this.stateGraphList.length;c>b;b++)for(var d=this.stateGraphList[b].leafs,e=0,f=d.length;f>e;e++){var g=d[e];isNaN(g.depth)?a=!0:this._leafs.push(g)}a&&osg.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted."),this.stateGraphList.splice(0,this.stateGraphList.length)},sortBackToFront:function(){this.copyLeavesFromStateGraphListToRenderLeafList();var a=function(a,b){return b.depth-a.depth};this._leafs.sort(a)},sortImplementation:function(){var a=osg.RenderBin;switch(this._sortMode){case a.SORT_BACK_TO_FRONT:this.sortBackToFront();break;case a.SORT_BY_STATE:}},sort:function(){if(!this._sorted){for(var a=this._bins,b=Object.keys(a),c=0,d=b.length;d>c;c++)a[b[c]].sort();this.sortImplementation(),_sorted=!0}},setParent:function(a){this._parent=a},getParent:function(){return this._parent},getBinNumber:function(){return this._binNum},findOrInsert:function(a,b){var c=this._bins[a];return void 0===c&&(c=this._createRenderBin(b),c._parent=this,c._binNum=a,c._renderStage=this._renderStage,this._bins[a]=c),c},getStage:function(){return this._renderStage},addStateGraph:function(a){this.stateGraphList.push(a)},reset:function(){this.stateGraphList.length=0,this._bins={},this.positionedAttribute.length=0,this._leafs.length=0,this._sorted=!1},applyPositionedAttribute:function(a,b){for(var c=0,d=b.length;d>c;c++){var e=b[c],f=e[1],g=e[0];a.setGlobalDefaultValue(f),f.apply(a),f.applyPositionedUniform(g,a),a.haveAppliedAttribute(f)}},drawImplementation:function(a,b){for(var c=b,d=Object.keys(this._bins),e=this._bins,f=[],g=0,h=d.length;h>g;g++){var i=d[g];f.push(e[i])}var j=function(a,b){return a._binNum-b._binNum};f.sort(j);for(var k,l=0,m=f.length;m>l&&(k=f[l],!(k.getBinNumber()>0));l++)c=k.drawImplementation(a,c);for(c=this.drawLeafs(a,c);m>l;l++)k=f[l],c=k.drawImplementation(a,c);return c},drawLeafs:function(a,b){var c,d,e,f,g=this.stateGraphList,h=this._leafs,i=b,j=[],k=osg.Matrix;i&&osg.StateGraph.prototype.moveToRootStateGraph(a,b.parent);for(var l,m,n,o,p,q=0,r=h.length;r>q;q++)l=h[q],m=!1,void 0!==i?(n=i.parent,o=n.parent,p=l.parent,o!==p.parent?(p.moveStateGraph(a,o,p.parent),a.pushStateSet(p.stateset),m=!0):p!==n&&(a.pushStateSet(p.stateset),m=!0)):(l.parent.moveStateGraph(a,void 0,l.parent.parent),a.pushStateSet(l.parent.stateset),m=!0),m===!0&&(a.apply(),f=a.getLastProgramApplied(),d=f.uniformsCache[a.modelViewMatrix.name],e=f.uniformsCache[a.projectionMatrix.name],c=f.uniformsCache[a.normalMatrix.name]),void 0!==d&&(a.modelViewMatrix.set(l.modelview),a.modelViewMatrix.apply(d)),void 0!==e&&(a.projectionMatrix.set(l.projection),a.projectionMatrix.apply(e)),void 0!==c&&(k.copy(l.modelview,j),j[12]=0,j[13]=0,j[14]=0,k.inverse(j,j),k.transpose(j,j),a.normalMatrix.set(j),a.normalMatrix.apply(c)),l.geometry.drawImplementation(a),m===!0&&(a.popGeneratedProgram(),a.popStateSet()),i=l;for(var s=0,t=g.length;t>s;s++)for(var u=g[s],v=0,w=u.leafs.length;w>v;v++)l=u.leafs[v],m=!1,void 0!==i?(n=i.parent,o=n.parent,p=l.parent,o!==p.parent?(p.moveStateGraph(a,o,p.parent),a.pushStateSet(p.stateset),m=!0):p!==n&&(a.pushStateSet(p.stateset),m=!0)):(l.parent.moveStateGraph(a,void 0,l.parent.parent),a.pushStateSet(l.parent.stateset),m=!0),m===!0&&(a.apply(),f=a.getLastProgramApplied(),d=f.uniformsCache[a.modelViewMatrix.name],e=f.uniformsCache[a.projectionMatrix.name],c=f.uniformsCache[a.normalMatrix.name]),void 0!==d&&(a.modelViewMatrix.set(l.modelview),a.modelViewMatrix.apply(d)),void 0!==e&&(a.projectionMatrix.set(l.projection),a.projectionMatrix.apply(e)),void 0!==c&&(k.copy(l.modelview,j),j[12]=0,j[13]=0,j[14]=0,k.inverse(j,j),k.transpose(j,j),a.normalMatrix.set(j),a.normalMatrix.apply(c)),l.geometry.drawImplementation(a),m===!0&&(a.popGeneratedProgram(),a.popStateSet()),i=l;return i}},osg.RenderStage=function(){osg.RenderBin.call(this),this.positionedAttribute=[],this.clearDepth=1,this.clearColor=[0,0,0,1],this.clearMask=osg.Camera.COLOR_BUFFER_BIT|osg.Camera.DEPTH_BUFFER_BIT,this.camera=void 0,this.viewport=void 0,this.preRenderList=[],this.postRenderList=[],this._renderStage=this},osg.RenderStage.prototype=osg.objectInehrit(osg.RenderBin.prototype,{reset:function(){osg.RenderBin.prototype.reset.call(this),this.preRenderList.length=0,this.postRenderList.length=0},setClearDepth:function(a){this.clearDepth=a},getClearDepth:function(){return this.clearDepth},setClearColor:function(a){this.clearColor=a},getClearColor:function(){return this.clearColor},setClearMask:function(a){this.clearMask=a},getClearMask:function(){return this.clearMask},setViewport:function(a){this.viewport=a},getViewport:function(){return this.viewport},setCamera:function(a){this.camera=a},addPreRenderStage:function(a,b){for(var c=0,d=this.preRenderList.length;d>c;c++){var e=this.preRenderList[c];if(b<e.order)break}c<this.preRenderList.length?this.preRenderList=this.preRenderList.splice(c,0,{order:b,renderStage:a}):this.preRenderList.push({order:b,renderStage:a})},addPostRenderStage:function(a,b){for(var c=0,d=this.postRenderList.length;d>c;c++){var e=this.postRenderList[c];if(b<e.order)break}c<this.postRenderList.length?this.postRenderList=this.postRenderList.splice(c,0,{order:b,renderStage:a}):this.postRenderList.push({order:b,renderStage:a})},drawPreRenderStages:function(a,b){for(var c=b,d=0,e=this.preRenderList.length;e>d;++d){var f=this.preRenderList[d].renderStage;c=f.draw(a,c)}return c},draw:function(a,b){var c=this.drawPreRenderStages(a,b);return c=this.drawImplementation(a,c),c=this.drawPostRenderStages(a,c)},sort:function(){for(var a=0,b=this.preRenderList.length;b>a;++a)this.preRenderList[a].renderStage.sort();for(osg.RenderBin.prototype.sort.call(this),this.postRenderList.length;b>a;++a)this.postRenderList[a].renderStage.sort()},drawPostRenderStages:function(a,b){for(var c=b,d=0,e=this.postRenderList.length;e>d;++d){var f=this.postRenderList[d].renderStage;c=f.draw(a,c)}return c},applyCamera:function(a){var b=a.getGraphicContext();if(void 0===this.camera)return b.bindFramebuffer(b.FRAMEBUFFER,null),void 0;var c=this.camera.getViewport(),d=this.camera.frameBufferObject;if(d||(d=new osg.FrameBufferObject,this.camera.frameBufferObject=d),d.isDirty()&&void 0!==this.camera.attachments)for(var e in this.camera.attachments){var f,g=this.camera.attachments[e];void 0===g.texture?f={attachment:e,format:g.format,width:c.width(),height:c.height()}:void 0!==g.texture&&(f={attachment:e,texture:g.texture,level:g.level},g.format&&(f.format=g.format)),d.setAttachment(f)}d.apply(a)},drawImplementation:function(a,b){var c=a.getGraphicContext();this.applyCamera(a),void 0===this.viewport&&osg.log("RenderStage does not have a valid viewport"),a.applyAttribute(this.viewport),this.clearMask&c.COLOR_BUFFER_BIT&&c.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),this.clearMask&c.DEPTH_BUFFER_BIT&&(c.depthMask(!0),c.clearDepth(this.clearDepth)),c.clear(this.clearMask),this.positionedAttribute&&this.applyPositionedAttribute(a,this.positionedAttribute);var d=osg.RenderBin.prototype.drawImplementation.call(this,a,b);return d}}),osg.ShaderGenerator=function(){this.cache=[]},osg.ShaderGenerator.prototype={getActiveTypeMember:function(a){for(var b=[],c=0,d=a.attributeMap.attributeKeys.length;d>c;c++){var e=a.attributeMap.attributeKeys[c],f=a.attributeMap[e];(0!==f.length||void 0!==f.globalDefault.applyPositionedUniform)&&(void 0!==f.globalDefault.getOrCreateUniforms||void 0!==f.globalDefault.writeToShader)&&b.push(e)}for(var g=0,h=a.textureAttributeMapList.length;h>g;g++){var i=a.textureAttributeMapList[g];if(void 0!==i)for(var j=0,k=i.attributeKeys.length;k>j;j++){var l=i.attributeKeys[j],m=i[l];0!==m.length&&(void 0!==m.globalDefault.getOrCreateUniforms||void 0!==m.globalDefault.writeToShader)&&b.push(l+g)}}return b},getActiveAttributeMapKeys:function(a){for(var b=[],c=0,d=a.attributeMap.attributeKeys.length;d>c;c++){var e=a.attributeMap.attributeKeys[c],f=a.attributeMap[e];(0!==f.length||void 0!==f.globalDefault.applyPositionedUniform)&&(void 0!==f.globalDefault.getOrCreateUniforms||void 0!==f.globalDefault.writeToShader)&&b.push(e)}return b},getActiveTextureAttributeMapKeys:function(a){for(var b=[],c=0,d=a.textureAttributeMapList.length;d>c;c++){var e=a.textureAttributeMapList[c];if(void 0!==e){b[c]=[];for(var f=0,g=e.attributeKeys.length;g>f;f++){var h=e.attributeKeys[f],i=e[h];0!==i.length&&(void 0!==i.globalDefault.getOrCreateUniforms||void 0!==i.globalDefault.writeToShader)&&b[c].push(h)}}}return b},getActiveUniforms:function(a,b,c){for(var d={},e=0,f=b.length;f>e;e++){var g=b[e];if(void 0!==a.attributeMap[g].globalDefault.getOrCreateUniforms)for(var h=a.attributeMap[g].globalDefault.getOrCreateUniforms(),i=0,j=h.uniformKeys.length;j>i;i++){var k=h.uniformKeys[i],l=h[k];d[l.name]=l}}for(var m=0,n=c.length;n>m;m++){var o=c[m];if(void 0!==o)for(var p=0,q=o.length;q>p;p++){var r=o[p],s=a.textureAttributeMapList[m][r].globalDefault;if(void 0!==s.getOrCreateUniforms)for(var t=s.getOrCreateUniforms(m),u=0,v=t.uniformKeys.length;v>u;u++){var w=t.uniformKeys[u],x=t[w];d[x.name]=x}}}var y=[];for(var z in d)y.push(z);return d.uniformKeys=y,d},getOrCreateProgram:function(a){for(var b=this.getActiveTypeMember(a),c=0,d=this.cache.length;d>c;++c)if(0===this.compareAttributeMap(b,this.cache[c].flattenKeys))return this.cache[c];var e=this.getActiveAttributeMapKeys(a),f=this.getActiveTextureAttributeMapKeys(a),g=this.getOrCreateVertexShader(a,e,f),h=this.getOrCreateFragmentShader(a,e,f),i=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,g),new osg.Shader(gl.FRAGMENT_SHADER,h));return i.flattenKeys=b,i.activeAttributeKeys=e,i.activeTextureAttributeKeys=f,i.activeUniforms=this.getActiveUniforms(a,e,f),i.generated=!0,osg.log(i.vertex.text),osg.log(i.fragment.text),this.cache.push(i),i},compareAttributeMap:function(a,b){for(var c,d=0,e=a.length;e>d;d++)if(c=a[d],-1===b.indexOf(c))return 1;return b.length!==a.length?-1:0},fillTextureShader:function(a,b,c){for(var d="",e={},f=0,g=b.length;g>f;f++){var h=b[f];if(void 0!==h)for(var i=a[f],j=0,k=h.length;k>j;j++){var l=h[j],m=i[l].globalDefault;void 0!==m.generateShaderCommon&&void 0===e[l]&&(d+=m.generateShaderCommon(f,c),e[l]=!0),m.generateShader&&(d+=m.generateShader(f,c))}}return d},fillShader:function(a,b,c){for(var d="",e={},f=0,g=b.length;g>f;f++){var h=b[f],i=a[h].globalDefault,j=i.getType();void 0!==i.generateShaderCommon&&void 0===e[j]&&(d+=i.generateShaderCommon(c),e[j]=!0),i.generateShader&&(d+=i.generateShader(c))}return d},getOrCreateVertexShader:function(a,b,c){var d=osg.ShaderGeneratorType,e=["","#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","attribute vec3 Normal;","uniform float ArrayColorEnabled;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","uniform mat4 NormalMatrix;","varying vec4 VertexColor;",""].join("\n");e+=this._writeShaderFromMode(a,b,c,d.VertexInit);var f=["","vec4 ftransform() {","  return ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n");e+=f,e+=this._writeShaderFromMode(a,b,c,d.VertexFunction);var g=["","void main(void) {","  gl_Position = ftransform();","  if (ArrayColorEnabled == 1.0)","    VertexColor = Color;","  else","    VertexColor = vec4(1.0,1.0,1.0,1.0);","  gl_PointSize = 1.0;",""].join("\n");return e+=g,e+=this._writeShaderFromMode(a,b,c,d.VertexMain),e+=["}",""].join("\n")},_writeShaderFromMode:function(a,b,c,d){var e="";return e+=this.fillTextureShader(a.textureAttributeMapList,c,d),e+=this.fillShader(a.attributeMap,b,d)},getOrCreateFragmentShader:function(a,b,c){var d=["","#ifdef GL_ES","precision highp float;","#endif","varying vec4 VertexColor;","uniform float ArrayColorEnabled;","vec4 fragColor;",""].join("\n"),e=osg.ShaderGeneratorType;return d+=this._writeShaderFromMode(a,b,c,e.FragmentInit),d+=this._writeShaderFromMode(a,b,c,e.FragmentFunction),d+=["void main(void) {","  fragColor = VertexColor;",""].join("\n"),d+=this._writeShaderFromMode(a,b,c,e.FragmentMain),d+=this._writeShaderFromMode(a,b,c,e.FragmentEnd),d+=["","  gl_FragColor = fragColor;","}"].join("\n")}},osg.createTexturedBoxGeometry=function(a,b,c,d,e,f){var g,h,i,j=new osg.Geometry;g=d/2,h=e/2,i=f/2;var k=[],l=[],m=[];k[0]=a-g,k[1]=b-h,k[2]=c+i,m[0]=0,m[1]=-1,m[2]=0,l[0]=0,l[1]=1,k[3]=a-g,k[4]=b-h,k[5]=c-i,m[3]=0,m[4]=-1,m[5]=0,l[2]=0,l[3]=0,k[6]=a+g,k[7]=b-h,k[8]=c-i,m[6]=0,m[7]=-1,m[8]=0,l[4]=1,l[5]=0,k[9]=a+g,k[10]=b-h,k[11]=c+i,m[9]=0,m[10]=-1,m[11]=0,l[6]=1,l[7]=1,k[12]=a+g,k[13]=b+h,k[14]=c+i,m[12]=0,m[13]=1,m[14]=0,l[8]=0,l[9]=1,k[15]=a+g,k[16]=b+h,k[17]=c-i,m[15]=0,m[16]=1,m[17]=0,l[10]=0,l[11]=0,k[18]=a-g,k[19]=b+h,k[20]=c-i,m[18]=0,m[19]=1,m[20]=0,l[12]=1,l[13]=0,k[21]=a-g,k[22]=b+h,k[23]=c+i,m[21]=0,m[22]=1,m[23]=0,l[14]=1,l[15]=1,k[24]=a+g,k[25]=b-h,k[26]=c+i,m[24]=1,m[25]=0,m[26]=0,l[16]=0,l[17]=1,k[27]=a+g,k[28]=b-h,k[29]=c-i,m[27]=1,m[28]=0,m[29]=0,l[18]=0,l[19]=0,k[30]=a+g,k[31]=b+h,k[32]=c-i,m[30]=1,m[31]=0,m[32]=0,l[20]=1,l[21]=0,k[33]=a+g,k[34]=b+h,k[35]=c+i,m[33]=1,m[34]=0,m[35]=0,l[22]=1,l[23]=1,k[36]=a-g,k[37]=b+h,k[38]=c+i,m[36]=-1,m[37]=0,m[38]=0,l[24]=0,l[25]=1,k[39]=a-g,k[40]=b+h,k[41]=c-i,m[39]=-1,m[40]=0,m[41]=0,l[26]=0,l[27]=0,k[42]=a-g,k[43]=b-h,k[44]=c-i,m[42]=-1,m[43]=0,m[44]=0,l[28]=1,l[29]=0,k[45]=a-g,k[46]=b-h,k[47]=c+i,m[45]=-1,m[46]=0,m[47]=0,l[30]=1,l[31]=1,k[48]=a-g,k[49]=b+h,k[50]=c+i,m[48]=0,m[49]=0,m[50]=1,l[32]=0,l[33]=1,k[51]=a-g,k[52]=b-h,k[53]=c+i,m[51]=0,m[52]=0,m[53]=1,l[34]=0,l[35]=0,k[54]=a+g,k[55]=b-h,k[56]=c+i,m[54]=0,m[55]=0,m[56]=1,l[36]=1,l[37]=0,k[57]=a+g,k[58]=b+h,k[59]=c+i,m[57]=0,m[58]=0,m[59]=1,l[38]=1,l[39]=1,k[60]=a+g,k[61]=b+h,k[62]=c-i,m[60]=0,m[61]=0,m[62]=-1,l[40]=0,l[41]=1,k[63]=a+g,k[64]=b-h,k[65]=c-i,m[63]=0,m[64]=0,m[65]=-1,l[42]=0,l[43]=0,k[66]=a-g,k[67]=b-h,k[68]=c-i,m[66]=0,m[67]=0,m[68]=-1,l[44]=1,l[45]=0,k[69]=a-g,k[70]=b+h,k[71]=c-i,m[69]=0,m[70]=0,m[71]=-1,l[46]=1,l[47]=1;var n=[];n[0]=0,n[1]=1,n[2]=2,n[3]=0,n[4]=2,n[5]=3,n[6]=4,n[7]=5,n[8]=6,n[9]=4,n[10]=6,n[11]=7,n[12]=8,n[13]=9,n[14]=10,n[15]=8,n[16]=10,n[17]=11,n[18]=12,n[19]=13,n[20]=14,n[21]=12,n[22]=14,n[23]=15,n[24]=16,n[25]=17,n[26]=18,n[27]=16,n[28]=18,n[29]=19,n[30]=20,n[31]=21,n[32]=22,n[33]=20,n[34]=22,n[35]=23,j.getAttributes().Vertex=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,k,3),j.getAttributes().Normal=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,m,3),j.getAttributes().TexCoord0=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,l,2);var o=new osg.DrawElements(osg.PrimitiveSet.TRIANGLES,new osg.BufferArray(osg.BufferArray.ELEMENT_ARRAY_BUFFER,n,1));return j.getPrimitives().push(o),j},osg.createTexturedQuadGeometry=function(a,b,c,d,e,f,g,h,i,j,k,l,m){void 0===l&&void 0===m&&(l=j,m=k,j=0,k=0);var n=new osg.Geometry,o=[];o[0]=a+g,o[1]=b+h,o[2]=c+i,o[3]=a,o[4]=b,o[5]=c,o[6]=a+d,o[7]=b+e,o[8]=c+f,o[9]=a+d+g,o[10]=b+e+h,o[11]=c+f+i,void 0===l&&(l=1),void 0===m&&(m=1);var p=[];p[0]=j,p[1]=m,p[2]=j,p[3]=k,p[4]=l,p[5]=k,p[6]=l,p[7]=m;var q=osg.Vec3.cross([d,e,f],[g,h,i],[]),r=[];r[0]=q[0],r[1]=q[1],r[2]=q[2],r[3]=q[0],r[4]=q[1],r[5]=q[2],r[6]=q[0],r[7]=q[1],r[8]=q[2],r[9]=q[0],r[10]=q[1],r[11]=q[2];var s=[];s[0]=0,s[1]=1,s[2]=2,s[3]=0,s[4]=2,s[5]=3,n.getAttributes().Vertex=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,o,3),n.getAttributes().Normal=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,r,3),n.getAttributes().TexCoord0=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,p,2);var t=new osg.DrawElements(osg.PrimitiveSet.TRIANGLES,new osg.BufferArray(osg.BufferArray.ELEMENT_ARRAY_BUFFER,s,1));return n.getPrimitives().push(t),n},osg.createTexturedBox=function(a,b,c,d,e,f){return osg.log("osg.createTexturedBox is deprecated use instead osg.createTexturedBoxGeometry"),osg.createTexturedBoxGeometry(a,b,c,d,e,f)},osg.createTexturedQuad=function(a,b,c,d,e,f,g,h,i,j,k,l,m){return osg.log("osg.createTexturedQuad is deprecated use instead osg.createTexturedQuadGeometry"),osg.createTexturedQuadGeometry(a,b,c,d,e,f,g,h,i,j,k,l,m)},osg.createAxisGeometry=function(a){void 0===a&&(a=5),void 0===osg.createAxisGeometry.getShader&&(osg.createAxisGeometry.getShader=function(){if(void 0===osg.createAxisGeometry.getShader.program){var a=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","","varying vec4 FragColor;","","vec4 ftransform() {","return ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);","}","","void main(void) {","gl_Position = ftransform();","FragColor = Color;","}"].join("\n"),b=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 FragColor;","void main(void) {","gl_FragColor = FragColor;","}"].join("\n"),c=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,a),new osg.Shader(gl.FRAGMENT_SHADER,b));osg.createAxisGeometry.getShader.program=c}return osg.createAxisGeometry.getShader.program});var b=new osg.Geometry,c=[];c.push(0,0,0),c.push(a,0,0),c.push(0,0,0),c.push(0,a,0),c.push(0,0,0),c.push(0,0,a);var d=[];d.push(1,0,0,1),d.push(1,0,0,1),d.push(0,1,0,1),d.push(0,1,0,1),d.push(0,0,1,1),d.push(0,0,1,1),b.getAttributes().Vertex=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,c,3),b.getAttributes().Color=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,d,4);var e=new osg.DrawArrays(osg.PrimitiveSet.LINES,0,6);return b.getPrimitives().push(e),b.getOrCreateStateSet().setAttributeAndMode(osg.createAxisGeometry.getShader()),b},osg.createTexturedSphere=function(a,b,c,d,e,f,g){a=a||50,d=void 0!==d?d:0,e=void 0!==e?e:2*Math.PI,f=void 0!==f?f:0,g=void 0!==g?g:Math.PI;var h,i,j=Math.max(3,Math.floor(b)||8),k=Math.max(2,Math.floor(c)||6),l=[],m=[],n=[],o=[];for(i=0;k>=i;i++){var p=[],q=[];for(h=0;j>=h;h++){var r=h/j,s=i/k,t={};t.x=-a*Math.cos(d+r*e)*Math.sin(f+s*g),t.y=a*Math.cos(f+s*g),t.z=a*Math.sin(d+r*e)*Math.sin(f+s*g),n.push(t),p.push(n.length-1),q.push({u:r,v:1-s})}l.push(p),m.push(q)}var u=[],v=[],w=[],x=0;for(i=0;k>i;i++)for(h=0;j>h;h++){var y={},z={},A={},B={},y=l[i][h+1],z=l[i][h],A=l[i+1][h],B=l[i+1][h+1],C=n[y],D=n[z],E=n[A],F=n[B];
u.push(C.x),u.push(C.y),u.push(C.z),u.push(D.x),u.push(D.y),u.push(D.z),u.push(E.x),u.push(E.y),u.push(E.z),u.push(F.x),u.push(F.y),u.push(F.z),x+=4;var G=x-4;o.push(G),o.push(G+1),o.push(G+2),o.push(G),o.push(G+2),o.push(G+3);var H=osg.Vec3.normalize([C.x,C.y,C.z],[]),I=osg.Vec3.normalize([D.x,D.y,D.z],[]),J=osg.Vec3.normalize([E.x,E.y,E.z],[]),K=osg.Vec3.normalize([F.x,F.y,F.z],[]);v.push(H[0]),v.push(H[1]),v.push(H[2]),v.push(I[0]),v.push(I[1]),v.push(I[2]),v.push(J[0]),v.push(J[1]),v.push(J[2]),v.push(K[0]),v.push(K[1]),v.push(K[2]);var L=m[i][h+1],M=m[i][h],N=m[i+1][h],O=m[i+1][h+1];w.push(L.u),w.push(L.v),w.push(M.u),w.push(M.v),w.push(N.u),w.push(N.v),w.push(O.u),w.push(O.v)}var P=new osg.Geometry;P.getAttributes().Vertex=new osg.BufferArray(gl.ARRAY_BUFFER,u,3),P.getAttributes().Normal=new osg.BufferArray(gl.ARRAY_BUFFER,v,3),P.getAttributes().TexCoord0=new osg.BufferArray(gl.ARRAY_BUFFER,w,2);var Q=new osg.DrawElements(gl.TRIANGLES,new osg.BufferArray(gl.ELEMENT_ARRAY_BUFFER,o,1));return P.getPrimitives().push(Q),P},osg.Stack=function(){},osg.Stack.create=function(){var a=[];return a.globalDefault=void 0,a.lastApplied=void 0,a.back=function(){return this[this.length-1]},a},osg.StateGraph=function(){this.depth=0,this.children={},this.children.keys=[],this.leafs=[],this.stateset=void 0,this.parent=void 0},osg.StateGraph.prototype={clean:function(){this.leafs.splice(0,this.leafs.length),this.stateset=void 0,this.parent=void 0,this.depth=0;for(var a,b=this.children.keys,c=0,d=b.length;d>c;c++)a=b[c],this.children[a].clean(),osg.memoryPools.stateGraph.put(this.children[a]);this.children={},b.splice(0,b.length),this.children.keys=b},getStateSet:function(){return this.stateset},findOrInsert:function(a){var b;return this.children[a.id]?b=this.children[a.id]:(b=osg.memoryPools.stateGraph.get(),b.parent=this,b.depth=this.depth+1,b.stateset=a,this.children[a.id]=b,this.children.keys.push(a.id)),b},moveToRootStateGraph:function(a,b){for(;b;)b.stateSet&&a.popStateSet(),b=b._parent},moveStateGraph:function(a,b,c){var d,e;if(c!==b&&void 0!==c)if(void 0!==b){if(b.parent===c.parent)return void 0!==b.stateset&&a.popStateSet(),void 0!==c.stateset&&a.pushStateSet(c.stateset),void 0;for(;b.depth>c.depth;)void 0!==b.stateset&&a.popStateSet(),b=b.parent;for(d=[];c.depth>b.depth;)void 0!==c.stateset&&d.push(c.stateset),c=c.parent;for(;b!==c;)void 0!==b.stateset&&a.popStateSet(),b=b.parent,void 0!==c.stateset&&d.push(c.stateset),c=c.parent;for(d.reverse(),stackLength=d.length,e=0;stackLength>e;++e)a.pushStateSet(d[e])}else{d=[];do void 0!==c.stateset&&d.push(c.stateset),c=c.parent;while(c);for(d.reverse(),e=0,l=d.length;l>e;++e)a.pushStateSet(d[e])}}},osg.State=function(){this._graphicContext=void 0,this.currentVBO=null,this.vertexAttribList=[],this.programs=osg.Stack.create(),this.stateSets=osg.Stack.create(),this.uniforms={},this.uniforms.uniformKeys=[],this.textureAttributeMapList=[],this.attributeMap={},this.attributeMap.attributeKeys=[],this.modeMap={},this.shaderGenerator=new osg.ShaderGenerator,this.modelViewMatrix=osg.Uniform.createMatrix4(osg.Matrix.makeIdentity([]),"ModelViewMatrix"),this.projectionMatrix=osg.Uniform.createMatrix4(osg.Matrix.makeIdentity([]),"ProjectionMatrix"),this.normalMatrix=osg.Uniform.createMatrix4(osg.Matrix.makeIdentity([]),"NormalMatrix"),this.uniforms.ArrayColorEnabled=osg.Stack.create(),this.uniforms.ArrayColorEnabled.globalDefault=osg.Uniform.createFloat1(0,"ArrayColorEnabled"),this.uniforms.ArrayColorEnabled.uniformKeys=[],this.uniforms.ArrayColorEnabled.uniformKeys.push("ArrayColorEnabled"),this.vertexAttribMap={},this.vertexAttribMap._disable=[],this.vertexAttribMap._keys=[]},osg.State.prototype={setGraphicContext:function(a){this._graphicContext=a},getGraphicContext:function(){return this._graphicContext},pushStateSet:function(a){if(this.stateSets.push(a),a.attributeMap&&this.pushAttributeMap(this.attributeMap,a.attributeMap),a.textureAttributeMapList)for(var b=a.textureAttributeMapList,c=0,d=b.length;d>c;c++)void 0!==b[c]&&(this.textureAttributeMapList[c]||(this.textureAttributeMapList[c]={},this.textureAttributeMapList[c].attributeKeys=[]),this.pushAttributeMap(this.textureAttributeMapList[c],b[c]));a.uniforms&&this.pushUniformsList(this.uniforms,a.uniforms)},applyStateSet:function(a){this.pushStateSet(a),this.apply(),this.popStateSet()},popAllStateSets:function(){for(;this.stateSets.length;)this.popStateSet()},popStateSet:function(){var a=this.stateSets.pop();if(a.program&&this.programs.pop(),a.attributeMap&&this.popAttributeMap(this.attributeMap,a.attributeMap),a.textureAttributeMapList)for(var b=a.textureAttributeMapList,c=0,d=b.length;d>c;c++)void 0!==b[c]&&this.popAttributeMap(this.textureAttributeMapList[c],b[c]);a.uniforms&&this.popUniformsList(this.uniforms,a.uniforms)},haveAppliedAttribute:function(a){var b=a.getTypeMember(),c=this.attributeMap[b];c.lastApplied=a,c.asChanged=!0},applyAttribute:function(a){var b=a.getTypeMember(),c=this.attributeMap[b];void 0===c&&(c=osg.Stack.create(),this.attributeMap[b]=c,this.attributeMap[b].globalDefault=a.cloneType(),this.attributeMap.attributeKeys.push(b)),c.lastApplied!==a&&(a.apply&&a.apply(this),c.lastApplied=a,c.asChanged=!0)},applyTextureAttribute:function(a,b){var c=this.getGraphicContext();c.activeTexture(c.TEXTURE0+a);var d=b.getTypeMember();this.textureAttributeMapList[a]||(this.textureAttributeMapList[a]={},this.textureAttributeMapList[a].attributeKeys=[]);var e=this.textureAttributeMapList[a][d];void 0===e&&(e=osg.Stack.create(),this.textureAttributeMapList[a][d]=e,e.globalDefault=b.cloneType(),this.textureAttributeMapList[a].attributeKeys.push(d)),e.lastApplied!==b&&(b.apply&&b.apply(this),e.lastApplied=b,e.asChanged=!0)},getLastProgramApplied:function(){return this.programs.lastApplied},pushGeneratedProgram:function(){var a;if(void 0!==this.attributeMap.Program&&0!==this.attributeMap.Program.length&&(a=this.attributeMap.Program.back().object,value=this.attributeMap.Program.back().value,void 0!==a&&value!==osg.StateAttribute.OFF))return this.programs.push(this.getObjectPair(a,value)),a;var b={textureAttributeMapList:this.textureAttributeMapList,attributeMap:this.attributeMap},c=this.stateSets.back().getShaderGenerator();return void 0===c&&(c=this.shaderGenerator),a=c.getOrCreateProgram(b),this.programs.push(this.getObjectPair(a,osg.StateAttribute.ON)),a},popGeneratedProgram:function(){this.programs.pop()},applyWithoutProgram:function(){this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList)},apply:function(){var a=this._graphicContext;this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList),this.pushGeneratedProgram();var c=this.programs.back().object;this.programs.lastApplied!==c&&(c.apply(this),this.programs.lastApplied=c);var d,e,f,g,h,i=this;if(c.generated===!0){d=c.uniformsCache,e=c.activeUniforms;h=this.uniforms,function(){var a=c.uniformsCache,b=c.activeUniforms,d=c.foreignUniforms;d||(!function(){d=[];for(var e=0,f=a.uniformKeys.length;f>e;e++){var g=a.uniformKeys[e],h=a[g];void 0!==h&&void 0===b[g]&&g!==i.modelViewMatrix.name&&g!==i.projectionMatrix.name&&g!==i.normalMatrix.name&&"ArrayColorEnabled"!==g&&d.push(g)}c.foreignUniforms=d}(),function(){for(var c=0,d=b.uniformKeys.length;d>c;c++){var e=b.uniformKeys[c],f=a[e];(void 0===f||null===f)&&delete b[e]}for(var g=Object.keys(b),h=0,i=g.length;i>h;h++)if("uniformKeys"===g[h]){g.splice(h,1);break}b.uniformKeys=g}()),function(){for(var c=0,d=b.uniformKeys.length;d>c;c++){var e=b.uniformKeys[c],f=a[e];b[e].apply(f)}}(),function(){for(var b=0,c=d.length;c>b;b++){var e,f=d[b],g=h[f],i=a[f];void 0!==g&&(e=0===g.length?g.globalDefault:g.back().object,e.apply(i))}}()}()}else{var j,k,m,n=c.program;d=c.uniformsCache,h=this.uniforms,e=[];var o,p,q,r=c.trackAttributes,s=c.trackUniforms;if(void 0!==r&&void 0===s){var t=c.trackAttributes.attributeKeys;if(void 0!==t)for(f=0,l=t.length;l>f;f++)if(g=t[f],attributeStack=this.attributeMap[g],void 0!==attributeStack&&(o=attributeStack.globalDefault,void 0!==o.getOrCreateUniforms))for(p=o.getOrCreateUniforms(),q=0,b=p.uniformKeys.length;b>q;q++)e.push(p[p.uniformKeys[q]]);var u=c.trackAttributes.textureAttributeKeys;if(void 0!==u)for(f=0,l=u.length;l>f;f++){var v=u[f];if(void 0!==v)for(var w=0,x=v.length;x>w;w++){g=v[w];var y=this.textureAttributeMapList[f];if(void 0!==y&&(attributeStack=y[g],void 0!==attributeStack&&(o=attributeStack.globalDefault,void 0!==o.getOrCreateUniforms)))for(p=o.getOrCreateUniforms(f),q=0,b=p.uniformKeys.length;b>q;q++)e.push(p[p.uniformKeys[q]])}}var z={};for(f=0,l=e.length;l>f;f++){var A=e[f],B=a.getUniformLocation(n,A.name);void 0!==B&&null!==B&&(z[A.name]=e[f])}c.trackUniforms=z}for(f=0,l=d.uniformKeys.length;l>f;f++){var C=d.uniformKeys[f];j=d[C],k=h[C],void 0===k?void 0!==c.trackUniforms&&(m=c.trackUniforms[C],void 0!==m&&m.apply(j)):(m=0===k.length?k.globalDefault:k.back().object,m.apply(j))}}},applyUniformList:function(a,b){var c=this.getLastProgramApplied();c.program;for(var d,e,f,g=c.uniformsCache,h=0,i=g.uniformKeys.length;i>h;h++){var j=g.uniformKeys[h];if(d=g[j],f=b[j],void 0===f){if(e=a[j],void 0===e)continue;f=0===e.length?e.globalDefault:e.back().object}f.apply(d)}},applyAttributeMap:function(a){for(var b,c=0,d=a.attributeKeys.length;d>c;c++){var e=a.attributeKeys[c];if(b=a[e],void 0!==b){var f;f=0===b.length?b.globalDefault:b.back().object,b.asChanged&&(b.lastApplied!==f&&(f.apply&&f.apply(this),b.lastApplied=f),b.asChanged=!1)}}},getObjectPair:function(a,b){return{object:a,value:b}},pushUniformsList:function(a,b){for(var c,d,e=0,f=b.uniformKeys.length;f>e;e++){var g=b.uniformKeys[e];uniformPair=b[g],d=uniformPair.getUniform(),c=d.name,void 0===a[c]&&(a[c]=osg.Stack.create(),a[c].globalDefault=d,a.uniformKeys.push(c));var h=uniformPair.getValue(),i=a[c];0===i.length?i.push(this.getObjectPair(d,h)):i[i.length-1].value&osg.StateAttribute.OVERRIDE&&!(h&osg.StateAttribute.PROTECTED)?i.push(i[i.length-1]):i.push(this.getObjectPair(d,h))}},popUniformsList:function(a,b){for(var c=0,d=b.uniformKeys.length;d>c;c++){var e=b.uniformKeys[c];a[e].pop()}},applyTextureAttributeMapList:function(a){for(var b,c=this._graphicContext,d=0,e=a.length;e>d;d++)if(b=a[d],void 0!==b)for(var f=0,g=b.attributeKeys.length;g>f;f++){var h=b.attributeKeys[f],i=b[h];if(void 0!==i){var j;j=0===i.length?i.globalDefault:i.back().object,i.asChanged&&(c.activeTexture(c.TEXTURE0+d),j.apply(this,d),i.lastApplied=j,i.asChanged=!1)}}},setGlobalDefaultValue:function(a){var b=a.getTypeMember();this.attributeMap[b]?this.attributeMap[b].globalDefault=a:(this.attributeMap[b]=osg.Stack.create(),this.attributeMap[b].globalDefault=a,this.attributeMap.attributeKeys.push(b))},pushAttributeMap:function(a,b){for(var c,d=0,e=b.attributeKeys.length;e>d;d++){var f=b.attributeKeys[d],g=b[f],h=g.getAttribute();void 0===a[f]&&(a[f]=osg.Stack.create(),a[f].globalDefault=h.cloneType(),a.attributeKeys.push(f));var i=g.getValue();c=a[f],0===c.length?c.push(this.getObjectPair(h,i)):c[c.length-1].value&osg.StateAttribute.OVERRIDE&&!(i&osg.StateAttribute.PROTECTED)?c.push(c[c.length-1]):c.push(this.getObjectPair(h,i)),c.asChanged=!0}},popAttributeMap:function(a,b){for(var c,d=0,e=b.attributeKeys.length;e>d;d++)type=b.attributeKeys[d],c=a[type],c.pop(),c.asChanged=!0},setIndexArray:function(a){var b=this._graphicContext;this.currentIndexVBO!==a&&(a.bind(b),this.currentIndexVBO=a),a.isDirty()&&a.compile(b)},lazyDisablingOfVertexAttributes:function(){for(var a=this.vertexAttribMap._keys,b=0,c=a.length;c>b;b++){var d=a[b];this.vertexAttribMap[d]&&(this.vertexAttribMap._disable[d]=!0)}},applyDisablingOfVertexAttributes:function(){for(var a=this.vertexAttribMap._keys,b=0,c=a.length;c>b;b++)if(this.vertexAttribMap._disable[a[b]]===!0){var d=a[b];this._graphicContext.disableVertexAttribArray(d),this.vertexAttribMap._disable[d]=!1,this.vertexAttribMap[d]=!1}var e=this.programs.lastApplied;if(void 0!==e){var f=!1,g=!1;void 0!==e.attributesCache.Color&&(g=this.vertexAttribMap[e.attributesCache.Color]);var h=this.uniforms.ArrayColorEnabled.globalDefault;this.previousHasColorAttrib!==g&&(f=!0),this.previousHasColorAttrib=g,f&&(h.get()[0]=g?1:0,h.dirty()),h.apply(e.uniformsCache.ArrayColorEnabled)}},setVertexAttribArray:function(a,b,c){var d=this.vertexAttribMap;d._disable[a]=!1;var e=this._graphicContext,f=!1;b.isDirty()&&(b.bind(e),b.compile(e),f=!0),d[a]!==b&&(f||b.bind(e),d[a]||(e.enableVertexAttribArray(a),void 0===d[a]&&d._keys.push(a)),d[a]=b,e.vertexAttribPointer(a,b._itemSize,e.FLOAT,c,0,0))}},osg.StateSet=function(){osg.Object.call(this),this.id=osg.StateSet.instance++,this.attributeMap={},this.attributeMap.attributeKeys=[],this.textureAttributeMapList=[],this._binName=void 0,this._binNumber=0,this._shaderGenerator=void 0},osg.StateSet.instance=0,osg.StateSet.AttributePair=function(a,b){this._object=a,this._value=b},osg.StateSet.AttributePair.prototype={getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}},osg.StateSet.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Object.prototype,{getAttributePair:function(a,b){return new osg.StateSet.AttributePair(a,b)},addUniform:function(a,b){void 0===b&&(b=osg.StateAttribute.ON),this.uniforms||(this.uniforms={},this.uniforms.uniformKeys=[]);var c=a.name;this.uniforms[c]=this.getAttributePair(a,b),-1===this.uniforms.uniformKeys.indexOf(c)&&this.uniforms.uniformKeys.push(c)},getUniform:function(a){return this.uniforms&&this.uniforms[a]?this.uniforms[a].getAttribute():void 0},getUniformList:function(){return this.uniforms},setTextureAttributeAndMode:function(a,b,c){void 0===c&&(c=osg.StateAttribute.ON),this._setTextureAttribute(a,this.getAttributePair(b,c))},getNumTextureAttributeLists:function(){return this.textureAttributeMapList.length},getTextureAttribute:function(a,b){return void 0===this.textureAttributeMapList[a]||void 0===this.textureAttributeMapList[a][b]?void 0:this.textureAttributeMapList[a][b].getAttribute()},removeTextureAttribute:function(a,b){if(void 0!==this.textureAttributeMapList[a]&&void 0!==this.textureAttributeMapList[a][b]){delete this.textureAttributeMapList[a][b];var c=this.textureAttributeMapList[a].attributeKeys.indexOf(b);this.textureAttributeMapList[a].attributeKeys.splice(c,1)}},getAttribute:function(a){return void 0===this.attributeMap[a]?void 0:this.attributeMap[a].getAttribute()},setAttributeAndMode:function(a,b){void 0===b&&(b=osg.StateAttribute.ON),this._setAttribute(this.getAttributePair(a,b))},setAttribute:function(a,b){void 0===b&&(b=osg.StateAttribute.ON),this._setAttribute(this.getAttributePair(a,b))},removeAttribute:function(a){if(void 0!==this.attributeMap[a]){delete this.attributeMap[a];var b=this.attributeMap.attributeKeys.indexOf(a);this.attributeMap.attributeKeys.splice(b,1)}},setRenderingHint:function(a){"OPAQUE_BIN"===a?this.setRenderBinDetails(0,"RenderBin"):"TRANSPARENT_BIN"===a?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},setRenderBinDetails:function(a,b){this._binNumber=a,this._binName=b},getAttributeMap:function(){return this.attributeMap},getBinNumber:function(){return this._binNumber},getBinName:function(){return this._binName},setBinNumber:function(a){this._binNumber=a},setBinName:function(a){this._binName=a},getAttributeList:function(){for(var a=this.attributeMap,b=a.attributeKeys,c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},setShaderGenerator:function(a){this._shaderGenerator=a},getShaderGenerator:function(){return this._shaderGenerator},_getUniformMap:function(){return this.uniforms},_setTextureAttribute:function(a,b){void 0===this.textureAttributeMapList[a]&&(this.textureAttributeMapList[a]={},this.textureAttributeMapList[a].attributeKeys=[]);var c=b.getAttribute().getTypeMember();this.textureAttributeMapList[a][c]=b,-1===this.textureAttributeMapList[a].attributeKeys.indexOf(c)&&this.textureAttributeMapList[a].attributeKeys.push(c)},_setAttribute:function(a){var b=a.getAttribute().getTypeMember();this.attributeMap[b]=a,-1===this.attributeMap.attributeKeys.indexOf(b)&&this.attributeMap.attributeKeys.push(b)}}),"osg","StateSet"),osg.StateSet.prototype.setTextureAttributeAndModes=osg.StateSet.prototype.setTextureAttributeAndMode,osg.StateSet.prototype.setAttributeAndModes=osg.StateSet.prototype.setAttributeAndMode,osg.Texture=function(){osg.StateAttribute.call(this),this.setDefaultParameters()},osg.Texture.DEPTH_COMPONENT=6402,osg.Texture.ALPHA=6406,osg.Texture.RGB=6407,osg.Texture.RGBA=6408,osg.Texture.LUMINANCE=6409,osg.Texture.LUMINANCE_ALPHA=6410,osg.Texture.LINEAR=9729,osg.Texture.NEAREST=9728,osg.Texture.NEAREST_MIPMAP_NEAREST=9984,osg.Texture.LINEAR_MIPMAP_NEAREST=9985,osg.Texture.NEAREST_MIPMAP_LINEAR=9986,osg.Texture.LINEAR_MIPMAP_LINEAR=9987,osg.Texture.CLAMP_TO_EDGE=33071,osg.Texture.REPEAT=10497,osg.Texture.MIRRORED_REPEAT=33648,osg.Texture.TEXTURE_2D=3553,osg.Texture.TEXTURE_CUBE_MAP=34067,osg.Texture.TEXTURE_BINDING_CUBE_MAP=34068,osg.Texture.TEXTURE_CUBE_MAP_POSITIVE_X=34069,osg.Texture.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,osg.Texture.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,osg.Texture.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,osg.Texture.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,osg.Texture.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,osg.Texture.MAX_CUBE_MAP_TEXTURE_SIZE=34076,osg.Texture.UNSIGNED_BYTE=5121,osg.Texture.FLOAT=5126,osg.Texture.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Texture",cloneType:function(){var a=new osg.Texture;return a.default_type=!0,a},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getOrCreateUniforms:function(a){if(void 0===osg.Texture.uniforms&&(osg.Texture.uniforms=[]),void 0===osg.Texture.uniforms[a]){var b=this.getType()+a,c={};c.texture=osg.Uniform.createInt1(a,b),c.uniformKeys=Object.keys(c),osg.Texture.uniforms[a]=c}return osg.Texture.uniforms[a]},setDefaultParameters:function(){this._magFilter=osg.Texture.LINEAR,this._minFilter=osg.Texture.LINEAR,this._wrapS=osg.Texture.CLAMP_TO_EDGE,this._wrapT=osg.Texture.CLAMP_TO_EDGE,this._textureWidth=0,this._textureHeight=0,this._unrefImageDataAfterApply=!1,this.setInternalFormat(osg.Texture.RGBA),this._textureTarget=osg.Texture.TEXTURE_2D,this._type=osg.Texture.UNSIGNED_BYTE},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(a,b){this._textureWidth=a,this._textureHeight=b},init:function(a){this._textureObject||(this._textureObject=a.createTexture(),this.dirty())},getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(a){void 0!==this._textureObject&&null!==this._textureObject&&(a.deleteTexture(this._textureObject),this._textureObject=null,this._image=void 0)},setWrapS:function(a){this._wrapS="string"==typeof a?osg.Texture[a]:a},setWrapT:function(a){this._wrapT="string"==typeof a?osg.Texture[a]:a},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},getMinFilter:function(){return this._minFilter},getMagFilter:function(){return this._magFilter},setMinFilter:function(a){this._minFilter="string"==typeof a?osg.Texture[a]:a},setMagFilter:function(a){this._magFilter="string"==typeof a?osg.Texture[a]:a},setImage:function(a,b){this._image=a,this.setImageFormat(b),this.dirty()},getImage:function(){return this._image},setImageFormat:function(a){a?("string"==typeof a&&(a=osg.Texture[a]),this._imageFormat=a):this._imageFormat=osg.Texture.RGBA,this.setInternalFormat(this._imageFormat)},setType:function(a){this._type="string"==typeof a?osg.Texture[a]:a},setUnrefImageDataAfterApply:function(a){this._unrefImageDataAfterApply=a},setInternalFormat:function(a){this._internalFormat=a},getInternalFormat:function(){return this._internalFormat},setFromCanvas:function(a,b){this.setImage(a,b)},setFromTypedArray:function(a,b){this.setImage(a,b)},isImageReady:function(a){if(a)if(a instanceof Image){if(a.complete)return void 0!==a.naturalWidth&&0===a.naturalWidth?!1:!0}else{if(a instanceof HTMLCanvasElement)return!0;if(a instanceof Uint8Array)return!0}return!1},applyFilterParameter:function(a,b){var c=function(a){return 0!==a&&(a&~a+1)===a},d=c(this._textureWidth)&&c(this._textureHeight);d||(this.setWrapT(osg.Texture.CLAMP_TO_EDGE),this.setWrapS(osg.Texture.CLAMP_TO_EDGE),(this._minFilter===osg.Texture.LINEAR_MIPMAP_LINEAR||this._minFilter===osg.Texture.LINEAR_MIPMAP_NEAREST)&&this.setMinFilter(osg.Texture.LINEAR)),a.texParameteri(b,a.TEXTURE_MAG_FILTER,this._magFilter),a.texParameteri(b,a.TEXTURE_MIN_FILTER,this._minFilter),a.texParameteri(b,a.TEXTURE_WRAP_S,this._wrapS),a.texParameteri(b,a.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(a,b){(this._minFilter===a.NEAREST_MIPMAP_NEAREST||this._minFilter===a.LINEAR_MIPMAP_NEAREST||this._minFilter===a.NEAREST_MIPMAP_LINEAR||this._minFilter===a.LINEAR_MIPMAP_LINEAR)&&a.generateMipmap(b)},apply:function(a){var b=a.getGraphicContext();if(void 0===this._textureObject||this.isDirty())if(this.default_type)b.bindTexture(this._textureTarget,null);else{var c=this._image;void 0!==c?this.isImageReady(c)?(this._textureObject||this.init(b),this.setDirty(!1),b.bindTexture(this._textureTarget,this._textureObject),c instanceof Image?(this.setTextureSize(c.naturalWidth,c.naturalHeight),b.texImage2D(this._textureTarget,0,this._internalFormat,this._imageFormat,this._type,this._image)):c instanceof HTMLCanvasElement?(this.setTextureSize(c.width,c.height),b.texImage2D(this._textureTarget,0,this._internalFormat,this._imageFormat,this._type,this._image)):c instanceof Uint8Array&&b.texImage2D(this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,this._image),this.applyFilterParameter(b,this._textureTarget),this.generateMipmap(b,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=void 0)):b.bindTexture(this._textureTarget,null):0!==this._textureHeight&&0!==this._textureWidth&&(this._textureObject||this.init(b),b.bindTexture(this._textureTarget,this._textureObject),b.texImage2D(this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,null),this.applyFilterParameter(b,this._textureTarget),this.generateMipmap(b,this._textureTarget),this.setDirty(!1))}else b.bindTexture(this._textureTarget,this._textureObject)},setShaderGeneratorFunction:function(a,b){this[b]=a},generateShader:function(a,b){return this[b]?this[b].call(this,a):""}}),"osg","Texture"),osg.Texture.prototype[osg.ShaderGeneratorType.VertexInit]=function(a){var b="attribute vec2 TexCoord"+a+";\n";return b+="varying vec2 FragTexCoord"+a+";\n"},osg.Texture.prototype[osg.ShaderGeneratorType.VertexMain]=function(a){return"FragTexCoord"+a+" = TexCoord"+a+";\n"},osg.Texture.prototype[osg.ShaderGeneratorType.FragmentInit]=function(a){var b="varying vec2 FragTexCoord"+a+";\n";return b+="uniform sampler2D Texture"+a+";\n",b+="vec4 texColor"+a+";\n"},osg.Texture.prototype[osg.ShaderGeneratorType.FragmentMain]=function(a){var b="texColor"+a+" = texture2D( Texture"+a+", FragTexCoord"+a+".xy );\n";return b+="fragColor = fragColor * texColor"+a+";\n"},osg.Texture.createFromURL=function(a,b){var c=new osg.Texture;return osgDB.Promise.when(osgDB.readImage(a)).then(function(a){c.setImage(a,b)}),c},osg.Texture.createFromImg=function(a,b){var c=new osg.Texture;return c.setImage(a,b),c},osg.Texture.createFromImage=osg.Texture.createFromImg,osg.Texture.createFromCanvas=function(a,b){var c=new osg.Texture;return c.setFromCanvas(a,b),c},osg.Texture.create=function(a){return osg.log("osg.Texture.create is deprecated, use osg.Texture.createFromURL instead"),osg.Texture.createFromURL(a)},osg.TextureCubeMap=function(){osg.Texture.call(this),this._images={}},osg.TextureCubeMap.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Texture.prototype,{setDefaultParameters:function(){osg.Texture.prototype.setDefaultParameters.call(this),this._textureTarget=osg.Texture.TEXTURE_CUBE_MAP},cloneType:function(){var a=new osg.TextureCubeMap;return a.default_type=!0,a},setImage:function(a,b,c){"string"==typeof a&&(a=osg.Texture[a]),void 0===this._images[a]&&(this._images[a]={}),"string"==typeof c&&(c=osg.Texture[c]),void 0===c&&(c=osg.Texture.RGBA),this._images[a].image=b,this._images[a].format=c,this._images[a].dirty=!0,this.dirty()},getImage:function(a){return this._images[a].image},applyTexImage2D_load:function(a,b,c,d,e,f,g){return g?osg.Texture.prototype.isImageReady(g)?(g instanceof Image?this.setTextureSize(g.naturalWidth,g.naturalHeight):g instanceof HTMLCanvasElement&&this.setTextureSize(g.width,g.height),a.texImage2D(b,0,d,e,f,g),!0):!1:!1},_applyImageTarget:function(a,b,c){var d=this._images[c];return d?d.dirty?this.applyTexImage2D_load(a,c,0,b,d.format,a.UNSIGNED_BYTE,d.image)?(d.dirty=!1,this._unrefImageDataAfterApply&&delete this._images[c],1):0:1:0},apply:function(a){var b=a.getGraphicContext();if(void 0===this._textureObject||this.isDirty())if(this.default_type)b.bindTexture(this._textureTarget,null);else{this._images,this._textureObject||this.init(b),b.bindTexture(this._textureTarget,this._textureObject);var c=this._internalFormat,d=0;d+=this._applyImageTarget(b,c,b.TEXTURE_CUBE_MAP_POSITIVE_X),d+=this._applyImageTarget(b,c,b.TEXTURE_CUBE_MAP_NEGATIVE_X),d+=this._applyImageTarget(b,c,b.TEXTURE_CUBE_MAP_POSITIVE_Y),d+=this._applyImageTarget(b,c,b.TEXTURE_CUBE_MAP_NEGATIVE_Y),d+=this._applyImageTarget(b,c,b.TEXTURE_CUBE_MAP_POSITIVE_Z),d+=this._applyImageTarget(b,c,b.TEXTURE_CUBE_MAP_NEGATIVE_Z),6===d&&(this.setDirty(!1),this.applyFilterParameter(b,this._textureTarget),this.generateMipmap(b,this._textureTarget))}else b.bindTexture(this._textureTarget,this._textureObject)}}),"osg","TextureCubeMap"),osg.UpdateVisitor=function(){osg.NodeVisitor.call(this);var a=new osg.FrameStamp;this.getFrameStamp=function(){return a},this.setFrameStamp=function(b){a=b}},osg.UpdateVisitor.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{apply:function(a){for(var b=a.getUpdateCallbackList(),c=0;c<b.length;c++)if(!b[c].update(a,this))return;this.traverse(a)}}),osg.Viewport=function(a,b,c,d){osg.StateAttribute.call(this),void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=800),void 0===d&&(d=600),this._x=a,this._y=b,this._width=c,this._height=d,this._dirty=!0},osg.Viewport.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Viewport",cloneType:function(){return new osg.Viewport},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(a){var b=a.getGraphicContext();b.viewport(this._x,this._y,this._width,this._height),this._dirty=!1},setViewport:function(a,b,c,d){this._x=a,this._y=b,this._width=c,this._height=d,this.dirty()},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},computeWindowMatrix:function(){var a=osg.Matrix.makeTranslate(1,1,1),b=osg.Matrix.makeScale(.5*this._width,.5*this._height,.5),c=osg.Matrix.makeTranslate(this._x,this._y,0);return osg.Matrix.preMult(c,osg.Matrix.preMult(b,a))}}),"osg","Viewport"),osg.CullVisitor=function(){osg.NodeVisitor.call(this),osg.CullSettings.call(this),osg.CullStack.call(this),this._rootStateGraph=void 0,this._currentStateGraph=void 0,this._currentRenderBin=void 0,this._currentRenderStage=void 0,this._rootRenderStage=void 0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY;var a=[0,0,-1];this._bbCornerFar=(a[0]>=0?1:0)|(a[1]>=0?2:0)|(a[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar,this._reserveMatrixStack=[[]],this._reserveMatrixStack.current=0,this._reserveLeafStack=[{}],this._reserveLeafStack.current=0,this._renderBinStack=[]},osg.CullVisitor.prototype=osg.objectInehrit(osg.CullStack.prototype,osg.objectInehrit(osg.CullSettings.prototype,osg.objectInehrit(osg.NodeVisitor.prototype,{distance:function(a,b){return-(a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+b[14])},handleCullCallbacksAndTraverse:function(a){var b=a.getCullCallback();(!b||b.cull(a,this))&&this.traverse(a)},updateCalculatedNearFar:function(a,b){var c,d,e=b.getBoundingBox();if(c=this.distance(e.corner(this._bbCornerNear),a),d=this.distance(e.corner(this._bbCornerFar),a),c>d){var f=c;c=d,d=f}return 0>d?!1:(c<this._computedNear&&(this._computedNear=c),d>this._computedFar&&(this._computedFar=d),!0)},clampProjectionMatrix:function(a,b,c,d,e){var f=1e-6;if(b-f>c)return osg.log("clampProjectionMatrix not applied, invalid depth range, znear = "+b+"  zfar = "+c),!1;var g,h;if(b+f>c){var i=.5*(b+c);b=i-f,c=i+f}if(Math.abs(osg.Matrix.get(a,0,3))<f&&Math.abs(osg.Matrix.get(a,1,3))<f&&Math.abs(osg.Matrix.get(a,2,3))<f){var j=.02*(c-b);1>j&&(j=1),g=b-j,h=c+j,b=g,c=h,osg.Matrix.set(a,2,2,-2/(h-g)),osg.Matrix.set(a,3,2,-(h+g)/(h-g))}else{var k=1.02,l=.98;g=b*l,h=c*k;var m=c*d;m>g&&(g=m),b=g,c=h;var n=osg.Matrix.get(a,2,2),o=osg.Matrix.get(a,3,2),p=osg.Matrix.get(a,2,3),q=osg.Matrix.get(a,3,3),r=(-g*n+o)/(-g*p+q),s=(-h*n+o)/(-h*p+q),t=Math.abs(2/(r-s)),u=-(r+s)/2,v=[1,0,0,0,0,1,0,0,0,0,t,0,0,0,u*t,1];osg.Matrix.postMult(v,a)}return void 0!==e&&(e[0]=b,e[1]=c),!0},setStateGraph:function(a){this._rootStateGraph=a,this._currentStateGraph=a},setRenderStage:function(a){this._rootRenderStage=a,this._currentRenderBin=a},reset:function(){this._modelviewMatrixStack.splice(0,this._modelviewMatrixStack.length),this._projectionMatrixStack.splice(0,this._projectionMatrixStack.length),this._reserveMatrixStack.current=0,this._reserveLeafStack.current=0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(a){this._currentRenderBin=a},addPositionedAttribute:function(a){var b=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];this._currentRenderBin.getStage().positionedAttribute.push([b,a])},pushStateSet:function(a){if(this._currentStateGraph=this._currentStateGraph.findOrInsert(a),void 0!==a.getBinName()){var b=this._renderBinStack,c=this._currentRenderBin;b.push(c),this._currentRenderBin=c.getStage().findOrInsert(a.getBinNumber(),a.getBinName())}},popStateSet:function(){var a=this._currentStateGraph,b=a.getStateSet();if(this._currentStateGraph=a.parent,void 0!==b.getBinName()){var c=this._renderBinStack;this._currentRenderBin=0===c.length?this._currentRenderBin.getStage():c.pop()}},popProjectionMatrix:function(){if(this._computeNearFar===!0&&this._computedFar>=this._computedNear){var a=this._projectionMatrixStack[this._projectionMatrixStack.length-1];this.clampProjectionMatrix(a,this._computedNear,this._computedFar,this._nearFarRatio)}osg.CullStack.prototype.popProjectionMatrix.call(this)},apply:function(a){this[a.objectType].call(this,a)},_getReservedMatrix:function(){var a=this._reserveMatrixStack[this._reserveMatrixStack.current++];return this._reserveMatrixStack.current===this._reserveMatrixStack.length&&this._reserveMatrixStack.push(osg.Matrix.makeIdentity([])),a},_getReservedLeaf:function(){var a=this._reserveLeafStack[this._reserveLeafStack.current++];return this._reserveLeafStack.current===this._reserveLeafStack.length&&this._reserveLeafStack.push({}),a}}))),osg.CullVisitor.prototype[osg.Camera.prototype.objectType]=function(a){var b=a.getStateSet();b&&this.pushStateSet(b),a.light&&this.addPositionedAttribute(a.light),this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];var c=this._getReservedMatrix(),d=this._getReservedMatrix();if(a.getReferenceFrame()===osg.Transform.RELATIVE_RF){var e=this._projectionMatrixStack[this._projectionMatrixStack.length-1];osg.Matrix.mult(e,a.getProjectionMatrix(),d);var f=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];osg.Matrix.mult(f,a.getViewMatrix(),c)}else osg.Matrix.copy(a.getViewMatrix(),c),osg.Matrix.copy(a.getProjectionMatrix(),d);
this.pushProjectionMatrix(d),this.pushModelviewMatrix(c),a.getViewport()&&this.pushViewport(a.getViewport());var g=this._computedNear,h=this._computedFar,i=new osg.CullSettings;if(i.setCullSettings(this),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this.setCullSettings(a),a.getRenderOrder()===osg.Camera.NESTED_RENDER)this.handleCullCallbacksAndTraverse(a);else{var j=this.getCurrentRenderBin().getStage(),k=new osg.RenderStage;k.setCamera(a),k.setClearDepth(a.getClearDepth()),k.setClearColor(a.getClearColor()),k.setClearMask(a.getClearMask());var l;l=void 0===a.getViewport()?j.getViewport():a.getViewport(),k.setViewport(l);var m=this.getCurrentRenderBin();this.setCurrentRenderBin(k),this.handleCullCallbacksAndTraverse(a),this.setCurrentRenderBin(m),a.getRenderOrder()===osg.Camera.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(k,a.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(k,a.renderOrderNum)}this.popModelviewMatrix(),this.popProjectionMatrix(),a.getViewport()&&this.popViewport(),this.setCullSettings(i),this._computedNear=g,this._computedFar=h,b&&this.popStateSet()},osg.CullVisitor.prototype[osg.MatrixTransform.prototype.objectType]=function(a){var b=this._getReservedMatrix();if(a.getReferenceFrame()===osg.Transform.RELATIVE_RF){var c=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];osg.Matrix.mult(c,a.getMatrix(),b)}else osg.Matrix.copy(a.getMatrix(),b);this.pushModelviewMatrix(b);var d=a.getStateSet();d&&this.pushStateSet(d),a.light&&this.addPositionedAttribute(a.light),this.handleCullCallbacksAndTraverse(a),d&&this.popStateSet(),this.popModelviewMatrix()},osg.CullVisitor.prototype[osg.Projection.prototype.objectType]=function(a){lastMatrixStack=this._projectionMatrixStack[this._projectionMatrixStack.length-1];var b=this._getReservedMatrix();osg.Matrix.mult(lastMatrixStack,a.getProjectionMatrix(),b),this.pushProjectionMatrix(b);var c=a.getStateSet();c&&this.pushStateSet(c),this.handleCullCallbacksAndTraverse(a),c&&this.popStateSet(),this.popProjectionMatrix()},osg.CullVisitor.prototype[osg.Node.prototype.objectType]=function(a){var b=a.getStateSet();b&&this.pushStateSet(b),a.light&&this.addPositionedAttribute(a.light),this.handleCullCallbacksAndTraverse(a),b&&this.popStateSet()},osg.CullVisitor.prototype[osg.LightSource.prototype.objectType]=function(a){var b=a.getStateSet();b&&this.pushStateSet(b);var c=a.getLight();c&&this.addPositionedAttribute(c),this.handleCullCallbacksAndTraverse(a),b&&this.popStateSet()},osg.CullVisitor.prototype[osg.Geometry.prototype.objectType]=function(a){var b=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1],c=a.getBoundingBox();if(!this._computeNearFar||!c.valid()||this.updateCalculatedNearFar(b,a)){var d=a.getStateSet();d&&this.pushStateSet(d),this.handleCullCallbacksAndTraverse(a);var e=this._currentStateGraph.leafs;0===e.length&&this._currentRenderBin.addStateGraph(this._currentStateGraph);var f=this._getReservedLeaf(),g=0;c.valid()&&(g=this.distance(c.center(),b)),isNaN(g)?osg.warn("warning geometry has a NaN depth, "+b+" center "+c.center()):(f.parent=this._currentStateGraph,f.projection=this._projectionMatrixStack[this._projectionMatrixStack.length-1],f.geometry=a,f.modelview=b,f.depth=g,e.push(f)),d&&this.popStateSet()}};var osgAnimation={};osgAnimation.EaseOutQuad=function(a){return-(a*(a-2))},osgAnimation.EaseInQuad=function(a){return a*a},osgAnimation.EaseOutCubic=function(a){return a-=1,a*a*a+1},osgAnimation.EaseInCubic=function(a){return a*a*a},osgAnimation.EaseOutQuart=function(a){return a-=1,-(a*a*a*a-1)},osgAnimation.EaseInQuart=function(a){return a*a*a*a},osgAnimation.EaseOutElastic=function(a){return Math.pow(2,-10*a)*Math.sin((a-.075)*2*Math.PI/.3)+1},osgAnimation.easeOutBounce=function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},osgAnimation.easeOutQuad=osgAnimation.EaseOutQuad,osgAnimation.easeInQuad=osgAnimation.EaseInQuad,osgAnimation.easeOutCubic=osgAnimation.EaseOutCubic,osgAnimation.easeInCubic=osgAnimation.EaseInCubic,osgAnimation.easeOutQuart=osgAnimation.EaseOutQuart,osgAnimation.easeInQuart=osgAnimation.EaseInQuart,osgAnimation.easeOutElastic=osgAnimation.EaseOutElastic,osgAnimation.Animation=function(){osg.Object.call(this),this._channels=[]},osgAnimation.Animation.prototype=osg.objectInehrit(osg.Object.prototype,{getChannels:function(){return this._channels},getDuration:function(){for(var a=1e5,b=-1e5,c=0,d=this._channels.length;d>c;c++){var e=this._channels[c];a=Math.min(a,e.getStartTime()),b=Math.max(b,e.getEndTime())}return b-a}}),osgAnimation.BasicAnimationManager=function(){osg.Object.call(this),this._animations={},this._actives={},this._actives._keys=[],this._lastUpdate=void 0,this._targets=[]},osgAnimation.BasicAnimationManager.prototype=osg.objectInehrit(osg.Object.prototype,{_updateAnimation:function(a,b,c){var d=a.duration,e=a.weight,f=a.anim,g=a.start,h=a.loop;if(h>0){var i=b-g;if(i>=h*d)return!0}b=(b-g)%d;var j=a.callback;j&&j(b);for(var k=f.getChannels(),l=0,m=k.length;m>l;l++){var n=k[l];n.update(b,e,c)}return!1},update:function(a,b){var c=b.getFrameStamp().getSimulationTime();return this.updateManager(c),!0},updateManager:function(a){for(var b=this._targets,c=0,d=b.length;d>c;c++)b[c].reset();if(this._actives._keys.length>0)for(var e=this._actives._keys.length-1;e>=0;){for(var f=this._actives[e],g=this._actives[e]._keys,h=[],i=0,j=g.length;j>i;i++){var k=g[i],l=f[k];void 0===l.start&&(l.start=a);var m=this._updateAnimation(l,a,e);m&&h.push(i)}for(var n=h.length-1;n>=0;n--){var o=g[n];g.splice(n,1),delete f[o]}e--}},stopAll:function(){},isPlaying:function(a){if(this._actives._keys.length>0)for(var b=this._actives._keys.length-1;b>=0;){if(this._actives[b][a])return!0;b--}return!1},stopAnimation:function(a){if(this._actives._keys.length>0)for(var b=this._actives._keys.length-1,c=function(a){return"_keys"!==a};b>=0;){if(this._actives[b][a])return delete this._actives[b][a],this._actives[b]._keys=Object.keys(this._actives[b]).filter(c),void 0;b--}},playAnimationObject:function(a){if(void 0!==a.name){var b=this._animations[a.name];return void 0===b?(osg.log("no animation "+a.name+" found"),void 0):(this.isPlaying(a.name)||(void 0===a.priority&&(a.priority=0),void 0===a.weight&&(a.weight=1),void 0===a.timeFactor&&(a.timeFactor=1),void 0===a.loop&&(a.loop=0),void 0===this._actives[a.priority]&&(this._actives[a.priority]={},this._actives[a.priority]._keys=[],this._actives._keys.push(a.priority)),a.start=void 0,a.duration=b.getDuration(),a.anim=b,this._actives[a.priority][a.name]=a,this._actives[a.priority]._keys.push(a.name)),void 0)}},playAnimation:function(a,b,c){var d=a;if("object"==typeof a){if(void 0===a.getName)return this.playAnimationObject(a);d=a.getName()}var e={name:d,priority:b,weight:c};return this.playAnimationObject(e)},registerAnimation:function(a){this._animations[a.getName()]=a,this.buildTargetList()},getAnimationMap:function(){return this._animations},buildTargetList:function(){this._targets.length=0;for(var a=Object.keys(this._animations),b=0,c=a.length;c>b;b++)for(var d=this._animations[a[b]],e=d.getChannels(),f=0,g=e.length;g>f;f++){var h=e[f];this._targets.push(h.getTarget())}}}),osgAnimation.Channel=function(a,b){osg.Object.call(this),this._sampler=a,this._target=b,this._targetName=void 0,this._data={value:void 0,key:0}},osgAnimation.Channel.prototype=osg.objectInehrit(osg.Object.prototype,{getKeyframes:function(){return this._sampler.getKeyframes()},setKeyframes:function(a){this._sampler.setKeyframes(a)},getStartTime:function(){return this._sampler.getStartTime()},getEndTime:function(){return this._sampler.getEndTime()},getSampler:function(){return this._sampler},setSampler:function(a){this._sampler=a},getTarget:function(){return this._target},setTarget:function(a){this._target=a},setTargetName:function(a){this._targetName=a},getTargetName:function(){return this._targetName},update:function(a,b,c){if(b=b||1,c=c||0,!(1e-4>b)){var d=this._data;this._sampler.getValueAt(a,d),this._target.update.call(this._target,b,d.value,c)}},reset:function(){this._target.reset()}}),osgAnimation.Vec3LerpChannel=function(a,b){var c=new osgAnimation.Sampler;a||(a=[]),b||(b=new osgAnimation.Vec3Target),osgAnimation.Channel.call(this,c,b),c.setInterpolator(osgAnimation.Vec3LerpInterpolator),this.setKeyframes(a),this._data.value=osg.Vec3.copy(b.getValue(),[])},osgAnimation.Vec3LerpChannel.prototype=osgAnimation.Channel.prototype,osgAnimation.FloatLerpChannel=function(a,b){var c=new osgAnimation.Sampler;a||(a=[]),b||(b=new osgAnimation.FloatTarget),osgAnimation.Channel.call(this,c,b),c.setInterpolator(osgAnimation.FloatLerpInterpolator),this.setKeyframes(a),this._data.value=b.getValue()},osgAnimation.FloatLerpChannel.prototype=osgAnimation.Channel.prototype,osgAnimation.QuatLerpChannel=function(a,b){var c=new osgAnimation.Sampler;a||(a=[]),b||(b=new osgAnimation.QuatTarget),osgAnimation.Channel.call(this,c,b),c.setInterpolator(osgAnimation.QuatLerpInterpolator),this.setKeyframes(a),this._data.value=osg.Quat.copy(b.getValue(),[])},osgAnimation.QuatLerpChannel.prototype=osgAnimation.Channel.prototype,osgAnimation.QuatSlerpChannel=function(a,b){osgAnimation.QuatLerpChannel.call(this,a,b),this.getSampler().setInterpolator(osgAnimation.QuatSlerpInterpolator)},osgAnimation.QuatSlerpChannel.prototype=osgAnimation.Channel.prototype,osgAnimation.Vec3LerpInterpolator=function(a,b,c){var d,e,f=a[a.length-1],g=f.t;if(b>=g)return c.key=0,c.value[0]=f[0],c.value[1]=f[1],c.value[2]=f[2],void 0;if(d=a[0],e=d.t,e>=b)return c.key=0,c.value[0]=d[0],c.value[1]=d[1],c.value[2]=d[2],void 0;for(var h=c.key;a[h+1].t<b;)h++;var i=h+1,j=a[h].t,k=a[h][0],l=a[h][1],m=a[h][2],n=a[i].t,o=a[i][0],p=a[i][1],q=a[i][2],r=(b-j)/(n-j);c.value[0]=k+(o-k)*r,c.value[1]=l+(p-l)*r,c.value[2]=m+(q-m)*r,c.key=h},osgAnimation.QuatLerpInterpolator=function(a,b,c){var d,e,f=a[a.length-1],g=f.t;if(b>=g)return c.key=0,c.value[0]=f[0],c.value[1]=f[1],c.value[2]=f[2],c.value[3]=f[3],void 0;if(d=a[0],e=d.t,e>=b)return c.key=0,c.value[0]=d[0],c.value[1]=d[1],c.value[2]=d[2],c.value[3]=d[3],void 0;for(var h=c.key;a[h+1].t<b;)h++;var i=h+1,j=a[h].t,k=a[h][0],l=a[h][1],m=a[h][2],n=a[h][3],o=a[i].t,p=a[i][0],q=a[i][1],r=a[i][2],s=a[i][3],t=(b-j)/(o-j);c.value[0]=k+(p-k)*t,c.value[1]=l+(q-l)*t,c.value[2]=m+(r-m)*t,c.value[3]=n+(s-n)*t,c.key=h},osgAnimation.QuatSlerpInterpolator=function(a,b,c){var d,e,f=a[a.length-1],g=f.t;if(b>=g)return c.key=0,c.value[0]=f[0],c.value[1]=f[1],c.value[2]=f[2],c.value[3]=f[3],void 0;if(d=a[0],e=d.t,e>=b)return c.key=0,c.value[0]=d[0],c.value[1]=d[1],c.value[2]=d[2],c.value[3]=d[3],void 0;for(var h=c.key;a[h+1].t<b;)h++;var i=h+1,j=a[h].t,k=a[i].t,l=(b-j)/(k-j);osg.Quat.slerp(l,a[h],a[i],c.value),c.key=h},osgAnimation.FloatLerpInterpolator=function(a,b,c){var d,e,f=a[a.length-1],g=f.t;if(b>=g)return c.key=0,c.value=f[0],void 0;if(d=a[0],e=d.t,e>=b)return c.key=0,c.value=d[0],void 0;for(var h=c.key;a[h+1].t<b;)h++;var i=h+1,j=a[h].t,k=a[h][0],l=a[i].t,m=a[i][0],n=(b-j)/(l-j);c.value=k+(m-k)*n,c.key=h},osgAnimation.FloatStepInterpolator=function(a,b,c){var d,e,f=a[a.length-1],g=f.t;if(b>=g)return c.key=0,c.value=f[0],void 0;if(d=a[0],e=d.t,e>=b)return c.key=0,c.value=d[0],void 0;for(var h=c.key;a[h+1].t<b;)h++;a[h].t;var i=a[h][0];c.value=i,c.key=h},osgAnimation.createVec3Keyframe=function(a,b){var c=b.slice(0);return c.t=a,c},osgAnimation.createQuatKeyframe=function(a,b){var c=b.slice(0);return c.t=a,c},osgAnimation.createFloatKeyframe=function(a,b){var c=[b];return c.t=a,c},osgAnimation.LinkVisitor=function(){osg.NodeVisitor.call(this),this._animations=void 0,this._nbLinkTarget=0},osgAnimation.LinkVisitor.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{setAnimationMap:function(a){this._animations=a,this._animationKeys=Object.keys(a)},apply:function(a){for(var b=a.getUpdateCallbackList(),c=0,d=b.length;d>c;c++){var e=b[c];e instanceof osgAnimation.AnimationUpdateCallback&&this.link(e)}this.traverse(a)},link:function(a){for(var b=0,c=this._animations,d=this._animationKeys,e=0,f=d.length;f>e;e++){var g=d[e],h=c[g];b+=a.linkAnimation(h)}this._nbLinkedTarget+=b,osg.log("linked "+b+' for "'+a.getName()+'"')}}),osgAnimation.Sampler=function(a,b){a||(a=[]),this._keys=a,this._interpolator=b},osgAnimation.Sampler.prototype={getKeyframes:function(){return this._keys},setKeyframes:function(a){this._keys=a},setInterpolator:function(a){this._interpolator=a},getInterpolator:function(){return this._interpolator},getStartTime:function(){return 0===this._keys.length?void 0:this._keys[0].t},getEndTime:function(){return 0===this._keys.length?void 0:this._keys[this._keys.length-1].t},getValueAt:function(a,b){this._keys[b.key].t>a&&(b.key=0),this._interpolator(this._keys,a,b)}},osgAnimation.StackedTranslate=function(a,b){osg.Object.call(this),b||(b=[0,0,0]),this._translate=b,this._target=void 0,this.setName(a)},osgAnimation.StackedTranslate.prototype=osg.objectInehrit(osg.Object.prototype,{setTranslate:function(a){osg.Vec3.copy(a,this._translate)},setTarget:function(a){this._target=a},getTarget:function(){return this._target},update:function(){void 0!==this._target&&osg.Vec3.copy(this._target.getValue(),this._translate)},getOrCreateTarget:function(){return this._target||(this._target=new osgAnimation.Vec3Target(this._translate)),this._target},applyToMatrix:function(a){osg.Matrix.preMultTranslate(a,this._translate)}}),osgAnimation.StackedRotateAxis=function(a,b,c){osg.Object.call(this),b||(b=[1,0,0]),c||(c=0),this._axis=b,this._angle=c,this._target=void 0,this.setName(a),this._matrixTmp=[],osg.Matrix.makeIdentity(this._matrixTmp),this._quatTmp=[],osg.Quat.makeIdentity(this._quatTmp)},osgAnimation.StackedRotateAxis.prototype=osg.objectInehrit(osg.Object.prototype,{setAxis:function(a){osg.Vec3.copy(a,this._axis)},setAngle:function(a){this._angle=a},setTarget:function(a){this._target=a},getTarget:function(){return this._target},update:function(){void 0!==this._target&&(this._angle=this._target.getValue())},getOrCreateTarget:function(){return this._target||(this._target=new osgAnimation.FloatTarget(this._angle)),this._target},applyToMatrix:function(a){var b=this._axis,c=this._quatTmp,d=this._matrixTmp;osg.Quat.makeRotate(this._angle,b[0],b[1],b[2],c),osg.Matrix.setRotateFromQuat(d,c),osg.Matrix.preMult(a,d)}}),osgAnimation.StackedQuaternion=function(a,b){osg.Object.call(this),b||(b=[0,0,0,1]),this._quaternion=b,this._target=void 0,this._matrixTmp=[],osg.Matrix.makeIdentity(this._matrixTmp),this.setName(a)},osgAnimation.StackedQuaternion.prototype=osg.objectInehrit(osg.Object.prototype,{setQuaternion:function(a){osg.Quat.copy(a,this._quaternion)},setTarget:function(a){this._target=a},getTarget:function(){return this._target},update:function(){void 0!==this._target&&osg.Quat.copy(this._target.getValue(),this._quaternion)},getOrCreateTarget:function(){return this._target||(this._target=new osgAnimation.QuatTarget(this._quaternion)),this._target},applyToMatrix:function(a){var b=this._matrixTmp;osg.Matrix.setRotateFromQuat(b,this._quaternion),osg.Matrix.preMult(a,b)}}),osgAnimation.Target=function(){this._weight=0,this._priorityWeight=0,this._count=0,this._lastPriority=0,this._target=void 0},osgAnimation.Target.prototype={reset:function(){this._weight=0,this._priorityWeight=0},getValue:function(){return this._target}},osgAnimation.Vec3Target=function(){osgAnimation.Target.call(this),this._target=[0,0,0]},osgAnimation.Vec3Target.prototype=osg.objectInehrit(osgAnimation.Target.prototype,{update:function(a,b,c){this._weight||this._priorityWeight?(this._lastPriority!=c&&(this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=c),this._priorityWeight+=a,t=(1-this._weight)*a/this._priorityWeight,osg.Vec3.lerp(t,this._target,b,this._target)):(this._priorityWeight=a,this._lastPriority=c,osg.Vec3.copy(b,this._target))}}),osgAnimation.FloatTarget=function(a){osgAnimation.Target.call(this),this._target=[a]},osgAnimation.FloatTarget.prototype=osg.objectInehrit(osgAnimation.Target.prototype,{update:function(a,b,c){this._weight||this._priorityWeight?(this._lastPriority!=c&&(this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=c),this._priorityWeight+=a,t=(1-this._weight)*a/this._priorityWeight,this._target+=(b-this._target)*t):(this._priorityWeight=a,this._lastPriority=c,this._target=b)}}),osgAnimation.QuatTarget=function(){osgAnimation.Target.call(this),this._target=[],osg.Quat.makeIdentity(this._target)},osgAnimation.QuatTarget.prototype=osg.objectInehrit(osgAnimation.Target.prototype,{update:function(a,b,c){this._weight||this._priorityWeight?(this._lastPriority!=c&&(this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=c),this._priorityWeight+=a,t=(1-this._weight)*a/this._priorityWeight,osg.Quat.lerp(t,this._target,b,this._target),osg.Quat.normalize(this._target,this._target)):(this._priorityWeight=a,this._lastPriority=c,osg.Quat.copy(b,this._target))}}),osgAnimation.AnimationUpdateCallback=function(){},osgAnimation.AnimationUpdateCallback.prototype=osg.objectInehrit(osg.Object.prototype,{linkChannel:function(){},linkAnimation:function(a){var b=this.getName();if(0===b.length)return osg.log("no name on an update callback, discard"),0;for(var c=0,d=a.getChannels(),e=0,f=d.length;f>e;e++){var g=d[e];g.getTargetName()===b&&(this.linkChannel(g),c++)}return c}}),osgAnimation.UpdateMatrixTransform=function(){osgAnimation.AnimationUpdateCallback.call(this),this._stackedTransforms=[]},osgAnimation.UpdateMatrixTransform.prototype=osg.objectInehrit(osgAnimation.AnimationUpdateCallback.prototype,{getStackedTransforms:function(){return this._stackedTransforms},update:function(a){var b=a.getMatrix();osg.Matrix.makeIdentity(b);for(var c=this._stackedTransforms,d=0,e=c.length;e>d;d++){var f=c[d];f.update(),f.applyToMatrix(b)}return!0},linkChannel:function(a){for(var b=a.getName(),c=this._stackedTransforms,d=0,e=c.length;e>d;d++){var f=c[d],g=f.getName();if(b.length>0&&g===b){var h=f.getOrCreateTarget();if(h)return a.setTarget(h),!0}}osg.log("can't link channel "+b+", does not contain a symbolic name that can be linked to TransformElements")}});var osgUtil={};osgUtil.TriangleHit=function(a,b,c,d,e,f,g,h){this.index=a,this.normal=b,this.r1=c,this.v1=d,this.r2=e,this.v2=f,this.r3=g,this.v3=h},osgUtil.TriangleIntersect=function(){this.hits=[],this.nodePath=[]},osgUtil.TriangleIntersect.prototype={setNodePath:function(a){this.nodePath=a},set:function(a,b){this.start=a,this.end=b,this.dir=osg.Vec3.sub(b,a,[]),this.length=osg.Vec3.length(this.dir);var c=1/this.length;osg.Vec3.mult(this.dir,c,this.dir)},applyDrawElementsTriangles:function(a,b,c){for(var d,e,f,g=[],h=[],i=[],j=0;a>j;j+=3)d=3*c[j],g[0]=b[d],g[1]=b[d+1],g[2]=b[d+2],e=3*c[j+1],h[0]=b[e],h[1]=b[e+1],h[2]=b[e+2],f=3*c[j+2],i[0]=b[f],i[1]=b[f+1],i[2]=b[f+2],this.intersect(g,h,i)},applyDrawElementsTriangleStrip:function(a,b,c){for(var d,e,f,g=[],h=[],i=[],j=2,k=0;a>j;j++,k++)j%2?(d=3*c[k],e=3*c[k+2],f=3*c[k+1]):(d=3*c[k],e=3*c[k+1],f=3*c[k+2]),g[0]=b[d],g[1]=b[d+1],g[2]=b[d+2],h[0]=b[e],h[1]=b[e+1],h[2]=b[e+2],i[0]=b[f],i[1]=b[f+1],i[2]=b[f+2],this.intersect(g,h,i)},applyDrawElementsTriangleFan:function(a,b,c){var d=[],e=[],f=[],g=3*c[0];d[0]=b[g],d[1]=b[g+1],d[2]=b[g+2];for(var h,i,j=2,k=1;a>j;j++,k++)h=3*c[k],i=3*c[k+1],e[0]=b[h],e[1]=b[h+1],e[2]=b[h+2],f[0]=b[i],f[1]=b[i+1],f[2]=b[i+2],this.intersect(d,e,f)},applyDrawArraysTriangles:function(a,b,c){for(var d=[],e=[],f=[],g=a;b>g;g+=9)d[0]=c[g],d[1]=c[g+1],d[2]=c[g+2],e[0]=c[g+3],e[1]=c[g+4],e[2]=c[g+5],f[0]=c[g+6],f[1]=c[g+7],f[2]=c[g+8],this.intersect(d,e,f)},applyDrawArraysTriangleStrip:function(a,b,c){for(var d,e,f,g=[],h=[],i=[],j=2,k=a;b>j;j++,k++)j%2?(d=3*k,e=3*(k+2),f=3*(k+1)):(d=3*k,e=3*(k+1),f=3*(k+2)),g[0]=c[d],g[1]=c[d+1],g[2]=c[d+2],h[0]=c[e],h[1]=c[e+1],h[2]=c[e+2],i[0]=c[f],i[1]=c[f+1],i[2]=c[f+2],this.intersect(g,h,i)},applyDrawArraysTriangleFan:function(a,b,c){var d=[],e=[],f=[],g=3*a;d[0]=c[g],d[1]=c[g+1],d[2]=c[g+2];for(var h,i,j=2,k=a+1;b>j;j++,k++)h=3*k,i=3*(k+1),e[0]=c[h],e[1]=c[h+1],e[2]=c[h+2],f[0]=c[i],f[1]=c[i+1],f[2]=c[i+2],this.intersect(d,e,f)},apply:function(a){if(a.getAttributes().Vertex){var b,c=a.getAttributes().Vertex.getElements();this.index=0;for(var d=0,e=a.primitives.length;e>d;d++)if(b=a.primitives[d],void 0!==b.getIndices){var f=b.indices.getElements();switch(b.getMode()){case gl.TRIANGLES:this.applyDrawElementsTriangles(b.getCount(),c,f);break;case gl.TRIANGLE_STRIP:this.applyDrawElementsTriangleStrip(b.getCount(),c,f);break;case gl.TRIANGLE_FAN:this.applyDrawElementsTriangleFan(b.getCount(),c,f)}}else switch(b.getMode()){case gl.TRIANGLES:this.applyDrawArraysTriangles(b.getFirst(),b.getCount(),c);break;case gl.TRIANGLE_STRIP:this.applyDrawArraysTriangleStrip(b.getFirst(),b.getCount(),c);break;case gl.TRIANGLE_FAN:this.applyDrawArraysTriangleFan(b.getFirst(),b.getCount(),c)}}},intersect:function(a,b,c){if(this.index++,a!=b&&b!=c&&a!=c){var d=osg.Vec3.sub(b,a,[]),e=osg.Vec3.cross(d,this.dir,[]),f=osg.Vec3.dot(osg.Vec3.sub(this.start,a,[]),e),g=osg.Vec3.dot(osg.Vec3.sub(c,a,[]),e);if(g>=0){if(0>f)return;if(f>g)return}else{if(f>0)return;if(g>f)return}var h=osg.Vec3.sub(c,b,[]),i=osg.Vec3.cross(h,this.dir,[]),j=osg.Vec3.dot(osg.Vec3.sub(this.start,b,[]),i),k=osg.Vec3.dot(osg.Vec3.sub(a,b,[]),i);if(k>=0){if(0>j)return;if(j>k)return}else{if(j>0)return;if(k>j)return}var l=osg.Vec3.sub(a,c,[]),m=osg.Vec3.cross(l,this.dir,[]),n=osg.Vec3.dot(osg.Vec3.sub(this.start,c,[]),m),o=osg.Vec3.dot(osg.Vec3.sub(b,c,[]),m);if(o>=0){if(0>n)return;if(n>o)return}else{if(n>0)return;if(o>n)return}var p;if(0===f)p=0;else{if(0===g)return;p=f/g}var q;if(0===j)q=0;else{if(0===k)return;q=j/k}var r;if(0===n)r=0;else{if(0===o)return;r=n/o}var s=q+r+p;if(1!==s){if(0===s)return;var t=1/s;q*=t,r*=t,p*=t}var u=[];if(osg.Vec3.add(osg.Vec3.mult(a,q,[]),osg.Vec3.mult(b,r,[]),u),osg.Vec3.add(osg.Vec3.mult(c,p,[]),u,u),!osg.Vec3.valid(u))return osg.log("Warning: TriangleIntersect "),osg.log("hit:     "+u),osg.log("         "+a),osg.log("         "+b),osg.log("         "+c),void 0;var v=osg.Vec3.dot(osg.Vec3.sub(u,this.start,[]),this.dir);if(!(0>v||v>this.length)){var w=osg.Vec3.cross(d,h,[]);osg.Vec3.normalize(w,w);var x=v/this.length,y=[];y[0]=this.start[0]*(1-x)+this.end[0]*x,y[1]=this.start[1]*(1-x)+this.end[1]*x,y[2]=this.start[2]*(1-x)+this.end[2]*x,this.hits.push({ratio:x,nodepath:this.nodePath.slice(0),triangleHit:new osgUtil.TriangleHit(this.index-1,w,q,a,r,b,p,c),point:y}),this.hit=!0}}}},osgUtil.IntersectVisitor=function(){osg.NodeVisitor.call(this),this.matrix=[],this.hits=[],this.nodePath=[]},osgUtil.IntersectVisitor.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{addLineSegment:function(a,b){this.start=a,this.end=b},intersectSegmentWithSphere:function(a,b,c){var d=osg.Vec3.sub(a,c.center),e=osg.Vec3.length2(d)-c.radius*c.radius;if(0>e)return!0;var f=osg.Vec3.sub(b,a),g=osg.Vec3.length2(f),h=2*osg.Vec3.dot(d,f),i=h*h-4*g*e;if(0>i)return!1;i=Math.sqrt(i);var j=.5*g,k=(-h-i)*j,l=(-h+i)*j;return 0>=k&&0>=l?!1:k>=1&&l>=1?!1:!0},pushModelMatrix:function(a){if(this.matrix.length>0){var b=osg.Matrix.copy(this.matrix[this.matrix.length-1]);osg.Matrix.preMult(b,a),this.matrix.push(b)}else this.matrix.push(a)},getModelMatrix:function(){return 0===this.matrix.length?osg.Matrix.makeIdentity([]):this.matrix[this.matrix.length-1]},popModelMatrix:function(){return this.matrix.pop()},getWindowMatrix:function(){return this.windowMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getViewMatrix:function(){return this.viewMatrix},intersectSegmentWithGeometry:function(a,b,c){ti=new osgUtil.TriangleIntersect,ti.setNodePath(this.nodePath),ti.set(a,b),ti.apply(c);var d=ti.hits.length;if(d>0){for(var e=0;d>e;e++)this.hits.push(ti.hits[e]);return!0}return!1},pushCamera:function(a){this.projectionMatrix=a.getProjectionMatrix(),this.viewMatrix=a.getViewMatrix();var b=a.getViewport();void 0!==b&&(this.windowMatrix=b.computeWindowMatrix())},applyCamera:function(a){this.pushCamera(a),this.traverse(a)},applyNode:function(a){if(a.getMatrix&&this.pushModelMatrix(a.getMatrix()),a.primitives){var b=[];osg.Matrix.copy(this.getWindowMatrix(),b),osg.Matrix.preMult(b,this.getProjectionMatrix()),osg.Matrix.preMult(b,this.getViewMatrix()),osg.Matrix.preMult(b,this.getModelMatrix());var c=[],d=osg.Matrix.inverse(b,c);if(!d)return;var e=osg.Matrix.transformVec3(c,this.start,new Array(3)),f=osg.Matrix.transformVec3(c,this.end,new Array(3));this.intersectSegmentWithGeometry(e,f,a)}a.traverse&&this.traverse(a),a.getMatrix&&this.popModelMatrix()},apply:function(a){this.enterNode(a)!==!1&&(a.getViewMatrix?this.applyCamera(a):this.applyNode(a))},enterNode:function(a){var b=a.boundingSphere;return void 0===b||this.intersectSegmentWithSphere?!0:!1}}),function(){var a=function(a){void 0!==a&&(void 0!==a.object&&void 0!==a.field&&this.createInternalSlider(param),this._uniform=this.createInternalSliderUniform(param))};a.prototype={setTargetHTML:function(a){this.parent=a},addToDom:function(a){var b=document.createElement("div");b.innerHTML=a,this.parent.appendChild(b)},getValue:function(a){if(window.localStorage){var b=window.localStorage.getItem(a);return b}return null},setValue:function(a,b){window.localStorage&&window.localStorage.setItem(a,b)},createHTMLSlider:function(a,b,c,d){var e='<div>NAME [ MIN - MAX ] <input type="range" min="MIN" max="MAX" value="VALUE" step="STEP" onchange="ONCHANGE" /><span id="UPDATE"></span></div>',f=a.min,g=a.max,h=a.step,i=c,j=d,k=j+"(this.value)";return e=e.replace(/MIN/g,f),e=e.replace(/MAX/g,g+h),e=e.replace("STEP",h),e=e.replace("VALUE",b),e=e.replace(/NAME/g,i),e=e.replace(/UPDATE/g,j),e=e.replace("ONCHANGE",k)},createUniformFunction:function(a,b,c,d,e){return self=this,function(){var f=b,g=c,h=d,i=e,j=function(b){h.get()[g]=b,h.dirty(),osg.debug(f+" value "+b),document.getElementById(e).innerHTML=Number(b).toFixed(4),self.setValue(i,b),void 0!==a.onchange&&a.onchange(h.get())};return j}()},createFunction:function(a,b,c,d,e,f){return self=this,function(){var g=b,h=e,i=f,j=d,k=function(b){"string"==typeof b&&(b=parseFloat(b)),"number"==typeof d[h]?j[h]=b:j[h][c]=b,osg.debug(g+" value "+b),document.getElementById(f).innerHTML=Number(b).toFixed(4),self.setValue(i,b),void 0!==a.onchange&&a.onchange(j[h])};return k}()},getCallbackName:function(a,b){return"change_"+b+"_"+a},copyDefaultValue:function(a){var b=a.value;return b=Array.isArray(a.value)?a.value.slice():[b]},createInternalSliderUniform:function(a){var b=a.value,c=a.uniform;if(void 0===c){var d=a.type;d=d.charAt(0).toUpperCase()+d.slice(1),c=osg.Uniform["create"+d](b,a.name)}for(var e=this.getCallbackName(a.name,a.id),f=b.length,g=0;f>g;g++){var h=g.toString(),i=a.name+h,j=e+h,k=b[g],l=this.getValue(j);null!==l?k=l:a.uniform&&void 0!==a.uniform.get()[g]&&(k=a.uniform.get()[g]);var m=this.createHTMLSlider(a,k,i,j);this.addToDom(m),window[j]=this.createUniformFunction(a,i,g,c,j),osg.log(i+" "+k),window[j](k)}return this.uniform=c,c},createInternalSlider:function(a){for(var b=a.value,c=a.name,d=a.id,e=b.length,f=this.getCallbackName(c,d),g=a.object,h=a.field,i=0;e>i;i++){var j=i.toString(),k=c+j,l=f+j,m=b[i],n=this.getValue(l);m=null!==n?n:"number"==typeof g[h]?g[h]:g[h][i];var o=this.createHTMLSlider(a,m,k,l);this.addToDom(o),window[l]=this.createFunction(a,k,i,g,h,l),osg.log(k+" "+m),window[l](m)}},createSlider:function(a){return void 0!==a.html&&this.setTargetHTML(a.html),void 0===a.id&&(a.id=a.name),a.value=this.copyDefaultValue(a),void 0!==a.type?this.createInternalSliderUniform(a):(void 0===a.object&&(a.object={data:a.value},a.field="data"),this.createInternalSlider(a))}},osgUtil.ParameterVisitor=function(){osg.NodeVisitor.call(this),this.arraySlider=new a,this.setTargetHTML(document.body)},osgUtil.ParameterVisitor.createSlider=function(b){(new a).createSlider(b)},osgUtil.ParameterVisitor.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{setTargetHTML:function(a){this.targetHTML=a,this.arraySlider.setTargetHTML(this.targetHTML)},getUniformList:function(a,b){var c="(uniform)",d=".*?",e="((?:[a-z][a-z]+))",f=".*?",g="((?:[a-z][a-z]+))",h=".*?",i=".",j=".*?",k=".",l=".*?",m="(.)",n="(.)",o=".*?",p="(\\{.*?\\})",q=new RegExp(c+d+e+f+g+h+i+j+k+l+m+n+o+p,["g"]),r=a.match(q),s=b;if(null!==r)for(var t=new RegExp(c+d+e+f+g+h+i+j+k+l+m+n+o+p,["i"]),u=0,v=r.length;v>u;u++){var w=r[u].match(t);if(null!==w){w[1];var x=w[2],y=w[3];w[4],w[5];var z=w[6],A=JSON.parse(z);A.type=x,A.name=y;var B=A.value;A.value=function(){return B},s[y]=A}}return s},getUniformFromStateSet:function(a,b){var c=a.getUniformList();if(c)for(var d=Object.keys(b),e=0,f=d.length;f>e;e++){var g=d[e];void 0!==c[g]&&void 0===b[g].uniform&&(b[g].uniform=c[g].object)}},findExistingUniform:function(a,b){var c=function(){osg.NodeVisitor.call(this,osg.NodeVisitor.TRAVERSE_PARENTS)};c.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{setUniformMap:function(a){this.uniformMap=a},apply:function(a){var b=a.getStateSet();b&&osgUtil.ParameterVisitor.prototype.getUniformFromStateSet(b,this.uniformMap),this.traverse(a)}});var d=new c;d.setUniformMap(b),a.accept(d)},applyProgram:function(a,b){var c=b.getAttribute("Program"),d=c.getName();c.getVertexShader().getText();var e={};this.getUniformList(c.getVertexShader().getText(),e),this.getUniformList(c.getFragmentShader().getText(),e);var f=Object.keys(e);if(void 0===d){var g=function(a){var b=0,c=0;if(0===a.length)return b;for(j=0;j<a.length;j++)c=a.charCodeAt(j),b=(b<<5)-b+c,b&=b;return 0>b&&(b=-b),b},h=f.join("");d=g(h).toString()}this.findExistingUniform(a,e);for(var i=!1,j=0;j<f.length;j++){{var k=f[j],l=e[k];l.type,l.name}l.id=d;var m=this.arraySlider.createSlider(l);void 0===l.uniform&&m&&b.addUniform(m),i=!0}if(i){var n=document.createElement("div");n.innerHTML="<p> </p>",this.targetHTML.appendChild(n)}osg.log(e)},applyStateSet:function(a,b){void 0!==b.getAttribute("Program")&&this.applyProgram(a,b)},apply:function(a){var b=this.targetHTML;if(void 0!==b&&null!==b){var c=a.getStateSet();void 0!==c&&this.applyStateSet(a,c),this.traverse(a)}}})}(),function(){osgUtil.Composer=function(){osg.Node.call(this),this._stack=[],this._renderToScreen=!1,this._dirty=!1;var a=function(){};a.prototype={update:function(a){a.isDirty()&&a.build()}},this.setUpdateCallback(new a),this.getOrCreateStateSet().setAttributeAndModes(new osg.Depth("DISABLE"))},osgUtil.Composer.prototype=osg.objectInehrit(osg.Node.prototype,{dirty:function(){for(var a=0,b=this._stack.length;b>a;a++)this._stack[a].filter.dirty()},addPass:function(a,b,c){b instanceof osg.Texture?this._stack.push({filter:a,texture:b}):void 0!==b&&void 0!==c?this._stack.push({filter:a,width:Math.floor(b),height:Math.floor(c)}):this._stack.push({filter:a})},renderToScreen:function(a,b){this._renderToScreen=!0,this._renderToScreenWidth=a,this._renderToScreenHeight=b},isDirty:function(){for(var a=0,b=this._stack.length;b>a;a++)if(this._stack[a].filter.isDirty())return!0;return!1},build:function(){var a=this;this.removeChildren();var b,c=this;this._stack.forEach(function(d,e,f){d.filter.isDirty()&&d.filter.build();var g,h,i=d.filter.getStateSet();if(void 0!==d.texture)g=d.texture.getWidth(),h=d.texture.getHeight();else if(void 0!==d.width&&void 0!==d.height)g=d.width,h=d.height;else{var j=i.getTextureAttribute(0,"Texture");void 0===j&&osg.warn("osgComposer can't find any information to setup texture output size"),g=j.getWidth(),h=j.getHeight()}var k=e===f.length-1&&c._renderToScreen===!0;if(!k&&void 0===i.getAttribute("Program"))return f[e+1].filter.getStateSet().setTextureAttributeAndModes(0,i.getTextureAttribute(0,"Texture")),void 0;var l=new osg.Camera;l.setClearMask(0);var m,n;k===!0?(g=c._renderToScreenWidth,h=c._renderToScreenHeight):(l.setRenderOrder(osg.Camera.PRE_RENDER,0),m=d.texture,void 0===m&&(m=new osg.Texture,m.setTextureSize(g,h)),l.attachTexture(osg.FrameBufferObject.COLOR_ATTACHMENT0,m,0));
var o=new osg.Viewport(0,0,g,h),p=osg.Matrix.makeOrtho(-g/2,g/2,-h/2,h/2,-5,5,[]);l.setReferenceFrame(osg.Transform.ABSOLUTE_RF),l.setViewport(o),l.setProjectionMatrix(p),l.setStateSet(d.filter.getStateSet()),n=osg.createTexturedQuadGeometry(-g/2,-h/2,0,g,0,0,0,h,0),void 0!==d.filter.buildGeometry&&(n=d.filter.buildGeometry(n)),n.setName("composer layer"),b=m,e+1<f.length&&f[e+1].filter.getStateSet().setTextureAttributeAndModes(0,b),l.addChild(n),d.filter.getStateSet().addUniform(osg.Uniform.createFloat2([g,h],"RenderSize")),l.setName("Composer Pass"+e),a.addChild(l)}),this._resultTexture=b}}),osgUtil.Composer.Filter=function(){this._stateSet=new osg.StateSet,this._dirty=!0},osgUtil.Composer.Filter.prototype={getStateSet:function(){return this._stateSet},getOrCreateStateSet:function(){return this._stateSet},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty}},osgUtil.Composer.Filter.defaultVertexShader=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec2 TexCoord0;","varying vec2 FragTexCoord0;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","void main(void) {","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);","  FragTexCoord0 = TexCoord0;","}",""].join("\n"),osgUtil.Composer.Filter.defaultFragmentShaderHeader=["#ifdef GL_ES","precision highp float;","#endif","varying vec2 FragTexCoord0;","uniform vec2 RenderSize;","uniform sampler2D Texture0;",""].join("\n"),osgUtil.Composer.Filter.shaderUtils=["vec4 packFloatTo4x8(in float v) {","vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * v;","enc = fract(enc);","enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);","return enc;","}"," ","vec4 pack2FloatTo4x8(in vec2 val) {"," const vec2 bitSh = vec2(256.0, 1.0);"," const vec2 bitMsk = vec2(0.0, 1.0/256.0);"," vec2 res1 = fract(val.x * bitSh);"," res1 -= res1.xx * bitMsk;"," vec2 res2 = fract(val.y * bitSh);"," res2 -= res2.xx * bitMsk;"," return vec4(res1.x,res1.y,res2.x,res2.y);","}"," ","float unpack4x8ToFloat( vec4 rgba ) {"," return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );","}"," ","vec2 unpack4x8To2Float(in vec4 val) {"," const vec2 unshift = vec2(1.0/256.0, 1.0);"," return vec2(dot(val.xy, unshift), dot(val.zw, unshift));","}","vec2 encodeNormal (vec3 n)","{","    float f = sqrt(8.0*n.z+8.0);","    return n.xy / f + 0.5;","}","vec3 decodeNormal (vec2 enc)","{","    vec2 fenc = enc*4.0-2.0;","    float f = dot(fenc,fenc);","    float g = sqrt(1.0-f/4.0);","    vec3 n;","    n.xy = fenc*g;","    n.z = 1.0-f/2.0;","    return n;","}",""].join("\n"),osgUtil.Composer.Filter.Helper={getOrCreatePascalCoefficients:function(){var a=osgUtil.Composer.Filter.Helper.getOrCreatePascalCoefficients.cache;return void 0!==a?a:(a=function(a){for(var b=[[1]],c=0;a-1>c;c++){Math.pow(2,c);var d=b[c],e=d.length,f=e+1,g=new Array(e);g[0]=1,g[f-1]=1;for(var h=1,i=0;e-1>i;i++){var j=d[i]+d[i+1];g[h++]=j}b.push(g)}return function(){for(var a=0;a<b.length;a++)for(var c=b[a],d=Math.pow(2,a),e=0;e<c.length;e++)c[e]=c[e]/d}(),b}(20),osgUtil.Composer.Filter.Helper.getOrCreatePascalCoefficients.cache=a,a)}},osgUtil.Composer.Filter.Custom=function(a,b){osgUtil.Composer.Filter.call(this),this._fragmentShader=a,this._uniforms=b,this._vertexShader=osgUtil.Composer.Filter.defaultVertexShader},osgUtil.Composer.Filter.Custom.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{build:function(){var a=new osg.Program(new osg.Shader("VERTEX_SHADER",this._vertexShader),new osg.Shader("FRAGMENT_SHADER",this._fragmentShader));if(this._uniforms){var b=0,c=this._fragmentShader.match(/uniform\s+\w+\s+\w+/g);if(null!==c)for(var d=0,e=c.length;e>d;d++){var f,g=c[d].match(/uniform\s+(\w+)\s+(\w+)/),h=g[1],i=g[2];void 0!==this._uniforms[i]&&(uniform_value=this._uniforms[i],-1!==h.search("sampler")?(this._stateSet.setTextureAttributeAndModes(b,uniform_value),f=osg.Uniform.createInt1(b,i),b++,this._stateSet.addUniform(f)):(f=osg.Uniform.isUniform(uniform_value)?uniform_value:osg.Uniform[h](this._uniforms[i],i),this._stateSet.addUniform(f)))}}this._stateSet.setAttributeAndModes(a),this._dirty=!1}}),osgUtil.Composer.Filter.AverageHBlur=function(a){osgUtil.Composer.Filter.call(this),void 0===a?this.setBlurSize(5):this.setBlurSize(a),this._pixelSize=1},osgUtil.Composer.Filter.AverageHBlur.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{setBlurSize:function(a){1!==a%2&&(a+=1),this._nbSamples=a,this.dirty()},setPixelSize:function(a){this._pixelSize=a,this.dirty()},getUVOffset:function(a){return"vec2(float("+a+"), 0.0)/RenderSize[0];"},getShaderBlurKernel:function(){var a=this._nbSamples,b=[];b.push(" pixel = texture2D(Texture0, FragTexCoord0 );"),b.push(" if (pixel.w == 0.0) { gl_FragColor = pixel; return; }"),b.push(" vec2 offset;");for(var c=1;c<Math.ceil(a/2);c++)b.push(" offset = "+this.getUVOffset(c*this._pixelSize)),b.push(" pixel += texture2D(Texture0, FragTexCoord0 + offset);"),b.push(" pixel += texture2D(Texture0, FragTexCoord0 - offset);");return b.push(" pixel /= float("+a+");"),b},build:function(){this._nbSamples;var a=osgUtil.Composer.Filter.defaultVertexShader,b=[osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform float width;","void main (void)","{","  vec4 pixel;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = vec4(pixel);","}",""].join("\n"),c=new osg.Program(new osg.Shader("VERTEX_SHADER",a),new osg.Shader("FRAGMENT_SHADER",b));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(osg.Uniform.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(c),this._dirty=!1}}),osgUtil.Composer.Filter.AverageVBlur=function(a){osgUtil.Composer.Filter.AverageHBlur.call(this,a)},osgUtil.Composer.Filter.AverageVBlur.prototype=osg.objectInehrit(osgUtil.Composer.Filter.AverageHBlur.prototype,{getUVOffset:function(a){return"vec2(0.0, float("+a+"))/RenderSize[1];"}}),osgUtil.Composer.Filter.BilateralHBlur=function(a){osgUtil.Composer.Filter.call(this),void 0===a&&(a={});var b=a.nbSamples,c=a.depthTexture,d=a.radius;void 0===b?this.setBlurSize(5):this.setBlurSize(b),this._depthTexture=c,this._radius=osg.Uniform.createFloat(1,"radius"),this._pixelSize=osg.Uniform.createFloat(1,"pixelSize"),this.setRadius(d)},osgUtil.Composer.Filter.BilateralHBlur.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{setBlurSize:function(a){1!==a%2&&(a+=1),this._nbSamples=a,this.dirty()},setPixelSize:function(a){this._pixelSize.get()[0]=a,this._pixelSize.dirty()},setRadius:function(a){this._radius.get()[0]=a,this._radius.dirty()},getUVOffset:function(a){return"vec2(0.0, float("+a+") * pixelSize )/RenderSize[1];"},getShaderBlurKernel:function(){var a=this._nbSamples,b=[];b.push(" pixel = texture2D(Texture0, FragTexCoord0 );"),b.push(" if (pixel.w <= 0.0001) { gl_FragColor = vec4(1.0); return; }"),b.push(" vec2 offset, tmpUV;"),b.push(" depth = getDepthValue(texture2D(Texture1, FragTexCoord0 ));");for(var c=1;c<Math.ceil(a/2);c++)b.push(" offset = "+this.getUVOffset(c)),b.push(" tmpUV =  FragTexCoord0 + offset;"),b.push(" tmpDepth = getDepthValue(texture2D(Texture1, tmpUV ));"),b.push(" if ( abs(depth-tmpDepth) < radius) {"),b.push("   pixel += texture2D(Texture0, tmpUV);"),b.push("   nbHits += 1.0;"),b.push(" }"),b.push(" tmpUV =  FragTexCoord0 - offset;"),b.push(" tmpDepth = getDepthValue(texture2D(Texture1, tmpUV ));"),b.push(" if ( abs(depth-tmpDepth) < radius) {"),b.push("   pixel += texture2D(Texture0, tmpUV);"),b.push("   nbHits += 1.0;"),b.push(" }");return b.push(" pixel /= nbHits;"),b},build:function(){this._nbSamples;var a=osgUtil.Composer.Filter.defaultVertexShader,b=[osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float width;","uniform mat4 projection;","uniform float radius;","uniform float pixelSize;","float znear,zfar,zrange;","",osgUtil.Composer.Filter.shaderUtils,"","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  return -depth;","}","void main (void)","{","  vec4 pixel;","  float depth, tmpDepth;","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  float nbHits = 1.0;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = vec4(pixel);","}",""].join("\n"),c=new osg.Program(new osg.Shader("VERTEX_SHADER",a),new osg.Shader("FRAGMENT_SHADER",b));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(osg.Uniform.createInt1(0,"Texture0")),void 0===this._stateSet.getUniform("Texture1")&&this._stateSet.addUniform(osg.Uniform.createInt1(1,"Texture1")),this._stateSet.addUniform(this._radius),this._stateSet.addUniform(this._pixelSize),this._stateSet.setTextureAttributeAndModes(1,this._depthTexture),this._stateSet.setAttributeAndModes(c),this._dirty=!1}}),osgUtil.Composer.Filter.BilateralVBlur=function(a){osgUtil.Composer.Filter.BilateralHBlur.call(this,a)},osgUtil.Composer.Filter.BilateralVBlur.prototype=osg.objectInehrit(osgUtil.Composer.Filter.BilateralHBlur.prototype,{getUVOffset:function(a){return"vec2(float("+a+")*pixelSize,0.0)/RenderSize[0];"}}),osgUtil.Composer.Filter.InputTexture=function(a){osgUtil.Composer.Filter.call(this),this._stateSet.setTextureAttributeAndModes(0,a)},osgUtil.Composer.Filter.InputTexture.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{build:function(){this._dirty=!1}}),osgUtil.Composer.Filter.HBlur=function(a){osgUtil.Composer.Filter.call(this),void 0===a?this.setBlurSize(5):this.setBlurSize(a)},osgUtil.Composer.Filter.HBlur.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{setBlurSize:function(a){1!==a%2&&(a+=1),this._nbSamples=a,this.dirty()},getUVOffset:function(a){return"vec2(float("+a+"), 0.0)/RenderSize[0];"},build:function(){var a=this._nbSamples,b=osgUtil.Composer.Filter.defaultVertexShader,c=osgUtil.Composer.Filter.Helper.getOrCreatePascalCoefficients(),d=c[a-1],e=Math.floor(a/2),f=[];f.push(" pixel += float("+d[e]+")*texture2D(Texture0, FragTexCoord0 ).rgb;");var g=1;f.push(" vec2 offset;");for(var h=e+1;a>h;h++){var i=d[h];f.push(" offset = "+this.getUVOffset(h)),g++,f.push(" pixel += "+i+"*texture2D(Texture0, FragTexCoord0 + offset).rgb;"),f.push(" pixel += "+i+"*texture2D(Texture0, FragTexCoord0 - offset).rgb;")}var j=[osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform float width;","void main (void)","{","  vec3 pixel;",f.join("\n"),"  gl_FragColor = vec4(pixel,1.0);","}",""].join("\n"),k=new osg.Program(new osg.Shader("VERTEX_SHADER",b),new osg.Shader("FRAGMENT_SHADER",j));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(osg.Uniform.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(k),this._dirty=!1}}),osgUtil.Composer.Filter.VBlur=function(){osgUtil.Composer.Filter.HBlur.call(this)},osgUtil.Composer.Filter.VBlur.prototype=osg.objectInehrit(osgUtil.Composer.Filter.HBlur.prototype,{getUVOffset:function(a){return"vec2(0.0, float("+a+"))/RenderSize[1];"}}),osgUtil.Composer.Filter.SobelFilter=function(){osgUtil.Composer.Filter.call(this),this._color=osg.Uniform.createFloat3([1,1,1],"color"),this._factor=osg.Uniform.createFloat(1,"factor")},osgUtil.Composer.Filter.SobelFilter.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{setColor:function(a){this._color.get()[0]=a[0],this._color.get()[1]=a[1],this._color.get()[2]=a[2],this._color.dirty()},setFactor:function(a){this._factor.get()[0]=a,this._factor.dirty()},build:function(){var a=this._stateSet,b=osgUtil.Composer.Filter.defaultVertexShader,c=["",osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform vec3 color;","uniform float factor;","void main (void)","{","  float fac0 = 2.0;","  float fac1 = 1.0;","  float offsetx = 1.0/RenderSize[0];","  float offsety = 1.0/RenderSize[1];","  vec4 texel0 = texture2D(Texture0, FragTexCoord0 + vec2(offsetx, offsety));","  vec4 texel1 = texture2D(Texture0, FragTexCoord0 + vec2(offsetx, 0.0));","  vec4 texel2 = texture2D(Texture0, FragTexCoord0 + vec2(offsetx, -offsety));","  vec4 texel3 = texture2D(Texture0, FragTexCoord0 + vec2(0.0, -offsety));","  vec4 texel4 = texture2D(Texture0, FragTexCoord0 + vec2(-offsetx, -offsety));","  vec4 texel5 = texture2D(Texture0, FragTexCoord0 + vec2(-offsetx, 0.0));","  vec4 texel6 = texture2D(Texture0, FragTexCoord0 + vec2(-offsetx, offsety));","  vec4 texel7 = texture2D(Texture0, FragTexCoord0 + vec2(0.0, offsety));","  vec4 rowx = -fac0*texel5 + fac0*texel1 +  -fac1*texel6 + fac1*texel0 + -fac1*texel4 + fac1*texel2;","  vec4 rowy = -fac0*texel3 + fac0*texel7 +  -fac1*texel4 + fac1*texel6 + -fac1*texel2 + fac1*texel0;","  float mag = sqrt(dot(rowy,rowy)+dot(rowx,rowx));","  if (mag < 1.0/255.0) { discard; return; }","  mag *= factor;","  mag = min(1.0, mag);","  gl_FragColor = vec4(color*mag,mag);","}",""].join("\n"),d=new osg.Program(new osg.Shader("VERTEX_SHADER",b),new osg.Shader("FRAGMENT_SHADER",c));a.setAttributeAndModes(d),a.addUniform(this._color),a.addUniform(this._factor),a.addUniform(osg.Uniform.createInt1(0,"Texture0")),this._dirty=!1}}),osgUtil.Composer.Filter.BlendMix=function(){osgUtil.Composer.Filter.call(this);var a,b,c,d=0,e=1,f=this._stateSet;3===arguments.length?(a=arguments[0],b=arguments[1],c=arguments[2],d=1,e=2,f.setTextureAttributeAndModes(d,a)):2===arguments.length?(b=arguments[0],c=arguments[1]):1===arguments.length&&(b=arguments[0],c=.5),f.setTextureAttributeAndModes(e,b),f.addUniform(osg.Uniform.createInt1(d,"Texture0")),f.addUniform(osg.Uniform.createInt1(e,"Texture1")),this._mixValueUniform=osg.Uniform.createFloat1(c,"MixValue"),f.addUniform(mixValueUniform)},osgUtil.Composer.Filter.BlendMix=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{getBlendFactorUniform:function(){return this._mixValueUniform},build:function(){var a=this._stateSet,b=osgUtil.Composer.Filter.defaultVertexShader,c=["",osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = mix(texture2D(Texture0,FragTexCoord0), texture2D(Texture1,FragTexCoord0),MixValue);","}",""].join("\n"),d=new osg.Program(new osg.Shader("VERTEX_SHADER",b),new osg.Shader("FRAGMENT_SHADER",c));a.setAttributeAndModes(d),this._dirty=!1}}),osgUtil.Composer.Filter.BlendMultiply=function(){osgUtil.Composer.Filter.call(this);var a,b,c=this._stateSet,d=0,e=1;2===arguments.length?(a=arguments[0],b=arguments[1],d=1,d=2,c.setTextureAttributeAndModes(d,a)):1===arguments.length&&(b=arguments[0]),c.setTextureAttributeAndModes(e,b),c.addUniform(osg.Uniform.createInt1(d,"Texture0")),c.addUniform(osg.Uniform.createInt1(e,"Texture1"))},osgUtil.Composer.Filter.BlendMultiply.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{build:function(){var a=osgUtil.Composer.Filter.defaultVertexShader,b=["",osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = texture2D(Texture0,FragTexCoord0)*texture2D(Texture1,FragTexCoord0);","}",""].join("\n"),c=new osg.Program(new osg.Shader("VERTEX_SHADER",a),new osg.Shader("FRAGMENT_SHADER",b));this._stateSet.setAttributeAndModes(c),this._dirty=!1}}),osgUtil.Composer.Filter.SSAO=function(a){osgUtil.Composer.Filter.call(this);var b=this._stateSet,c=16,d=.05;void 0!==a&&(void 0!==a.nbSamples&&(c=a.nbSamples),void 0!==a.radius&&(d=a.radius));var e=a.normal,f=a.position;this._radius=d,this._nbSamples=c,this._noiseTextureSize=16,this._sceneRadius=2,b.addUniform(osg.Uniform.createFloat1(1,"Power")),b.addUniform(osg.Uniform.createFloat1(d,"Radius")),b.addUniform(osg.Uniform.createInt1(0,"Texture0")),b.addUniform(osg.Uniform.createInt1(1,"Texture1")),b.addUniform(osg.Uniform.createInt1(2,"Texture2")),b.addUniform(osg.Uniform.createFloat1(.1,"AngleLimit"));var g=e.getWidth(),h=e.getHeight();this._size=[g,h],b.setTextureAttributeAndModes(0,e),b.setTextureAttributeAndModes(1,f),this.initNoise()},osgUtil.Composer.Filter.SSAO.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{initNoise:function(){var a=this._noiseTextureSize,b=new Array(3*a*a);!function(b){for(var c=0;a*a>c;c++){var d,e,f;d=2*(Math.random()-.5),e=2*(Math.random()-.5),f=0;var g=osg.Vec3.normalize([d,e,f],[]);b[3*c+0]=255*(.5*g[0]+.5),b[3*c+1]=255*(.5*g[1]+.5),b[3*c+2]=255*(.5*g[2]+.5)}}(b);var c=new osg.Texture;c.setWrapS("REPEAT"),c.setWrapT("REPEAT"),c.setMinFilter("NEAREST"),c.setMagFilter("NEAREST"),c.setTextureSize(a,a),c.setImage(new Uint8Array(b),"RGB"),this._noiseTexture=c},setSceneRadius:function(a){this._sceneRadius=a,this.dirty()},setAngleLimit:function(a){var b=this._stateSet.getUniform("AngleLimit");b.get()[0]=a,b.dirty()},setNbSamples:function(a){a!==this._nbSamples&&(this._nbSamples=Math.floor(a),this.dirty())},setRadius:function(a){var b=this._stateSet.getUniform("Radius");b.get()[0]=a,b.dirty()},setPower:function(a){var b=this._stateSet.getUniform("Power");b.get()[0]=a,b.dirty()},build:function(){var a=this._stateSet,b=this._nbSamples,c=new Array(4*b);!function(a){for(var c=0;b>c;c++){var d,e,f;d=2*(Math.random()-.5),e=2*(Math.random()-.5),f=Math.random();var g=osg.Vec3.normalize([d,e,f],[]),h=Math.max(c/b,.1);h=.1+.9*h*h,a[3*c+0]=g[0],a[3*c+1]=g[1],a[3*c+2]=g[2],a[3*c+3]=h}}(c),a.setTextureAttributeAndModes(2,this._noiseTexture);var d=a.getUniform("noiseSampling");void 0===d?(d=osg.Uniform.createFloat2([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize],"noiseSampling"),a.addUniform(d)):(d.set([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize]),d.dirty());for(var e=["","#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec2 TexCoord0;","varying vec2 FragTexCoord0;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","void main(void) {","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);","  FragTexCoord0 = TexCoord0;","}",""].join("\n"),f=[],g=0;b>g;g++)f.push("kernel["+g+"] = vec4("+c[3*g]+","+c[3*g+1]+", "+c[3*g+2]+", "+c[3*g+3]+");");f=f.join("\n"),.002*this._sceneRadius,.05*this._sceneRadius;var h=["",osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","vec3 normal;","vec4 position;","vec4 kernel["+b+"];","mat3 computeBasis()","{","  vec2 uvrand = FragTexCoord0*noiseSampling;","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","void main (void)","{",f,"  position = texture2D(Texture1, FragTexCoord0);","  vec4 p = texture2D(Texture0, FragTexCoord0);","  depth = p.w;","  normal = vec3(p);","  if ( position.w == 0.0) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vecKernel;","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = texture2D(Texture1, offset.xy).z;","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),i=new osg.Program(new osg.Shader("VERTEX_SHADER",e),new osg.Shader("FRAGMENT_SHADER",h));a.setAttributeAndModes(i),this._dirty=!1}}),osgUtil.Composer.Filter.SSAO8=function(a){osgUtil.Composer.Filter.SSAO.call(this,a)},osgUtil.Composer.Filter.SSAO8.prototype=osg.objectInehrit(osgUtil.Composer.Filter.SSAO.prototype,{buildGeometry:function(a){return a.getAttributes().TexCoord1=this._texCoord1,a},build:function(){var a=this._stateSet,b=this._nbSamples,c=new Array(4*b);this._angleLimit,function(a){for(var c=0;b>c;c++){var d,e,f;d=2*(Math.random()-.5),e=2*(Math.random()-.5),f=Math.random();var g=osg.Vec3.normalize([d,e,f],[]),h=Math.max(c/b,.1);h=.1+.9*h*h,a[3*c+0]=g[0],a[3*c+1]=g[1],a[3*c+2]=g[2],a[3*c+3]=h}}(c),this._noiseTextureSize,a.setTextureAttributeAndModes(2,this._noiseTexture);var d=a.getUniform("noiseSampling");void 0===d?(d=osg.Uniform.createFloat2([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize],"noiseSampling"),a.addUniform(d)):(d.set([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize]),d.dirty());for(var e=["","#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec2 TexCoord0;","attribute vec3 TexCoord1;","varying vec2 FragTexCoord0;","varying vec3 FragTexCoord1;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","void main(void) {","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);","  FragTexCoord0 = TexCoord0;","  FragTexCoord1 = TexCoord1;","}",""].join("\n"),f=[],g=0;b>g;g++)f.push("kernel["+g+"] = vec4("+c[3*g]+","+c[3*g+1]+", "+c[3*g+2]+", "+c[3*g+3]+");");f=f.join("\n"),.002*this._sceneRadius,.05*this._sceneRadius;var h=["",osgUtil.Composer.Filter.defaultFragmentShaderHeader,"varying vec3 FragTexCoord1;","uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","float znear, zfar, zrange;","vec3 normal;","vec3 position;","vec4 kernel["+b+"];",osgUtil.Composer.Filter.shaderUtils,"mat3 computeBasis()","{","  vec2 uvrand = FragTexCoord0*noiseSampling;","  //uvrand = rand(gl_FragCoord.xy);","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  //vec3 rvec = normalize(vec3(uvrand,0.0));","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  //depth = depth*zrange;","  return -depth;","}","void main (void)","{",f,"  vec4 p = texture2D(Texture0, FragTexCoord0);","  if (dot(p,p) < 0.001) { ","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  depth = getDepthValue(texture2D(Texture1, FragTexCoord0));","  if ( -depth < znear) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  normal = decodeNormal(unpack4x8To2Float(p));","  position = -FragTexCoord1*depth;","  position.z = -position.z;",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vec3(vecKernel);","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = getDepthValue(texture2D(Texture1, offset.xy));","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),i=new osg.Program(new osg.Shader("VERTEX_SHADER",e),new osg.Shader("FRAGMENT_SHADER",h));a.setAttributeAndModes(i),this._dirty=!1}})}();var OsgObjectMemoryPool=function(a){return{_memPool:[],reset:function(){return this._memPool=[],this},put:function(a){this._memPool.push(a)},get:function(){return this._memPool.length>0?this._memPool.pop():(this.grow(),this.get())},grow:function(b){void 0===b&&(b=this._memPool.length>0?2*this._memPool.length:20);for(var c=this._memPool.length;c++<b;)this._memPool.push(new a);return this}}},OsgArrayMemoryPool=function(){return{_mempoolofPools:[],reset:function(){return this._memPoolofPools={},this},put:function(a){this._memPoolofPools[a.length]||(this._memPoolofPools[a.length]=[]),this._memPoolofPools[a.length].push(a)},get:function(a){if(this._memPoolofPools[a]){if(this._memPoolofPools.length>0)return this._memPool.pop()}else this._memPoolofPools[a]=[];return this.grow(a),this.get()},grow:function(a,b){void 0===b&&(b=this._memPool.length>0?2*this._memPool.length:20);for(var c=this._memPool.length;c++<b;)this._memPool.push(new Array(a));return this}}},osgDB={};osgDB.ObjectWrapper={},osgDB.ObjectWrapper.serializers={},osgDB.readImage=function(a,b){return osgDB.registry().readImageURL(a,b)},osgDB.readImageURL=osgDB.readImage,osgDB.readNodeURL=function(a,b){return osgDB.registry().readNodeURL(a,b)},osgDB.registry=function(){return void 0===osgDB.registry._input&&(osgDB.registry._input=new osgDB.Input),osgDB.registry._input},osgDB.parseSceneGraph=function(a,b){if(!(void 0!==a.Version&&a.Version>0))return osgDB.parseSceneGraph_deprecated(a);var c=function(a){for(var b=Object.keys(a),c=0,d=b.length;d>c;c++)if("Generator"!==b[c]&&"Version"!==b[c])return b[c];return void 0},d=c(a);if(d){var e={};e[d]=a[d];var f=new osgDB.Input(e);return f.setImageLoadingOptions(osgDB.registry().getImageLoadingOptions()),void 0!==b&&(f.setProgressXHRCallback(b.progressXHRCallback),f.setPrefixURL(b.prefixURL)),f.readObject()}osg.log("can't parse scenegraph "+a)},osgDB.parseSceneGraph_deprecated=function(a){var b,c=function(a,b){var c=b[a];return void 0===c&&(c=b[a.toLowerCase()]),c},d=function(a,b){var d=c("Name",b);d&&void 0!==a.setName&&a.setName(d)},e=function(a,b){d(a,b),a.setAmbient(c("Ambient",b)),a.setDiffuse(c("Diffuse",b)),a.setEmission(c("Emission",b)),a.setSpecular(c("Specular",b)),a.setShininess(c("Shininess",b))},f=function(a,b){d(a,b),a.setSourceRGB(b.SourceRGB),a.setSourceAlpha(b.SourceAlpha),a.setDestinationRGB(b.DestinationRGB),a.setDestinationAlpha(b.DestinationAlpha)},g=function(a,b){var d=b.MagFilter||b.mag_filter||void 0;d&&a.setMagFilter(d);var e=b.MinFilter||b.min_filter||void 0;e&&a.setMinFilter(e);var f=b.WrapT||b.wrap_t||void 0;f&&a.setWrapT(f);var g=b.WrapS||b.wrap_s||void 0;g&&a.setWrapS(g);var h=c("File",b);osgDB.Promise.when(osgDB.readImage(h)).then(function(b){a.setImage(b)})},h=function(a,b){d(a,b);var h=c("Textures",b)||c("TextureAttributeList",b)||void 0;if(h)for(var i=0,j=h.length;j>i;i++){var k=c("File",h[i]);if(k){var l=new osg.Texture;g(l,h[i]),a.setTextureAttributeAndMode(i,l),a.addUniform(osg.Uniform.createInt1(i,"Texture"+i))}else osg.log("no texture on unit "+i+" skip it")}var m=c("BlendFunc",b);if(m){var n=new osg.BlendFunc;f(n,m),a.setAttributeAndMode(n)}var o=c("Material",b);if(o){var p=new osg.Material;e(p,o),a.setAttributeAndMode(p)}},i=a.children,j=a.primitives||a.Primitives||void 0,k=a.attributes||a.Attributes||void 0;if(j||k){b=new osg.Geometry,d(b,a),osg.extend(b,a),a=b,a.primitives=j,a.attributes=k;for(var l=0,m=j.length;m>l;l++){var n=j[l].mode;if(j[l].indices){var o=j[l].indices;o=new osg.BufferArray(osg.BufferArray[o.type],o.elements,o.itemSize),n=n?osg.PrimitiveSet[n]:gl.TRIANGLES,j[l]=new osg.DrawElements(n,o)}else{n=gl[n];var p=j[l].first,q=j[l].count;j[l]=new osg.DrawArrays(n,p,q)}}for(var r in k)if(k.hasOwnProperty(r)){var s=k[r];k[r]=new osg.BufferArray(gl[s.type],s.elements,s.itemSize)}}var t=c("StateSet",a);if(t){var u=new osg.StateSet;h(u,t),a.stateset=u}var v=a.matrix||a.Matrix||void 0;v&&(b=new osg.MatrixTransform,d(b,a),osg.extend(b,a),b.setMatrix(osg.Matrix.copy(v)),a=b);var w=a.projection||a.Projection||void 0;if(w&&(b=new osg.Projection,d(b,a),osg.extend(b,a),b.setProjectionMatrix(osg.Matrix.copy(w)),a=b),void 0===a.objectType&&(b=new osg.Node,d(b,a),osg.extend(b,a),a=b),i){a.children=[];for(var x=0,y=i.length;y>x;x++)a.addChild(osgDB.parseSceneGraph_deprecated(i[x]))}return a},osgDB.Input=function(a,b){this._json=a;var c=b;void 0===c&&(c={}),this._identifierMap=c,this._objectRegistry={},this._progressXHRCallback=void 0,this._prefixURL="",this.setImageLoadingOptions({promise:!0,onload:void 0})},osgDB.Input.prototype={setImageLoadingOptions:function(a){this._defaultImageOptions=a},getImageLoadingOptions:function(){return this._defaultImageOptions},setProgressXHRCallback:function(a){this._progressXHRCallback=a},registerObject:function(a,b){this._objectRegistry[a]=b},getJSON:function(){return this._json},setJSON:function(a){return this._json=a,this},setPrefixURL:function(a){this._prefixURL=a},getPrefixURL:function(){return this._prefixURL},computeURL:function(a){return void 0===this._prefixURL?a:this._prefixURL+a},getObjectWrapper:function(a){if(void 0!==this._objectRegistry[a])return new this._objectRegistry[a];for(var b=window,c=a.split("."),d=0,e=c.length;e>d;d++){var f=b[c[d]];if(void 0===f)return void 0;b=f}return new b},fetchImage:function(a,b,c,d){var e="data:image/",f=b.substring(0,e.length)===e;return!f&&c.crossOrigin&&(a.crossOrigin=c.crossOrigin),f&&""!==a.crossOrigin?this.readImageURL(b,c,d):(a.src=b,a)},readImageURL:function(a,b,c){var d=this;"data:image"!==a.substr(0,10)&&(a=this.computeURL(a)),void 0===b&&(b=this._defaultImageOptions);var e=c;b.promise===!0&&void 0===c&&(e=osgDB.Promise.defer());var f=new Image;return f.onerror=function(){osg.warn("warning use white texture as fallback instead of "+a),d.fetchImage(this,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",b,e)},b.promise!==!0?(void 0!==b.onload&&(f.onload=b.onload),this.fetchImage(f,a,b)):(f.onload=function(){void 0!==b.onload&&b.onload.call(this),e.resolve(f)},this.fetchImage(f,a,b,e),e.promise)},readNodeURL:function(a,b){a=this.computeURL(a);var c=osgDB.Promise,d=c.defer();b=b||{};var e={progressXHRCallback:b.progressXHRCallback,prefixURL:b.prefixURL,defaultImageOptions:b.defaultImageOptions};if(void 0===e.prefixURL){var f=this.getPrefixURL(),g=a.lastIndexOf("/");-1!==g&&(f=a.substring(0,g+1)),e.prefixURL=f}var h=new XMLHttpRequest;return h.open("GET",a,!0),h.onreadystatechange=function(){4==h.readyState&&(200==h.status?c.when(osgDB.parseSceneGraph(JSON.parse(h.responseText),e),function(b){d.resolve(b),osg.log("loaded "+a)}).fail(function(a){d.reject(a)}):d.reject(h.status))},h.send(null),d.promise},readBinaryArrayURL:function(a){if(a=this.computeURL(a),void 0!==this._identifierMap[a])return this._identifierMap[a];var b=osgDB.Promise.defer(),c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="arraybuffer",this._progressXHRCallback&&c.addEventListener("progress",this._progressXHRCallback,!1),c.addEventListener("error",function(){b.reject()},!1);var d=this;return c.addEventListener("load",function(){var e=c.response;e?(d._identifierMap[a]=e,b.resolve(e)):b.reject()},!1),c.send(null),this._identifierMap[a]=b.promise,b.promise},readBufferArray:function(){var a,c=this.getJSON(),d=c.UniqueID;if(void 0!==d&&(a=this._identifierMap[d],void 0!==a))return a;var e=function(a){return void 0===a.Elements&&void 0===a.Array||void 0===a.ItemSize||!a.Type?!1:!0};if(e(c)){var f,g;if(void 0!==c.Elements)f=new osg.BufferArray(osg.BufferArray[c.Type],c.Elements,c.ItemSize);else if(void 0!==c.Array){var h=new osg.BufferArray(osg.BufferArray[c.Type]);h.setItemSize(c.ItemSize);var i,j;if(void 0!==c.Array.Float32Array?(i=c.Array.Float32Array,j="Float32Array"):void 0!==c.Array.Uint16Array?(i=c.Array.Uint16Array,j="Uint16Array"):(osg.warn("Typed Array "+Object.keys(o.Array)[0]),j="Float32Array"),void 0!==i)if(void 0!==i.File){var k=i.File;
g=osgDB.Promise.defer(),osgDB.Promise.when(this.readBinaryArrayURL(k)).then(function(a){var c,d;!function(){var a=new Uint8Array([18,52]),b=new Uint16Array(a.buffer);d="1234"===b[0].toString(16)}();var e=0;void 0!==i.Offset&&(e=i.Offset);var f=osg[j].BYTES_PER_ELEMENT,k=i.Size,m=h.getItemSize(),n=k*f*m;if(d){osg.log("big endian detected");var o=osg[j],p=new o(k*m),q=new DataView(a,e,n),r=0,s=p.length;if("Uint16Array"===j)for(;s>r;r++)tempArray[r]=q.getUint16(r*f,!0);else if("Float32Array"===j)for(;s>r;r++)tempArray[r]=q.getFloat32(r*f,!0);c=tempArray,q=null}else c=new osg[j](a,e,m*k);l=b=null,h.setElements(c),g.resolve(h)})}else if(void 0!==i.Elements){var l=new osg[j](i.Elements);h.setElements(l)}f=h}return void 0!==d&&(this._identifierMap[d]=f),void 0!==g?g.promise:f}},readUserDataContainer:function(){var a,b=this.getJSON(),c=b.UniqueID;return void 0!==c&&(a=this._identifierMap[c],void 0!==a)?a.Values:(this._identifierMap[c]=b,b.Values)},readPrimitiveSet:function(){var a,b,c,d,e=this.getJSON(),f=e.DrawElementUShort||e.DrawElementUByte||e.DrawElementUInt||e.DrawElementsUShort||e.DrawElementsUByte||e.DrawElementsUInt||void 0;if(f){if(a=f.UniqueID,void 0!==a&&(b=this._identifierMap[a],void 0!==b))return b;d=osgDB.Promise.defer();var g=f.Indices,h=e;mode=f.Mode,mode=mode?osg.PrimitiveSet[mode]:osg.PrimitiveSet.TRIANGLES,c=new osg.DrawElements(mode),this.setJSON(g),osgDB.Promise.when(this.readBufferArray()).then(function(a){c.setIndices(a),d.resolve(c)}),this.setJSON(h)}var i=e.DrawArray||e.DrawArrays;if(i){if(a=i.UniqueID,void 0!==a&&(b=this._identifierMap[a],void 0!==b))return b;mode=i.Mode||i.mode,first=void 0!==i.First?i.First:i.first,count=void 0!==i.Count?i.Count:i.count;var j=new osg.DrawArrays(osg.PrimitiveSet[mode],first,count);c=j}var k=e.DrawArrayLengths||void 0;if(k){if(a=k.UniqueID,void 0!==a&&(b=this._identifierMap[a],void 0!==b))return b;mode=k.Mode,first=k.First;var l=k.ArrayLengths,m=new osg.DrawArrayLengths(osg.PrimitiveSet[mode],first,l);c=m}return void 0!==a&&(this._identifierMap[a]=c),d?d.promise:c},readObject:function(){var a=this.getJSON(),b=Object.keys(a)[0];if(!b)return osg.warn("can't find property for object "+a),void 0;var c,d=a[b].UniqueID;if(void 0!==d&&(c=this._identifierMap[d],void 0!==c))return c;var e=this.getObjectWrapper(b);if(!e)return osg.warn("can't instanciate object "+b),void 0;for(var f=osgDB.ObjectWrapper.serializers,g=b.split("."),h=0,i=g.length;i>h;h++){var j=f[g[h]];if(void 0===j)return osg.warn("can't find function to read object "+b+" - undefined"),void 0;f=j}var k=f(this.setJSON(a[b]),e);return void 0!==d&&(this._identifierMap[d]=e,e._uniqueID=d),k}},osgDB.Promise={},function(){var a=osgDB.Promise;!function(b){if("function"==typeof define)define(b);else if("object"==typeof a)b(void 0,a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=function(){var a={};return b(void 0,a)}}else b(void 0,Q={})}(function(a,b){"use strict";function c(a){return"[object StopIteration]"===fb(a)||a instanceof $}function d(a,b){var c=[];try{c.push(a.toString())}catch(d){try{c.push("<error: "+d+">")}catch(f){c.push("<error>")}}for(var g=0;g<b.length;g++){var h,i=b[g];if("string"==typeof i)c.push(i);else{try{h=e(i)}catch(d){try{h="<error: "+d+">"}catch(f){h="<error>"}}c.push("    at "+h)}}return c.join("\n")}function e(a){var b="";if(a.isNative())b="native";else if(a.isEval())b="eval at "+a.getEvalOrigin();else{var c=a.getFileName();if(c){b+=c;var d=a.getLineNumber();if(null!==d){b+=":"+d;var e=a.getColumnNumber();e&&(b+=":"+e)}}}b||(b="unknown source");var f="",g=a.getFunction().name,h=!0,i=a.isConstructor(),j=!(a.isToplevel()||i);if(j){var k=a.getMethodName();f+=a.getTypeName()+".",g?(f+=g,k&&k!==g&&(f+=" [as "+k+"]")):f+=k||"<anonymous>"}else i?f+="new "+(g||"<anonymous>"):g?f+=g:(f+=b,h=!1);return h&&(f+=" ("+b+")"),f}function f(a){var b=Error.prepareStackTrace;Error.prepareStackTrace=function(a,b){return b.filter(function(a){var b=a.getFileName();return"module.js"!==b&&"node.js"!==b&&b!==gb})};var c=a.stack;return Error.prepareStackTrace=b,c}function g(a){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn,a.apply(a,arguments)}}function h(){function a(a){return c?(b=q(a),ab(c,function(a,c){U(function(){b.promiseSend.apply(b,c)})},void 0),c=void 0,b):void 0}var b,c=[],d=db(h.prototype),e=db(j.prototype);return e.promiseSend=function(){var a=_(arguments);c?c.push(a):U(function(){b.promiseSend.apply(b,a)})},e.valueOf=function(){return c?e:b.valueOf()},Error.captureStackTrace&&Error.captureStackTrace(e,h),T(e),d.promise=e,d.resolve=a,d.reject=function(b){return a(p(b))},d}function i(a){var b=h();return C(a,void 0,b.resolve,b.reject).fail(b.reject),b.promise}function j(a,b,c,d){void 0===b&&(b=function(a){return p(new Error("Promise does not support operation: "+a))});var e=db(j.prototype);return e.promiseSend=function(c,d){var f,g=_(arguments,2);try{f=a[c]?a[c].apply(e,g):b.apply(e,[c].concat(g))}catch(h){f=p(h)}d(f)},c&&(e.valueOf=c),d&&(e.exception=d),T(e),e}function k(a){return Object(a)!==a?a:a.valueOf()}function l(a){return a&&"function"==typeof a.promiseSend}function m(a){return n(a)||o(a)}function n(a){return!l(k(a))}function o(a){return a=k(a),l(a)&&"exception"in a}function p(a){a=a||new Error;var b=j({when:function(b){if(b){var c=bb(hb,this);-1!==c&&(ib.splice(c,1),hb.splice(c,1))}return b?b(a):p(a)}},function(){return p(a)},function(){return this},a);return hb.push(b),ib.push(a),b}function q(a){if(l(a))return a;if(a&&"function"==typeof a.then){var b=h();return a.then(b.resolve,b.reject),b.promise}return j({when:function(){return a},get:function(b){return a[b]},put:function(b,c){return a[b]=c},del:function(b){return delete a[b]},post:function(b,c){return a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},fapply:function(b){return a.apply(void 0,b)},viewInfo:function(){function b(a){d[a]||(d[a]=typeof c[a])}for(var c=a,d={};c;)Object.getOwnPropertyNames(c).forEach(b),c=Object.getPrototypeOf(c);return{type:typeof a,properties:d}},keys:function(){return eb(a)}},void 0,function(){return a})}function r(a){return j({isDef:function(){}},function(){var b=_(arguments);return z.apply(void 0,[a].concat(b))},function(){return k(a)})}function s(a,b){return a=q(a),b?j({viewInfo:function(){return b}},function(){var b=_(arguments);return z.apply(void 0,[a].concat(b))},function(){return k(a)}):z(a,"viewInfo")}function t(a){return s(a).when(function(b){var c;c="function"===b.type?function(){return kb(a,void 0,arguments)}:{};var d=b.properties||{};return eb(d).forEach(function(b){"function"===d[b]&&(c[b]=function(){return jb(a,b,arguments)})}),q(c)})}function u(a,b,c){function d(a){try{return b?b(a):a}catch(c){return p(c)}}function e(a){try{return c?c(a):p(a)}catch(b){return p(b)}}var f=h(),g=!1;return U(function(){q(a).promiseSend("when",function(a){g||(g=!0,q(a).promiseSend("when",function(a){f.resolve(d(a))},function(a){f.resolve(e(a))}))},function(a){g||(g=!0,f.resolve(e(a)))})}),f.promise}function v(a,b,c){return u(a,function(a){return b.apply(void 0,a)},c)}function w(a){return function(){function b(a,b){var g;try{g=d[a](b)}catch(h){return c(h)?h.value:p(h)}return u(g,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"send"),f=b.bind(b,"throw");return e()}}function x(a){throw new $(a)}function y(a){return function(b){var c=_(arguments,1);return z.apply(void 0,[b,a].concat(c))}}function z(a,b){var c=h(),d=_(arguments,2);return a=q(a),U(function(){a.promiseSend.apply(a,[b,c.resolve].concat(d))}),c.promise}function A(a,b,c){var d=h();return a=q(a),U(function(){a.promiseSend.apply(a,[b,d.resolve].concat(c))}),d.promise}function B(a){return function(b){var c=_(arguments,1);return A(b,a,c)}}function C(a,b){var c=_(arguments,2);return kb(a,b,c)}function D(a){var b=_(arguments,1);return lb(a,b)}function E(a,b){var c=_(arguments,2);return function(){var d=c.concat(_(arguments));return kb(a,b,d)}}function F(a){var b=_(arguments,1);return function(){var c=b.concat(_(arguments));return lb(a,c)}}function G(a){return u(a,function(a){var b=a.length;if(0===b)return q(a);var c=h();return ab(a,function(d,e,f){u(e,function(d){a[f]=d,0===--b&&c.resolve(a)}).fail(c.reject)},void 0),c.promise})}function H(a){return u(a,function(a){return u(G(cb(a,function(a){return u(a,S,S)})),function(){return cb(a,q)})})}function I(a,b){return u(a,void 0,b)}function J(a,b){return u(a,function(a){return u(b(),function(){return a})},function(a){return u(b(),function(){return p(a)})})}function K(a){u(a,void 0,function(b){U(function(){if(Error.captureStackTrace&&"stack"in b){var c=f(b),e=f(a),g=c.concat("From previous event:",e);b.stack=d(b,g)}throw b})})}function L(a,b){var c=h(),d=setTimeout(function(){c.reject(new Error("Timed out after "+b+" ms"))},b);return u(a,function(a){clearTimeout(d),c.resolve(a)},c.reject),c.promise}function M(a,b){void 0===b&&(b=a,a=void 0);var c=h();return setTimeout(function(){c.resolve(a)},b),c.promise}function N(a,b,c){return P(a,b).apply(void 0,c)}function O(a,b){var c=_(arguments,2);return N(a,b,c)}function P(a){if(arguments.length>1){var b=arguments[1],c=_(arguments,2),d=a;a=function(){var a=c.concat(_(arguments));return d.apply(b,a)}}return function(){var b=h(),c=_(arguments);return c.push(b.makeNodeResolver()),lb(a,c).fail(b.reject),b.promise}}function Q(a,b,c){return N(a[b],a,c)}function R(a,b){var c=_(arguments,2);return N(a[b],a,c)}var S=function(){},T=Object.freeze||S;"undefined"!=typeof cajaVM&&(T=cajaVM.def);var U;if("undefined"!=typeof process)U=process.nextTick;else if("function"==typeof msSetImmediate)U=msSetImmediate.bind(window);else if("function"==typeof setImmediate)U=setImmediate;else if("undefined"!=typeof MessageChannel){var V=new MessageChannel,W={},X=W;V.port1.onmessage=function(){W=W.next;var a=W.task;delete W.task,a()},U=function(a){X=X.next={task:a},V.port2.postMessage(0)}}else U=function(a){setTimeout(a,0)};var Y;if(Function.prototype.bind){var Z=Function.prototype.bind;Y=Z.bind(Z.call)}else Y=function(a){return function(){return a.call.apply(a,arguments)}};var $,_=Y(Array.prototype.slice),ab=Y(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),bb=Y(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),cb=Y(Array.prototype.map||function(a,b){var c=this,d=[];return ab(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),db=Object.create||function(a){function b(){}return b.prototype=a,new b},eb=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b},fb=Object.prototype.toString;$="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var gb;Error.captureStackTrace&&(gb=function(){var a,b=Error.prepareStackTrace;return Error.prepareStackTrace=function(b,c){a=c[0].getFileName()},(new Error).stack,Error.prepareStackTrace=b,a}()),b.nextTick=U,b.defer=h,h.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve(_(arguments,1)):a.resolve(c)}},h.prototype.node=g(h.prototype.makeNodeResolver,"node","makeNodeResolver"),b.promise=i,b.makePromise=j,j.prototype.then=function(a,b){return u(this,a,b)},ab(["isResolved","isFulfilled","isRejected","when","spread","send","get","put","del","post","invoke","keys","apply","call","bind","fapply","fcall","fbind","all","allResolved","view","viewInfo","timeout","delay","catch","finally","fail","fin","end"],function(a,c){j.prototype[c]=function(){return b[c].apply(b,[this].concat(_(arguments)))}},void 0),j.prototype.toSource=function(){return this.toString()},j.prototype.toString=function(){return"[object Promise]"},T(j.prototype),b.nearer=k,b.isPromise=l,b.isResolved=m,b.isFulfilled=n,b.isRejected=o;var hb=[],ib=[];"undefined"!=typeof window&&window.console,b.reject=p,b.begin=q,b.resolve=q,b.ref=g(q,"ref","resolve"),b.master=r,b.viewInfo=s,b.view=t,b.when=u,b.spread=v,b.async=w,b["return"]=x,b.sender=g(y,"sender","dispatcher"),b.Method=g(y,"Method","dispatcher"),b.send=g(z,"send","dispatch"),b.dispatch=A,b.dispatcher=B,b.get=B("get"),b.put=B("put"),b["delete"]=b.del=B("del");var jb=b.post=B("post");b.invoke=function(a,b){var c=_(arguments,2);return jb(a,b,c)};var kb=b.apply=g(B("apply"),"apply","fapply"),lb=b.fapply=B("fapply");b.call=g(C,"call","fcall"),b["try"]=D,b.fcall=D,b.bind=g(E,"bind","fbind"),b.fbind=F,b.keys=B("keys"),b.all=G,b.allResolved=H,b["catch"]=b.fail=I,b["finally"]=b.fin=J,b.end=K,b.timeout=L,b.delay=M,b.napply=N,b.ncall=O,b.nbind=P,b.npost=Q,b.ninvoke=R,T(b)})}();var osgViewer={};WebGLUtils=function(){var a=function(a){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+a+"</div>"},b='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',c='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>',d=function(d,f,g){function h(d){var e=document.getElementsByTagName("body")[0];if(e){var f=window.WebGLRenderingContext?c:b;d&&(f+="<br/><br/>Status: "+d),e.innerHTML=a(f)}}g=g||h,d.addEventListener&&d.addEventListener("webglcontextcreationerror",function(a){g(a.statusMessage)},!1);var i=e(d,f);return i||(window.WebGLRenderingContext?g(""):g("")),i},e=function(a,b){for(var c=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=null,e=0;e<c.length;++e){try{d=a.getContext(c[e],b)}catch(f){}if(d)break}return d};return{create3DContext:e,setupWebGL:d}}(),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()),window.cancelRequestAnimFrame||(window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()),Date.now||(Date.now=function(){return(new Date).getTime()}),osg.performance={},osg.performance.now=function(){if(void 0===window.performance)return function(){return Date.now()};var a=window.performance.now||window.performance.mozNow||window.performance.msNow||window.performance.oNow||window.performance.webkitNow||function(){return Date.now()};return function(){return a.apply(window.performance,arguments)}}(),WebGLDebugUtils=function(){function a(a){if(null===l){l={};for(var b in a)"number"==typeof a[b]&&(l[a[b]]=b)}}function b(){if(null===l)throw"WebGLDebugUtils.init(ctx) not called"}function c(a){return b(),void 0!==l[a]}function d(a){b();var c=l[a];return void 0!==c?c:"*UNKNOWN WebGL ENUM (0x"+a.toString(16)+")"}function e(a,b,c){var e=k[a];return void 0!==e&&e[b]?d(c):c.toString()}function f(a,b,c){a.__defineGetter__(c,function(){return b[c]}),a.__defineSetter__(c,function(a){b[c]=a})}function g(b,c){function g(a,b){return function(){var d=a[b].apply(a,arguments),e=a.getError();return 0!==e&&(h[e]=!0,c(e,b,arguments)),d}}a(b),c=c||function(a,b,c){for(var f="",g=0;g<c.length;++g)f+=(0===g?"":", ")+e(b,g,c[g]);j("WebGL error "+d(a)+" in "+b+"("+f+")")};var h={},i={};for(var k in b)"function"==typeof b[k]?i[k]=g(b,k):f(i,b,k);return i.getError=function(){for(var a in h)if(h[a])return h[a]=!1,a;return b.NO_ERROR},i}function h(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);var d;for(d=0;b>d;++d)a.disableVertexAttribArray(d),a.vertexAttribPointer(d,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(d,0);a.deleteBuffer(c);var e=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(d=0;e>d;++d)a.activeTexture(a.TEXTURE0+d),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);for(a.activeTexture(a.TEXTURE0),a.useProgram(null),a.bindBuffer(a.ARRAY_BUFFER,null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),a.bindFramebuffer(a.FRAMEBUFFER,null),a.bindRenderbuffer(a.RENDERBUFFER,null),a.disable(a.BLEND),a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),a.disable(a.DITHER),a.disable(a.SCISSOR_TEST),a.blendColor(0,0,0,0),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ONE,a.ZERO),a.clearColor(0,0,0,0),a.clearDepth(1),a.clearStencil(-1),a.colorMask(!0,!0,!0,!0),a.cullFace(a.BACK),a.depthFunc(a.LESS),a.depthMask(!0),a.depthRange(0,1),a.frontFace(a.CCW),a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE),a.lineWidth(1),a.pixelStorei(a.PACK_ALIGNMENT,4),a.pixelStorei(a.UNPACK_ALIGNMENT,4),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL),a.polygonOffset(0,0),a.sampleCoverage(1,!1),a.scissor(0,0,a.canvas.width,a.canvas.height),a.stencilFunc(a.ALWAYS,0,4294967295),a.stencilMask(4294967295),a.stencilOp(a.KEEP,a.KEEP,a.KEEP),a.viewport(0,0,a.canvas.width,a.canvas.height),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}function i(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function c(a){var b=a.addEventListener;a.addEventListener=function(c,d){switch(c){case"webglcontextlost":x(d);break;case"webglcontextrestored":y(d);break;default:b.apply(a,arguments)}}}function d(){for(var a=Object.keys(w),b=0;b<a.length;++b)delete w[a]}function e(){++t,q||s==t&&a.loseContext()}function g(a,b){var c=a[b];return function(){if(e(),!q){var b=c.apply(a,arguments);return b}}}function i(){for(var a=0;a<r.length;++a){var b=r[a];b instanceof WebGLBuffer?l.deleteBuffer(b):b instanceof WebGLFramebuffer?l.deleteFramebuffer(b):b instanceof WebGLProgram?l.deleteProgram(b):b instanceof WebGLRenderbuffer?l.deleteRenderbuffer(b):b instanceof WebGLShader?l.deleteShader(b):b instanceof WebGLTexture&&l.deleteTexture(b)}}function j(a){return{statusMessage:a,preventDefault:function(){u=!0}}}function k(a){for(var b in a)"function"==typeof a[b]?o[b]=g(a,b):f(o,a,b);o.getError=function(){e();var a;if(!q)for(;a=l.getError();)w[a]=!0;for(a in w)if(w[a])return delete w[a],a;return o.NO_ERROR};var c,d,h=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];for(d=0;d<h.length;++d)c=h[d],o[c]=function(b){return function(){if(e(),q)return null;var c=b.apply(a,arguments);return c.__webglDebugContextLostId__=p,r.push(c),c}}(a[c]);var i=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(d=0;d<i.length;++d)c=i[d],o[c]=function(b){return function(){return e(),q?null:b.apply(a,arguments)}}(o[c]);var j=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(d=0;d<j.length;++d)c=j[d],o[c]=function(b){return function(){return e(),q?!1:b.apply(a,arguments)}}(o[c]);return o.checkFramebufferStatus=function(b){return function(){return e(),q?o.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(o.checkFramebufferStatus),o.getAttribLocation=function(b){return function(){return e(),q?-1:b.apply(a,arguments)}}(o.getAttribLocation),o.getVertexAttribOffset=function(b){return function(){return e(),q?0:b.apply(a,arguments)}}(o.getVertexAttribOffset),o.isContextLost=function(){return q},o}var l,m=[],n=[],o={},p=1,q=!1,r=[],s=0,t=0,u=!1,v=0,w={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=l){if(l)throw"got different context";l=c,o=k(l)}return o}return c}}(a.getContext);var x=function(a){m.push(b(a))},y=function(a){n.push(b(a))};return c(a),a.loseContext=function(){if(!q){for(q=!0,s=0,++p;l.getError(););d(),w[l.CONTEXT_LOST_WEBGL]=!0;var b=j("context lost"),c=m.slice();setTimeout(function(){for(var d=0;d<c.length;++d)c[d](b);v>=0&&setTimeout(function(){a.restoreContext()},v)},0)}},a.restoreContext=function(){q&&n.length&&setTimeout(function(){if(!u)throw"can not restore. webglcontestlost listener did not call event.preventDefault";i(),h(l),q=!1,t=0,u=!1;for(var a=n.slice(),b=j("context restored"),c=0;c<a.length;++c)a[c](b)},0)},a.loseContextInNCalls=function(a){if(q)throw"You can not ask a lost contet to be lost";s=t+a},a.getNumCalls=function(){return t},a.setRestoreTimeout=function(a){v=a},a}var j=function(a){window.console&&window.console.log&&window.console.log(a)},k={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},l=null;return{init:a,mightBeEnum:c,glEnumToString:d,glFunctionArgToString:e,makeDebugContext:g,makeLostContextSimulatingCanvas:i,resetToInitialState:h}}();var Stats={};Stats.Stats=function(a,b){this.layers=[],this.last_update=void 0,this.canvas=a,this.text_canvas=b,this.numberUpdate=0},Stats.Stats.prototype={addLayer:function(a,b,c,d){void 0===a&&(a="rgb(255,255,255)"),this.layers.push({previous:0,color:a,getValue:c,getText:d,average:0,max:b})},update:function(){var a,b,c,d,e,f,g,h,i,j=osg.performance.now();for(void 0===this.last_update&&(this.last_update=j),this.numberUpdate++,b=0,c=this.layers.length;c>b;b++)d=this.layers[b],e=d.getValue(j),d.average+=e;if(b=.12,a=(j-this.last_update)*b,a>=1)for(j-=(a-Math.floor(a))/b,a=Math.floor(a),f=this.canvas,g=f.getContext("2d"),i=g.getImageData(a,0,f.width-a,f.height),g.putImageData(i,0,0),g.clearRect(f.width-a,0,a,f.height),b=0,c=this.layers.length;c>b;b++)d=this.layers[b],e=d.getValue(j),e*=f.height/d.max,e>f.height&&(e=f.height),g.lineWidth=1,g.strokeStyle=d.color,g.beginPath(),g.moveTo(f.width-a,f.height-d.previous),g.lineTo(f.width,f.height-e),g.stroke(),d.previous=e;if(0===this.numberUpdate%60){for(f=this.text_canvas,g=f.getContext("2d"),g.font="14px Sans",h=17,a=h,g.clearRect(0,0,f.width,f.height),b=0,c=this.layers.length;c>b;b++)d=this.layers[b],e=d.getText(d.average/this.numberUpdate),d.average=0,g.fillStyle=d.color,g.fillText(e,0,a),a+=h;this.numberUpdate=0}this.last_update=j}},osgViewer.View=function(){this._graphicContext=void 0,this._camera=new osg.Camera,this._scene=new osg.Node,this._sceneData=void 0,this._frameStamp=new osg.FrameStamp,this._lightingMode=void 0,this._manipulator=void 0,this.setLightingMode(osgViewer.View.LightingMode.HEADLIGHT),this._scene.getOrCreateStateSet().setAttributeAndMode(new osg.Material),this._scene.getOrCreateStateSet().setAttributeAndMode(new osg.Depth),this._scene.getOrCreateStateSet().setAttributeAndMode(new osg.BlendFunc),this._scene.getOrCreateStateSet().setAttributeAndMode(new osg.CullFace)},osgViewer.View.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2},osgViewer.View.prototype={setGraphicContext:function(a){this._graphicContext=a},getGraphicContext:function(){return this._graphicContext},setUpView:function(a){var b=0!==a.width?a.width:800,c=0!==a.height?a.height:600,d=b/c;this._camera.setViewport(new osg.Viewport(0,0,b,c)),osg.Matrix.makeLookAt([0,0,-10],[0,0,0],[0,1,0],this._camera.getViewMatrix()),osg.Matrix.makePerspective(55,d,1,1e3,this._camera.getProjectionMatrix())},computeIntersections:function(a,b,c){void 0===c&&(c=-1);var d=new osgUtil.IntersectVisitor;return d.setTraversalMask(c),d.addLineSegment([a,b,0],[a,b,1]),d.pushCamera(this._camera),this._sceneData.accept(d),d.hits},setFrameStamp:function(a){this._frameStamp=a},getFrameStamp:function(){return this._frameStamp},setCamera:function(a){this._camera=a},getCamera:function(){return this._camera},setSceneData:function(a){this._scene.removeChildren(),this._scene.addChild(a),this._sceneData=a},getSceneData:function(){return this._sceneData},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},setManipulator:function(a){this._manipulator=a},getLight:function(){return this._light},setLight:function(a){this._light=a,this._lightingMode!==osgViewer.View.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndMode(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(a){this._lightingMode!==a&&(this._lightingMode=a,this._lightingMode!==osgViewer.View.LightingMode.NO_LIGHT?this._light||(this._light=new osg.Light,this._light.setAmbient([.2,.2,.2,1]),this._light.setDiffuse([.8,.8,.8,1]),this._light.setSpecular([.5,.5,.5,1])):this._light=void 0)}},function(){var a=function(){for(var a,b=[],c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++){a=c[d].split("=");var e=a[0].toLowerCase();b.push(e);var f=a[1];void 0===f&&(f="1"),b[e]=f.toLowerCase()}return b},b=a();if(void 0!==b.log){var c=b.log.toLowerCase();switch(c){case"debug":osg.setNotifyLevel(osg.DEBUG);break;case"info":osg.setNotifyLevel(osg.INFO);break;case"notice":osg.setNotifyLevel(osg.NOTICE);break;case"warn":osg.setNotifyLevel(osg.WARN);break;case"error":osg.setNotifyLevel(osg.ERROR);break;case"html":!function(){var a=[],b=document.createElement("div"),c=document.createElement("pre");document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(b),b.appendChild(c)});var d=function(b){a.unshift(b),c.innerHTML=a.join("\n")};b.style.overflow="hidden",b.style.position="absolute",b.style.zIndex="10000",b.style.height="100%",b.style.maxWidth="600px",c.style.overflow="scroll",c.style.width="105%",c.style.height="100%",c.style.fontSize="10px",["log","error","warn","info","debug"].forEach(function(a){window.console[a]=d})}()}}}(),osgViewer.Viewer=function(a,b,c){osgViewer.View.call(this),void 0===b&&(b={antialias:!0}),this._options=b,osg.SimulateWebGLLostContext&&(a=WebGLDebugUtils.makeLostContextSimulatingCanvas(a),a.loseContextInNCalls(osg.SimulateWebGLLostContext)),gl=WebGLUtils.setupWebGL(a,b,c);var d=this;if(a.addEventListener("webglcontextlost",function(a){d.contextLost(),a.preventDefault()},!1),a.addEventListener("webglcontextrestored",function(){d.contextRestored()},!1),(osg.reportWebGLError||b.reportWebGLError)&&(gl=WebGLDebugUtils.makeDebugContext(gl)),!gl)throw"No WebGL implementation found";this.setGraphicContext(gl),osg.init(),this._canvas=a,this._frameRate=60,osgUtil.UpdateVisitor=osg.UpdateVisitor,osgUtil.CullVisitor=osg.CullVisitor,this._urlOptions=!0;var e=this._options.EventBackend||{};this._options.EventBackend=e,e.StandardMouseKeyboard=this._options.EventBackend.StandardMouseKeyboard||{};var f=e.StandardMouseKeyboard.mouseEventNode||b.mouseEventNode||a;e.StandardMouseKeyboard.mouseEventNode=f,e.StandardMouseKeyboard.keyboardEventNode=e.StandardMouseKeyboard.keyboardEventNode||document,e.Hammer=e.Hammer||{},e.Hammer.eventNode=e.Hammer.eventNode||b.mouseEventNode||a,e.GamePad=e.GamePad||{},this.setUpView(a)},osgViewer.Viewer.prototype=osg.objectInehrit(osgViewer.View.prototype,{contextLost:function(){osg.log("webgl context lost"),window.cancelRequestAnimFrame(this._requestID)},contextRestored:function(){osg.log("webgl context restored, but not supported - reload the page")},init:function(){this._done=!1,this._state=new osg.State;var a=this.getGraphicContext();this._state.setGraphicContext(a),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),this._updateVisitor=new osgUtil.UpdateVisitor,this._cullVisitor=new osgUtil.CullVisitor,this._renderStage=new osg.RenderStage,this._stateGraph=new osg.StateGraph,this._urlOptions&&this.parseOptions(),this.getCamera().setClearColor([0,0,0,0]),this._eventProxy=this.initEventProxy(this._options)},getState:function(){return this._state},parseOptions:function(){var a=function(){for(var a,b=[],c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++){a=c[d].split("=");var e=a[0].toLowerCase();b.push(e);var f=a[1];void 0===f&&(f="1"),b[e]=f.toLowerCase()}return b},b=a();"1"===b.stats&&this.initStats(b);var c=this.getGraphicContext();"0"===b.depth_test&&this.getGraphicContext().disable(c.DEPTH_TEST),"0"===b.blend&&this.getGraphicContext().disable(c.BLEND),"0"===b.cull_face&&this.getGraphicContext().disable(c.CULL_FACE),"0"===b.light&&this.setLightingMode(osgViewer.View.LightingMode.NO_LIGHT)},initStats:function(a){var b=35,c=5;void 0!==a.statsMaxMS&&(b=parseInt(a.statsMaxMS,10)),void 0!==a.statsStepMS&&(c=parseInt(a.statsStepMS,10));var d=function(a){var d,e=["<div id='StatsDiv' style='top: 0; position: absolute; width: 300px; height: 150px; z-index: 10;'>","<div id='StatsCanvasDiv' style='position: relative;'>","<canvas id='StatsCanvasGrid' width='300' height='150' style='z-index:-1; position: absolute; background: rgba(14,14,14,0.8); ' ></canvas>","<canvas id='StatsCanvas' width='300' height='150' style='z-index:8; position: absolute;' ></canvas>","<canvas id='StatsCanvasText' width='300' height='150' style='z-index:9; position: absolute;' ></canvas>","</div>","</div>"].join("\n");d=void 0===a?document.body:document.getElementById(a);var f=document.createElement("div");f.innerHTML=e,d.appendChild(f);var g=document.getElementById("StatsCanvasGrid"),h=g.getContext("2d");h.clearRect(0,0,g.width,g.height);var i=Math.floor(b/c).toFixed(0),j=g.height/i;h.strokeStyle="rgb(70,70,70)";for(var k=0,l=i;l>k;k++)h.beginPath(),h.moveTo(0,k*j),h.lineTo(g.width,k*j),h.stroke();return{graph:document.getElementById("StatsCanvas"),text:document.getElementById("StatsCanvasText")}};if(void 0===this._canvasStats||null===this._canvasStats){var e=d();this._canvasStats=e.graph,this._canvasStatsText=e.text}this._stats=new Stats.Stats(this._canvasStats,this._canvasStatsText);var f=this;this._frameRate=1,this._frameTime=0,this._updateTime=0,this._cullTime=0,this._drawTime=0,this._stats.addLayer("#ff0fff",120,function(){return 1e3/f._frameRate},function(a){return"FrameRate: "+a.toFixed(0)+" fps"}),this._stats.addLayer("#ffff00",b,function(){return f._frameTime},function(a){return"FrameTime: "+a.toFixed(2)+" ms"}),this._stats.addLayer("#d07b1f",b,function(){return f._updateTime},function(a){return"UpdateTime: "+a.toFixed(2)+" ms"}),this._stats.addLayer("#73e0ff",b,function(){return f._cullTime},function(a){return"CullTime: "+a.toFixed(2)+" ms"}),this._stats.addLayer("#ff0000",b,function(){return f._drawTime},function(a){return"DrawTime: "+a.toFixed(2)+" ms"}),window.performance&&window.performance.memory&&window.performance.memory.totalJSHeapSize&&this._stats.addLayer("#00ff00",2*window.performance.memory.totalJSHeapSize,function(){return f._memSize},function(a){return"Memory : "+a.toFixed(0)+" b"})},update:function(){this.getScene().accept(this._updateVisitor)},cull:function(){this._stateGraph.clean(),this._renderStage.reset(),this._cullVisitor.reset(),this._cullVisitor.setStateGraph(this._stateGraph),this._cullVisitor.setRenderStage(this._renderStage);var a=this.getCamera();this._cullVisitor.pushStateSet(a.getStateSet()),this._cullVisitor.pushProjectionMatrix(a.getProjectionMatrix()),a.getBound();
var b=osg.Matrix.makeIdentity([]);this._cullVisitor.pushModelviewMatrix(b),this._light&&this._cullVisitor.addPositionedAttribute(this._light),this._cullVisitor.pushModelviewMatrix(a.getViewMatrix()),this._cullVisitor.pushViewport(a.getViewport()),this._cullVisitor.setCullSettings(a),this._renderStage.setClearDepth(a.getClearDepth()),this._renderStage.setClearColor(a.getClearColor()),this._renderStage.setClearMask(a.getClearMask()),this._renderStage.setViewport(a.getViewport()),this.getScene().accept(this._cullVisitor),this._cullVisitor.popModelviewMatrix(),this._cullVisitor.popProjectionMatrix(),this._cullVisitor.popViewport(),this._cullVisitor.popStateSet(),this._renderStage.sort()},draw:function(){var a=this.getState();this._renderStage.draw(a),a.popAllStateSets(),a.applyWithoutProgram()},frame:function(){var a,b;a=osg.performance.now(),void 0===this._lastFrameTime&&(this._lastFrameTime=0),this._frameRate=a-this._lastFrameTime,this._lastFrameTime=a,b=a;var c=this.getFrameStamp();0===c.getFrameNumber()&&(c.setReferenceTime(a/1e3),this._numberFrame=0),c.setSimulationTime(a/1e3-c.getReferenceTime()),this._updateVisitor.setFrameStamp(c),this.updateEventProxy(this._eventProxy,c),this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),osg.Matrix.copy(this.getManipulator().getInverseMatrix(),this.getCamera().getViewMatrix())),void 0===this._stats?(this.update(),this.cull(),this.draw(),c.setFrameNumber(c.getFrameNumber()+1),this._numberFrame++,this._frameTime=osg.performance.now()-b):(this._updateTime=osg.performance.now(),this.update(),this._updateTime=osg.performance.now()-this._updateTime,this._cullTime=osg.performance.now(),this.cull(),this._cullTime=osg.performance.now()-this._cullTime,this._drawTime=osg.performance.now(),this.draw(),this._drawTime=osg.performance.now()-this._drawTime,c.setFrameNumber(c.getFrameNumber()+1),this._numberFrame++,this._frameTime=osg.performance.now()-b,window.performance&&window.performance.memory&&window.performance.memory.usedJSHeapSize&&(this._memSize=window.performance.memory.usedJSHeapSize),this._stats.update())},setDone:function(a){this._done=a},done:function(){return this._done},run:function(){var a=this,b=function(){a.done()||(a._requestID=window.requestAnimationFrame(b,a.canvas),a.frame())};b()},setupManipulator:function(a){void 0===a&&(a=new osgGA.OrbitManipulator),void 0!==a.setNode?a.setNode(this.getSceneData()):a.view=this,this.setManipulator(a);var b=this,c=function(){var a=window.innerWidth,c=window.innerHeight,d=b.getCamera(),e=d.getViewport(),f=e.width(),g=e.height();b._canvas.width=a,b._canvas.height=c,b._canvas.style.width=a,b._canvas.style.height=c,osg.debug("window resize "+f+"x"+g+" to "+a+"x"+c);var h=a/f,i=c/g,j=h/i;e.setViewport(e.x()*h,e.y()*i,e.width()*h,e.height()*i),1!==j&&osg.Matrix.preMult(d.getProjectionMatrix(),osg.Matrix.makeScale(1/j,1,1,[]))};window.onresize=c},initEventProxy:function(a){for(var b=a||{},c={},d=osgViewer.EventProxy,e=b.EventBackend,f=Object.keys(d),g=0,h=f.length;h>g;g++){var i=f[g],j=!0,k={};if(e&&void 0!==e[i]&&(j=e[i].enable||!0,k=e[i]),j){var l=new d[i](this);l.init(k),c[i]=l}}return c},updateEventProxy:function(a,b){var c=Object.keys(a);c.forEach(function(c){var d=a[c];d.update&&d.update(b)})}}),!function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),Leap=a("../lib/index")},{"../lib/index":2}],3:[function(a,b){var c=b.exports=function(a){this.pos=0,this._buf=[],this.size=a};c.prototype.get=function(a){return void 0==a&&(a=0),a>=this.size?void 0:a>=this._buf.length?void 0:this._buf[(this.pos-a-1)%this.size]},c.prototype.push=function(a){return this._buf[this.pos%this.size]=a,this.pos++}},{}],4:[function(){},{}],5:[function(a,b){var c=b.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){if(a.source===window&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var b=c.shift();b()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],6:[function(a,b,c){!function(a){function b(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(b===a[c])return c;return-1}a.EventEmitter||(a.EventEmitter=function(){});var d=c.EventEmitter=a.EventEmitter,e="function"==typeof Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},f=10;d.prototype.setMaxListeners=function(a){this._events||(this._events={}),this._events.maxListeners=a},d.prototype.emit=function(a){if("error"===a&&(!this._events||!this._events.error||e(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var b=this._events[a];if(!b)return!1;if("function"==typeof b){switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var c=Array.prototype.slice.call(arguments,1);b.apply(this,c)}return!0}if(e(b)){for(var c=Array.prototype.slice.call(arguments,1),d=b.slice(),f=0,g=d.length;g>f;f++)d[f].apply(this,c);return!0}return!1},d.prototype.addListener=function(a,b){if("function"!=typeof b)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",a,b),this._events[a])if(e(this._events[a])){if(!this._events[a].warned){var c;c=void 0!==this._events.maxListeners?this._events.maxListeners:f,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0)}this._events[a].push(b)}else this._events[a]=[this._events[a],b];else this._events[a]=b;return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){var c=this;return c.on(a,function d(){c.removeListener(a,d),b.apply(this,arguments)}),this},d.prototype.removeListener=function(a,c){if("function"!=typeof c)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[a])return this;var d=this._events[a];if(e(d)){var f=b(d,c);if(0>f)return this;d.splice(f,1),0==d.length&&delete this._events[a]}else this._events[a]===c&&delete this._events[a];return this},d.prototype.removeAllListeners=function(a){return 0===arguments.length?(this._events={},this):(a&&this._events&&this._events[a]&&(this._events[a]=null),this)},d.prototype.listeners=function(a){return this._events||(this._events={}),this._events[a]||(this._events[a]=[]),e(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]}}(a("__browserify_process"))},{__browserify_process:5}],2:[function(a,b){!function(){b.exports={Controller:a("./controller"),Frame:a("./frame"),Gesture:a("./gesture"),Hand:a("./hand"),Pointable:a("./pointable"),InteractionBox:a("./interaction_box"),Connection:a("./connection"),CircularBuffer:a("./circular_buffer"),UI:a("./ui"),glMatrix:a("gl-matrix"),mat3:a("gl-matrix").mat3,vec3:a("gl-matrix").vec3,loopController:void 0,loop:function(a,b){void 0===b&&(b=a,a={}),this.loopController||(this.loopController=new this.Controller(a)),this.loopController.loop(b)}}}()},{"./circular_buffer":3,"./connection":7,"./controller":8,"./frame":9,"./gesture":10,"./hand":11,"./interaction_box":12,"./pointable":13,"./ui":14,"gl-matrix":15}],7:[function(a,b){var c=b.exports=a("./base_connection");c.prototype.setupSocket=function(){var a,b=this;try{a=new WebSocket(this.getUrl())}catch(c){return void 0}return a.onopen=function(){b.handleOpen()},a.onmessage=function(a){b.handleData(a.data)},a.onclose=function(){b.handleClose()},a},c.prototype.startHeartbeat=function(){if(this.protocol.sendHeartbeat&&!this.heartbeatTimer){var a=this,b=null;b="undefined"!=typeof document.hidden?"hidden":"undefined"!=typeof document.mozHidden?"mozHidden":"undefined"!=typeof document.msHidden?"msHidden":"undefined"!=typeof document.webkitHidden?"webkitHidden":void 0;var c=!0,d=window.addEventListener("focus",function(){c=!0}),e=window.addEventListener("blur",function(){c=!1});this.on("disconnect",function(){a.heartbeatTimer&&(clearTimeout(a.heartbeatTimer),delete a.heartbeatTimer),window.removeEventListener(d),window.removeEventListener(e)}),this.heartbeatTimer=setInterval(function(){var d=void 0===b?!0:document[b]===!1;d&&c?a.sendHeartbeat():a.setHeartbeatState(!1)},this.opts.heartbeatInterval)}}},{"./base_connection":16}],14:[function(a,b,c){c.UI={Region:a("./ui/region"),Cursor:a("./ui/cursor")}},{"./ui/cursor":17,"./ui/region":18}],15:[function(a,b,c){!function(){!function(){"use strict";var a={};"undefined"==typeof c?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(a.exports={},define(function(){return a.exports})):a.exports=window:a.exports=c,!function(a){var b={};if(!c)var c=1e-6;b.create=function(){return new Float32Array(2)},b.clone=function(a){var b=new Float32Array(2);return b[0]=a[0],b[1]=a[1],b},b.fromValues=function(a,b){var c=new Float32Array(2);return c[0]=a,c[1]=b,c},b.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},b.set=function(a,b,c){return a[0]=b,a[1]=c,a},b.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},b.sub=b.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},b.mul=b.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},b.div=b.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},b.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},b.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},b.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},b.dist=b.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},b.sqrDist=b.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},b.len=b.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},b.sqrLen=b.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},b.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},b.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},b.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},b.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},b.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},b.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=d*c[0]+e*c[1],a[1]=d*c[2]+e*c[3],a},b.forEach=function(){var a=new Float32Array(2);return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),b.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},"undefined"!=typeof a&&(a.vec2=b);var d={};if(!c)var c=1e-6;d.create=function(){return new Float32Array(3)},d.clone=function(a){var b=new Float32Array(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},d.fromValues=function(a,b,c){var d=new Float32Array(3);return d[0]=a,d[1]=b,d[2]=c,d},d.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},d.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},d.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},d.sub=d.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},d.mul=d.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},d.div=d.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},d.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},d.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},d.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},d.dist=d.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},d.sqrDist=d.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},d.len=d.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},d.sqrLen=d.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},d.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},d.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},d.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},d.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},d.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},d.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12],a[1]=c[1]*d+c[5]*e+c[9]*f+c[13],a[2]=c[2]*d+c[6]*e+c[10]*f+c[14],a},d.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},d.forEach=function(){var a=new Float32Array(3);return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),d.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},"undefined"!=typeof a&&(a.vec3=d);var e={};if(!c)var c=1e-6;e.create=function(){return new Float32Array(4)},e.clone=function(a){var b=new Float32Array(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.fromValues=function(a,b,c,d){var e=new Float32Array(4);return e[0]=a,e[1]=b,e[2]=c,e[3]=d,e},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.sub=e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.mul=e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},e.div=e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.dist=e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},e.sqrDist=e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},e.len=e.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},e.sqrLen=e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=b[0]*g,a[1]=b[1]*g,a[2]=b[2]*g,a[3]=b[3]*g),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},e.forEach=function(){var a=new Float32Array(4);return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.vec4=e);var f={},g=new Float32Array([1,0,0,1]);if(!c)var c=1e-6;f.create=function(){return new Float32Array(g)},f.clone=function(a){var b=new Float32Array(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},f.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},f.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},f.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},f.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},f.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},f.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},f.mul=f.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+e*j,a[1]=d*i+e*k,a[2]=f*h+g*j,a[3]=f*i+g*k,a},f.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=d*-h+e*i,a[2]=f*i+g*h,a[3]=f*-h+g*i,a},f.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*i,a[2]=f*h,a[3]=g*i,a},f.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.mat2=f);var h={},i=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!c)var c=1e-6;h.create=function(){return new Float32Array(i)},h.clone=function(a){var b=new Float32Array(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},h.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},h.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},h.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},h.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},h.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},h.mul=h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},h.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},"undefined"!=typeof a&&(a.mat3=h);var j={},k=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!c)var c=1e-6;j.create=function(){return new Float32Array(k)},j.clone=function(a){var b=new Float32Array(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},j.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},j.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},j.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},j.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},j.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},j.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},j.mul=j.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},j.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},j.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},j.rotate=function(a,b,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<c?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(d),g=Math.cos(d),h=1-g,i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=b[8],r=b[9],s=b[10],t=b[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},j.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},j.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},j.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},j.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},j.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*g*f*j,a[15]=0,a},j.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},j.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},j.lookAt=function(a,b,d,e){var f,g,h,i,k,l,m,n,o,p,q=b[0],r=b[1],s=b[2],t=e[0],u=e[1],v=e[2],w=d[0],x=d[1],y=d[2];return Math.abs(q-w)<c&&Math.abs(r-x)<c&&Math.abs(s-y)<c?j.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,f=u*o-v*n,g=v*m-t*o,h=t*n-u*m,p=Math.sqrt(f*f+g*g+h*h),p?(p=1/p,f*=p,g*=p,h*=p):(f=0,g=0,h=0),i=n*h-o*g,k=o*f-m*h,l=m*g-n*f,p=Math.sqrt(i*i+k*k+l*l),p?(p=1/p,i*=p,k*=p,l*=p):(i=0,k=0,l=0),a[0]=f,a[1]=i,a[2]=m,a[3]=0,a[4]=g,a[5]=k,a[6]=n,a[7]=0,a[8]=h,a[9]=l,a[10]=o,a[11]=0,a[12]=-(f*q+g*r+h*s),a[13]=-(i*q+k*r+l*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},j.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},"undefined"!=typeof a&&(a.mat4=j);var l={},m=new Float32Array([0,0,0,1]);if(!c)var c=1e-6;l.create=function(){return new Float32Array(m)},l.clone=e.clone,l.fromValues=e.fromValues,l.copy=e.copy,l.set=e.set,l.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},l.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},l.add=e.add,l.mul=l.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},l.scale=e.scale,l.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},l.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},l.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},l.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},l.dot=e.dot,l.lerp=e.lerp,l.slerp=function(a,b,c,d){var e,f,g,h,i=b[0],j=b[1],k=b[2],l=b[3],m=c[0],n=c[1],o=c[2],p=b[3],q=i*m+j*n+k*o+l*p;return Math.abs(q)>=1?(a!==b&&(a[0]=i,a[1]=j,a[2]=k,a[3]=l),a):(e=Math.acos(q),f=Math.sqrt(1-q*q),Math.abs(f)<.001?(a[0]=.5*i+.5*m,a[1]=.5*j+.5*n,a[2]=.5*k+.5*o,a[3]=.5*l+.5*p,a):(g=Math.sin((1-d)*e)/f,h=Math.sin(d*e)/f,a[0]=i*g+m*h,a[1]=j*g+n*h,a[2]=k*g+o*h,a[3]=l*g+p*h,a))},l.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},l.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},l.len=l.length=e.length,l.sqrLen=l.squaredLength=e.squaredLength,l.normalize=e.normalize,l.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.quat=l)}(a.exports)}()}()},{}],19:[function(a,b){var c=b.exports=function(){this.steps=[]};c.prototype.addStep=function(a){this.steps.push(a)},c.prototype.run=function(a){for(var b=this.steps.length,c=0;c!=b&&a;c++)a=this.steps[c](a);return a}},{}],17:[function(a,b){b.exports=function(){return function(a){var b=a.pointables.sort(function(a,b){return a.z-b.z})[0];return b&&b.valid&&(a.cursorPosition=b.tipPosition),a}}},{}],8:[function(a,b){!function(c){var d=a("./frame"),e=a("./circular_buffer"),f=a("./pipeline"),g=a("events").EventEmitter,h=a("./gesture").gestureListener,i=a("underscore"),j=b.exports=function(b){var f="undefined"!=typeof c&&"node"===c.title;b=i.defaults(b||{},{inNode:f}),this.inNode=b.inNode,b=i.defaults(b||{},{frameEventName:this.useAnimationLoop()?"animationFrame":"deviceFrame",supressAnimationLoop:!1}),this.supressAnimationLoop=b.supressAnimationLoop,this.frameEventName=b.frameEventName,this.history=new e(200),this.lastFrame=d.Invalid,this.lastValidFrame=d.Invalid,this.lastConnectionFrame=d.Invalid,this.accumulatedGestures=[],this.connectionType=void 0===b.connectionType?this.inBrowser()?a("./connection"):a("./node_connection"):b.connectionType,this.connection=new this.connectionType(b),this.setupConnectionEvents()};j.prototype.gesture=function(a,b){var c=h(this,a);return void 0!==b&&c.stop(b),c},j.prototype.inBrowser=function(){return!this.inNode},j.prototype.useAnimationLoop=function(){return this.inBrowser()&&"undefined"==typeof chrome},j.prototype.connect=function(){var a=this;if(this.connection.connect()&&this.inBrowser()&&!a.supressAnimationLoop){var b=function(){a.emit("animationFrame",a.lastConnectionFrame),window.requestAnimFrame(b)};window.requestAnimFrame(b)}},j.prototype.disconnect=function(){this.connection.disconnect()},j.prototype.frame=function(a){return this.history.get(a)||d.Invalid},j.prototype.loop=function(a){switch(a.length){case 1:this.on(this.frameEventName,a);break;case 2:var b=this,c=function(d){a(d,function(){b.lastFrame!=d?c(b.lastFrame):b.once(b.frameEventName,c)})};this.once(this.frameEventName,c)}this.connect()},j.prototype.addStep=function(a){this.pipeline||(this.pipeline=new f(this)),this.pipeline.addStep(a)},j.prototype.processFrame=function(a){a.gestures&&(this.accumulatedGestures=this.accumulatedGestures.concat(a.gestures)),this.pipeline&&(a=this.pipeline.run(a),a||(a=d.Invalid)),this.lastConnectionFrame=a,this.emit("deviceFrame",a)
},j.prototype.processFinishedFrame=function(a){if(this.lastFrame=a,a.valid&&(this.lastValidFrame=a),a.controller=this,a.historyIdx=this.history.push(a),a.gestures){a.gestures=this.accumulatedGestures,this.accumulatedGestures=[];for(var b=0;b!=a.gestures.length;b++)this.emit("gesture",a.gestures[b],a)}this.emit("frame",a)},j.prototype.setupConnectionEvents=function(){var a=this;this.connection.on("frame",function(b){a.processFrame(b)}),this.on(this.frameEventName,function(b){a.processFinishedFrame(b)}),this.connection.on("disconnect",function(){a.emit("disconnect")}),this.connection.on("ready",function(){a.emit("ready")}),this.connection.on("connect",function(){a.emit("connect")}),this.connection.on("focus",function(){a.emit("focus")}),this.connection.on("blur",function(){a.emit("blur")}),this.connection.on("protocol",function(b){a.emit("protocol",b)}),this.connection.on("deviceConnect",function(b){a.emit(b.state?"deviceConnected":"deviceDisconnected")})},i.extend(j.prototype,g.prototype)}(a("__browserify_process"))},{"./circular_buffer":3,"./connection":7,"./frame":9,"./gesture":10,"./node_connection":4,"./pipeline":19,__browserify_process:5,events:6,underscore:20}],10:[function(a,b,c){var d=a("gl-matrix"),e=(d.vec3,a("events").EventEmitter),f=a("underscore");c.createGesture=function(a){var b;switch(a.type){case"circle":b=new h(a);break;case"swipe":b=new i(a);break;case"screenTap":b=new j(a);break;case"keyTap":b=new k(a);break;default:throw"unkown gesture type"}return b.id=a.id,b.handIds=a.handIds,b.pointableIds=a.pointableIds,b.duration=a.duration,b.state=a.state,b.type=a.type,b},c.gestureListener=function(a,b){var c={},d={};a.on("gesture",function(a,e){if(a.type==b){if(("start"==a.state||"stop"==a.state)&&void 0===d[a.id]){var h=new g(a,e);d[a.id]=h,f.each(c,function(a,b){h.on(b,a)})}d[a.id].update(a,e),"stop"==a.state&&delete d[a.id]}});var e={start:function(a){return c.start=a,e},stop:function(a){return c.stop=a,e},complete:function(a){return c.stop=a,e},update:function(a){return c.update=a,e}};return e};var g=c.Gesture=function(a,b){this.gestures=[a],this.frames=[b]};g.prototype.update=function(a,b){this.gestures.push(a),this.frames.push(b),this.emit(a.state,this)},f.extend(g.prototype,e.prototype);var h=function(a){this.center=a.center,this.normal=a.normal,this.progress=a.progress,this.radius=a.radius};h.prototype.toString=function(){return"CircleGesture ["+JSON.stringify(this)+"]"};var i=function(a){this.startPosition=a.startPosition,this.position=a.position,this.direction=a.direction,this.speed=a.speed};i.prototype.toString=function(){return"SwipeGesture ["+JSON.stringify(this)+"]"};var j=function(a){this.position=a.position,this.direction=a.direction,this.progress=a.progress};j.prototype.toString=function(){return"ScreenTapGesture ["+JSON.stringify(this)+"]"};var k=function(a){this.position=a.position,this.direction=a.direction,this.progress=a.progress};k.prototype.toString=function(){return"KeyTapGesture ["+JSON.stringify(this)+"]"}},{events:6,"gl-matrix":15,underscore:20}],11:[function(a,b){var c=a("./pointable"),d=a("gl-matrix"),e=d.mat3,f=d.vec3,g=a("underscore"),h=b.exports=function(a){this.id=a.id,this.palmPosition=a.palmPosition,this.direction=a.direction,this.palmVelocity=a.palmVelocity,this.palmNormal=a.palmNormal,this.sphereCenter=a.sphereCenter,this.sphereRadius=a.sphereRadius,this.valid=!0,this.pointables=[],this.fingers=[],this.tools=[],this._translation=a.t,this._rotation=g.flatten(a.r),this._scaleFactor=a.s,this.timeVisible=a.timeVisible,this.stabilizedPalmPosition=a.stabilizedPalmPosition};h.prototype.finger=function(a){var b=this.frame.finger(a);return b&&b.handId==this.id?b:c.Invalid},h.prototype.rotationAngle=function(a,b){if(!this.valid||!a.valid)return 0;var c=a.hand(this.id);if(!c.valid)return 0;var d=this.rotationMatrix(a),e=.5*(d[0]+d[4]+d[8]-1),g=Math.acos(e);if(g=isNaN(g)?0:g,void 0!==b){var h=this.rotationAxis(a);g*=f.dot(h,f.normalize(f.create(),b))}return g},h.prototype.rotationAxis=function(a){if(!this.valid||!a.valid)return f.create();var b=a.hand(this.id);return b.valid?f.normalize(f.create(),[this._rotation[7]-b._rotation[5],this._rotation[2]-b._rotation[6],this._rotation[3]-b._rotation[1]]):f.create()},h.prototype.rotationMatrix=function(a){if(!this.valid||!a.valid)return e.create();var b=a.hand(this.id);if(!b.valid)return e.create();var c=e.transpose(e.create(),this._rotation),d=e.multiply(e.create(),b._rotation,c);return d},h.prototype.scaleFactor=function(a){if(!this.valid||!a.valid)return 1;var b=a.hand(this.id);return b.valid?Math.exp(this._scaleFactor-b._scaleFactor):1},h.prototype.translation=function(a){if(!this.valid||!a.valid)return f.create();var b=a.hand(this.id);return b.valid?[this._translation[0]-b._translation[0],this._translation[1]-b._translation[1],this._translation[2]-b._translation[2]]:f.create()},h.prototype.toString=function(){return"Hand [ id: "+this.id+" | palm velocity:"+this.palmVelocity+" | sphere center:"+this.sphereCenter+" ] "},h.Invalid={valid:!1,fingers:[],tools:[],pointables:[],pointable:function(){return c.Invalid},finger:function(){return c.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return e.create()},rotationAxis:function(){return f.create()},scaleFactor:function(){return 1},translation:function(){return f.create()}}},{"./pointable":13,"gl-matrix":15,underscore:20}],9:[function(a,b){var c=a("./hand"),d=a("./pointable"),e=a("./gesture").createGesture,f=a("gl-matrix"),g=f.mat3,h=f.vec3,i=a("./interaction_box"),j=a("underscore"),k=b.exports=function(a){this.valid=!0,this.id=a.id,this.timestamp=a.timestamp,this.hands=[],this.handsMap={},this.pointables=[],this.tools=[],this.fingers=[],a.interactionBox&&(this.interactionBox=new i(a.interactionBox)),this.gestures=[],this.pointablesMap={},this._translation=a.t,this._rotation=j.flatten(a.r),this._scaleFactor=a.s,this.data=a,this.type="frame",this.currentFrameRate=a.currentFrameRate;for(var b={},f=0,g=a.hands.length;f!=g;f++){var h=new c(a.hands[f]);h.frame=this,this.hands.push(h),this.handsMap[h.id]=h,b[h.id]=f}for(var k=0,l=a.pointables.length;k!=l;k++){var m=new d(a.pointables[k]);if(m.frame=this,this.pointables.push(m),this.pointablesMap[m.id]=m,(m.tool?this.tools:this.fingers).push(m),void 0!==m.handId&&b.hasOwnProperty(m.handId)){var h=this.hands[b[m.handId]];h.pointables.push(m),(m.tool?h.tools:h.fingers).push(m)}}if(a.gestures)for(var n=0,o=a.gestures.length;n!=o;n++)this.gestures.push(e(a.gestures[n]))};k.prototype.tool=function(a){var b=this.pointable(a);return b.tool?b:d.Invalid},k.prototype.pointable=function(a){return this.pointablesMap[a]||d.Invalid},k.prototype.finger=function(a){var b=this.pointable(a);return b.tool?d.Invalid:b},k.prototype.hand=function(a){return this.handsMap[a]||c.Invalid},k.prototype.rotationAngle=function(a,b){if(!this.valid||!a.valid)return 0;var c=this.rotationMatrix(a),d=.5*(c[0]+c[4]+c[8]-1),e=Math.acos(d);if(e=isNaN(e)?0:e,void 0!==b){var f=this.rotationAxis(a);e*=h.dot(f,h.normalize(h.create(),b))}return e},k.prototype.rotationAxis=function(a){return this.valid&&a.valid?h.normalize(h.create(),[this._rotation[7]-a._rotation[5],this._rotation[2]-a._rotation[6],this._rotation[3]-a._rotation[1]]):h.create()},k.prototype.rotationMatrix=function(a){if(!this.valid||!a.valid)return g.create();var b=g.transpose(g.create(),this._rotation);return g.multiply(g.create(),a._rotation,b)},k.prototype.scaleFactor=function(a){return this.valid&&a.valid?Math.exp(this._scaleFactor-a._scaleFactor):1},k.prototype.translation=function(a){return this.valid&&a.valid?h.subtract(h.create(),this._translation,a._translation):h.create()},k.prototype.toString=function(){var a="Frame [ id:"+this.id+" | timestamp:"+this.timestamp+" | Hand count:("+this.hands.length+") | Pointable count:("+this.pointables.length+")";return this.gestures&&(a+=" | Gesture count:("+this.gestures.length+")"),a+=" ]"},k.prototype.dump=function(){var a="";a+="Frame Info:<br/>",a+=this.toString(),a+="<br/><br/>Hands:<br/>";for(var b=0,c=this.hands.length;b!=c;b++)a+="  "+this.hands[b].toString()+"<br/>";a+="<br/><br/>Pointables:<br/>";for(var d=0,e=this.pointables.length;d!=e;d++)a+="  "+this.pointables[d].toString()+"<br/>";if(this.gestures){a+="<br/><br/>Gestures:<br/>";for(var f=0,g=this.gestures.length;f!=g;f++)a+="  "+this.gestures[f].toString()+"<br/>"}return a+="<br/><br/>Raw JSON:<br/>",a+=JSON.stringify(this.data)},k.Invalid={valid:!1,hands:[],fingers:[],tools:[],gestures:[],pointables:[],pointable:function(){return d.Invalid},finger:function(){return d.Invalid},hand:function(){return c.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return g.create()},rotationAxis:function(){return h.create()},scaleFactor:function(){return 1},translation:function(){return h.create()}}},{"./gesture":10,"./hand":11,"./interaction_box":12,"./pointable":13,"gl-matrix":15,underscore:20}],12:[function(a,b){var c=a("gl-matrix"),d=c.vec3,e=b.exports=function(a){this.valid=!0,this.center=a.center,this.size=a.size,this.width=a.size[0],this.height=a.size[1],this.depth=a.size[2]};e.prototype.denormalizePoint=function(a){return d.fromValues((a[0]-.5)*this.size[0]+this.center[0],(a[1]-.5)*this.size[1]+this.center[1],(a[2]-.5)*this.size[2]+this.center[2])},e.prototype.normalizePoint=function(a,b){var c=d.fromValues((a[0]-this.center[0])/this.size[0]+.5,(a[1]-this.center[1])/this.size[1]+.5,(a[2]-this.center[2])/this.size[2]+.5);return b&&(c[0]=Math.min(Math.max(c[0],0),1),c[1]=Math.min(Math.max(c[1],0),1),c[2]=Math.min(Math.max(c[2],0),1)),c},e.prototype.toString=function(){return"InteractionBox [ width:"+this.width+" | height:"+this.height+" | depth:"+this.depth+" ]"},e.Invalid={valid:!1}},{"gl-matrix":15}],13:[function(a,b){var c=a("gl-matrix");c.vec3;var d=b.exports=function(a){this.valid=!0,this.id=a.id,this.handId=a.handId,this.length=a.length,this.tool=a.tool,this.width=a.width,this.direction=a.direction,this.stabilizedTipPosition=a.stabilizedTipPosition,this.tipPosition=a.tipPosition,this.tipVelocity=a.tipVelocity,this.touchZone=a.touchZone,this.touchDistance=a.touchDistance,this.timeVisible=a.timeVisible};d.prototype.toString=function(){return 1==this.tool?"Pointable [ id:"+this.id+" "+this.length+"mmx | with:"+this.width+"mm | direction:"+this.direction+" ]":"Pointable [ id:"+this.id+" "+this.length+"mmx | direction: "+this.direction+" ]"},d.Invalid={valid:!1}},{"gl-matrix":15}],20:[function(a,b,c){!function(){!function(){var a=this,d=a._,e={},f=Array.prototype,g=Object.prototype,h=Function.prototype,i=f.push,j=f.slice,k=f.concat,l=g.toString,m=g.hasOwnProperty,n=f.forEach,o=f.map,p=f.reduce,q=f.reduceRight,r=f.filter,s=f.every,t=f.some,u=f.indexOf,v=f.lastIndexOf,w=Array.isArray,x=Object.keys,y=h.bind,z=function(a){return a instanceof z?a:this instanceof z?(this._wrapped=a,void 0):new z(a)};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=z),c._=z):a._=z,z.VERSION="1.4.4";var A=z.each=z.forEach=function(a,b,c){if(null!=a)if(n&&a.forEach===n)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,f=a.length;f>d;d++)if(b.call(c,a[d],d,a)===e)return}else for(var g in a)if(z.has(a,g)&&b.call(c,a[g],g,a)===e)return};z.map=z.collect=function(a,b,c){var d=[];return null==a?d:o&&a.map===o?a.map(b,c):(A(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)};var B="Reduce of empty array with no initial value";z.reduce=z.foldl=z.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),p&&a.reduce===p)return d&&(b=z.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(A(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(B);return c},z.reduceRight=z.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),q&&a.reduceRight===q)return d&&(b=z.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=z.keys(a);f=g.length}if(A(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(B);return c},z.find=z.detect=function(a,b,c){var d;return C(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},z.filter=z.select=function(a,b,c){var d=[];return null==a?d:r&&a.filter===r?a.filter(b,c):(A(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},z.reject=function(a,b,c){return z.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},z.every=z.all=function(a,b,c){b||(b=z.identity);var d=!0;return null==a?d:s&&a.every===s?a.every(b,c):(A(a,function(a,f,g){return(d=d&&b.call(c,a,f,g))?void 0:e}),!!d)};var C=z.some=z.any=function(a,b,c){b||(b=z.identity);var d=!1;return null==a?d:t&&a.some===t?a.some(b,c):(A(a,function(a,f,g){return d||(d=b.call(c,a,f,g))?e:void 0}),!!d)};z.contains=z.include=function(a,b){return null==a?!1:u&&a.indexOf===u?-1!=a.indexOf(b):C(a,function(a){return a===b})},z.invoke=function(a,b){var c=j.call(arguments,2),d=z.isFunction(b);return z.map(a,function(a){return(d?b:a[b]).apply(a,c)})},z.pluck=function(a,b){return z.map(a,function(a){return a[b]})},z.where=function(a,b,c){return z.isEmpty(b)?c?null:[]:z[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},z.findWhere=function(a,b){return z.where(a,b,!0)},z.max=function(a,b,c){if(!b&&z.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&z.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return A(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},z.min=function(a,b,c){if(!b&&z.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&z.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return A(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},z.shuffle=function(a){var b,c=0,d=[];return A(a,function(a){b=z.random(c++),d[c-1]=d[b],d[b]=a}),d};var D=function(a){return z.isFunction(a)?a:function(b){return b[a]}};z.sortBy=function(a,b,c){var d=D(b);return z.pluck(z.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var E=function(a,b,c,d){var e={},f=D(b||z.identity);return A(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};z.groupBy=function(a,b,c){return E(a,b,c,function(a,b,c){(z.has(a,b)?a[b]:a[b]=[]).push(c)})},z.countBy=function(a,b,c){return E(a,b,c,function(a,b){z.has(a,b)||(a[b]=0),a[b]++})},z.sortedIndex=function(a,b,c,d){c=null==c?z.identity:D(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},z.toArray=function(a){return a?z.isArray(a)?j.call(a):a.length===+a.length?z.map(a,z.identity):z.values(a):[]},z.size=function(a){return null==a?0:a.length===+a.length?a.length:z.keys(a).length},z.first=z.head=z.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:j.call(a,0,b)},z.initial=function(a,b,c){return j.call(a,0,a.length-(null==b||c?1:b))},z.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:j.call(a,Math.max(a.length-b,0))},z.rest=z.tail=z.drop=function(a,b,c){return j.call(a,null==b||c?1:b)},z.compact=function(a){return z.filter(a,z.identity)};var F=function(a,b,c){return A(a,function(a){z.isArray(a)?b?i.apply(c,a):F(a,b,c):c.push(a)}),c};z.flatten=function(a,b){return F(a,b,[])},z.without=function(a){return z.difference(a,j.call(arguments,1))},z.uniq=z.unique=function(a,b,c,d){z.isFunction(b)&&(d=c,c=b,b=!1);var e=c?z.map(a,c,d):a,f=[],g=[];return A(e,function(c,d){(b?d&&g[g.length-1]===c:z.contains(g,c))||(g.push(c),f.push(a[d]))}),f},z.union=function(){return z.uniq(k.apply(f,arguments))},z.intersection=function(a){var b=j.call(arguments,1);return z.filter(z.uniq(a),function(a){return z.every(b,function(b){return z.indexOf(b,a)>=0})})},z.difference=function(a){var b=k.apply(f,j.call(arguments,1));return z.filter(a,function(a){return!z.contains(b,a)})},z.zip=function(){for(var a=j.call(arguments),b=z.max(z.pluck(a,"length")),c=new Array(b),d=0;b>d;d++)c[d]=z.pluck(a,""+d);return c},z.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},z.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=z.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(u&&a.indexOf===u)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},z.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(v&&a.lastIndexOf===v)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},z.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f},z.bind=function(a,b){if(a.bind===y&&y)return y.apply(a,j.call(arguments,1));var c=j.call(arguments,2);return function(){return a.apply(b,c.concat(j.call(arguments)))}},z.partial=function(a){var b=j.call(arguments,1);return function(){return a.apply(this,b.concat(j.call(arguments)))}},z.bindAll=function(a){var b=j.call(arguments,1);return 0===b.length&&(b=z.functions(a)),A(b,function(b){a[b]=z.bind(a[b],a)}),a},z.memoize=function(a,b){var c={};return b||(b=z.identity),function(){var d=b.apply(this,arguments);return z.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},z.delay=function(a,b){var c=j.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},z.defer=function(a){return z.delay.apply(z,[a,1].concat(j.call(arguments,1)))},z.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},z.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},z.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},z.wrap=function(a,b){return function(){var c=[a];return i.apply(c,arguments),b.apply(this,c)}},z.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},z.after=function(a,b){return 0>=a?b():function(){return--a<1?b.apply(this,arguments):void 0}},z.keys=x||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)z.has(a,c)&&(b[b.length]=c);return b},z.values=function(a){var b=[];for(var c in a)z.has(a,c)&&b.push(a[c]);return b},z.pairs=function(a){var b=[];for(var c in a)z.has(a,c)&&b.push([c,a[c]]);return b},z.invert=function(a){var b={};for(var c in a)z.has(a,c)&&(b[a[c]]=c);return b},z.functions=z.methods=function(a){var b=[];for(var c in a)z.isFunction(a[c])&&b.push(c);return b.sort()},z.extend=function(a){return A(j.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},z.pick=function(a){var b={},c=k.apply(f,j.call(arguments,1));return A(c,function(c){c in a&&(b[c]=a[c])}),b},z.omit=function(a){var b={},c=k.apply(f,j.call(arguments,1));for(var d in a)z.contains(c,d)||(b[d]=a[d]);return b},z.defaults=function(a){return A(j.call(arguments,1),function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])}),a},z.clone=function(a){return z.isObject(a)?z.isArray(a)?a.slice():z.extend({},a):a},z.tap=function(a,b){return b(a),a};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof z&&(a=a._wrapped),b instanceof z&&(b=b._wrapped);var e=l.call(a);if(e!=l.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if("[object Array]"==e){if(g=a.length,h=g==b.length)for(;g--&&(h=G(a[g],b[g],c,d)););}else{var i=a.constructor,j=b.constructor;if(i!==j&&!(z.isFunction(i)&&i instanceof i&&z.isFunction(j)&&j instanceof j))return!1;for(var k in a)if(z.has(a,k)&&(g++,!(h=z.has(b,k)&&G(a[k],b[k],c,d))))break;if(h){for(k in b)if(z.has(b,k)&&!g--)break;h=!g}}return c.pop(),d.pop(),h};z.isEqual=function(a,b){return G(a,b,[],[])},z.isEmpty=function(a){if(null==a)return!0;if(z.isArray(a)||z.isString(a))return 0===a.length;for(var b in a)if(z.has(a,b))return!1;return!0},z.isElement=function(a){return!(!a||1!==a.nodeType)},z.isArray=w||function(a){return"[object Array]"==l.call(a)},z.isObject=function(a){return a===Object(a)},A(["Arguments","Function","String","Number","Date","RegExp"],function(a){z["is"+a]=function(b){return l.call(b)=="[object "+a+"]"}}),z.isArguments(arguments)||(z.isArguments=function(a){return!(!a||!z.has(a,"callee"))}),"function"!=typeof/./&&(z.isFunction=function(a){return"function"==typeof a}),z.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},z.isNaN=function(a){return z.isNumber(a)&&a!=+a},z.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==l.call(a)},z.isNull=function(a){return null===a},z.isUndefined=function(a){return void 0===a},z.has=function(a,b){return m.call(a,b)},z.noConflict=function(){return a._=d,this},z.identity=function(a){return a},z.times=function(a,b,c){for(var d=Array(a),e=0;a>e;e++)d[e]=b.call(c,e);return d},z.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var H={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};H.unescape=z.invert(H.escape);var I={escape:new RegExp("["+z.keys(H.escape).join("")+"]","g"),unescape:new RegExp("("+z.keys(H.unescape).join("|")+")","g")};z.each(["escape","unescape"],function(a){z[a]=function(b){return null==b?"":(""+b).replace(I[a],function(b){return H[a][b]})}}),z.result=function(a,b){if(null==a)return null;var c=a[b];return z.isFunction(c)?c.call(a):c},z.mixin=function(a){A(z.functions(a),function(b){var c=z[b]=a[b];z.prototype[b]=function(){var a=[this._wrapped];return i.apply(a,arguments),N.call(this,c.apply(z,a))}})};var J=0;z.uniqueId=function(a){var b=++J+"";return a?a+b:b},z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\t|\u2028|\u2029/g;z.template=function(a,b,c){var d;c=z.defaults({},c,z.templateSettings);var e=new RegExp([(c.escape||K).source,(c.interpolate||K).source,(c.evaluate||K).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(M,function(a){return"\\"+L[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,z);var i=function(a){return d.call(this,a,z)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},z.chain=function(a){return z(a).chain()};var N=function(a){return this._chain?z(a).chain():a};z.mixin(z),A(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=f[a];z.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],N.call(this,c)}}),A(["concat","join","slice"],function(a){var b=f[a];z.prototype[a]=function(){return N.call(this,b.apply(this._wrapped,arguments))}}),z.extend(z.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this)}()},{}],16:[function(a,b){var c=a("./protocol").chooseProtocol,d=a("events").EventEmitter,e=a("underscore"),f=b.exports=function(a){this.opts=e.defaults(a||{},{host:"127.0.0.1",enableGestures:!1,tryReconnectOnDisconnect:!0,port:6437,enableHeartbeat:!0,heartbeatInterval:100,requestProtocolVersion:3}),this.host=a.host,this.port=a.port,this.on("ready",function(){this.enableGestures(this.opts.enableGestures),this.opts.enableHeartbeat&&this.startHeartbeat()}),this.on("disconnect",function(){this.opts.enableHeartbeat&&this.stopHeartbeat()}),this.heartbeatTimer=null};f.prototype.getUrl=function(){return"ws://"+this.host+":"+this.port+"/v"+this.opts.requestProtocolVersion+".json"},f.prototype.sendHeartbeat=function(){this.protocol&&(this.setHeartbeatState(!0),this.protocol.sendHeartbeat(this))},f.prototype.handleOpen=function(){this.emit("connect")},f.prototype.enableGestures=function(a){this.gesturesEnabled=a?!0:!1,this.send(this.protocol.encode({enableGestures:this.gesturesEnabled}))},f.prototype.handleClose=function(){this.disconnect(),this.opts.tryReconnectOnDisconnect&&this.startReconnection()},f.prototype.startReconnection=function(){var a=this;setTimeout(function(){a.connect()},1e3)},f.prototype.disconnect=function(){this.socket&&(this.socket.close(),delete this.socket,delete this.protocol,this.emit("disconnect"))},f.prototype.handleData=function(a){var b,d=JSON.parse(a);void 0===this.protocol?(b=this.protocol=c(d),this.emit("ready")):b=this.protocol(d),this.emit(b.type,b)},f.prototype.connect=function(){return this.socket?void 0:(this.socket=this.setupSocket(),!0)},f.prototype.send=function(a){this.socket.send(a)},f.prototype.stopHeartbeat=function(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),delete this.heartbeatTimer,this.setHeartbeatState(!1))},f.prototype.setHeartbeatState=function(a){this.heartbeatState!==a&&(this.heartbeatState=a,this.emit(this.heartbeatState?"focus":"blur"))},e.extend(f.prototype,d.prototype)},{"./protocol":21,events:6,underscore:20}],21:[function(a,b,c){var d=a("./frame"),e=function(a){this.type=a.type,this.state=a.state};c.chooseProtocol=function(a){var b;switch(a.version){case 1:b=f(1,function(a){return new d(a)});break;case 2:b=f(2,function(a){return new d(a)}),b.sendHeartbeat=function(a){a.send(b.encode({heartbeat:!0}))};break;case 3:b=f(3,function(a){return a.event?new e(a.event):new d(a)}),b.sendHeartbeat=function(a){a.send(b.encode({heartbeat:!0}))};break;default:throw"unrecognized version"}return b};var f=function(a,b){var c=b;return c.encode=function(a){return JSON.stringify(a)},c.version=a,c.versionLong="Version "+a,c.type="protocol",c}},{"./frame":9}],18:[function(a,b){var c=a("events").EventEmitter,d=a("underscore"),e=b.exports=function(a,b){this.start=new Vector(a),this.end=new Vector(b),this.enteredFrame=null};e.prototype.hasPointables=function(a){for(var b=0;b!=a.pointables.length;b++){var c=a.pointables[b].tipPosition;if(c.x>=this.start.x&&c.x<=this.end.x&&c.y>=this.start.y&&c.y<=this.end.y&&c.z>=this.start.z&&c.z<=this.end.z)return!0}return!1},e.prototype.listener=function(a){var b=this;return a&&a.nearThreshold&&this.setupNearRegion(a.nearThreshold),function(a){return b.updatePosition(a)}},e.prototype.clipper=function(){var a=this;return function(b){return a.updatePosition(b),a.enteredFrame?b:null}},e.prototype.setupNearRegion=function(a){var b=this.nearRegion=new e([this.start.x-a,this.start.y-a,this.start.z-a],[this.end.x+a,this.end.y+a,this.end.z+a]),c=this;b.on("enter",function(a){c.emit("near",a)}),b.on("exit",function(a){c.emit("far",a)}),c.on("exit",function(a){c.emit("near",a)})},e.prototype.updatePosition=function(a){return this.nearRegion&&this.nearRegion.updatePosition(a),this.hasPointables(a)&&null==this.enteredFrame?(this.enteredFrame=a,this.emit("enter",this.enteredFrame)):this.hasPointables(a)||null==this.enteredFrame||(this.enteredFrame=null,this.emit("exit",this.enteredFrame)),a},e.prototype.normalize=function(a){return new Vector([(a.x-this.start.x)/(this.end.x-this.start.x),(a.y-this.start.y)/(this.end.y-this.start.y),(a.z-this.start.z)/(this.end.z-this.start.z)])},e.prototype.mapToXY=function(a,b,c){var d=this.normalize(a),e=d.x,f=d.y;return e>1?e=1:-1>e&&(e=-1),f>1?f=1:-1>f&&(f=-1),[(e+1)/2*b,(1-f)/2*c,d.z]},d.extend(e.prototype,c.prototype)},{events:6,underscore:20}]},{},[1]),function(a,b){"use strict";function c(){if(!d.READY){d.event.determineEventTypes();for(var a in d.gestures)d.gestures.hasOwnProperty(a)&&d.detection.register(d.gestures[a]);d.event.onTouch(d.DOCUMENT,d.EVENT_MOVE,d.detection.detect),d.event.onTouch(d.DOCUMENT,d.EVENT_END,d.detection.detect),d.READY=!0}}var d=function(a,b){return new d.Instance(a,b||{})};d.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},d.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,d.HAS_TOUCHEVENTS="ontouchstart"in a,d.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,d.NO_MOUSEEVENTS=d.HAS_TOUCHEVENTS&&navigator.userAgent.match(d.MOBILE_REGEX),d.EVENT_TYPES={},d.DIRECTION_DOWN="down",d.DIRECTION_LEFT="left",d.DIRECTION_UP="up",d.DIRECTION_RIGHT="right",d.POINTER_MOUSE="mouse",d.POINTER_TOUCH="touch",d.POINTER_PEN="pen",d.EVENT_START="start",d.EVENT_MOVE="move",d.EVENT_END="end",d.DOCUMENT=document,d.plugins={},d.READY=!1,d.Instance=function(a,b){var e=this;return c(),this.element=a,this.enabled=!0,this.options=d.utils.extend(d.utils.extend({},d.defaults),b||{}),this.options.stop_browser_behavior&&d.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),d.event.onTouch(a,d.EVENT_START,function(a){e.enabled&&d.detection.startDetect(e,a)}),this},d.Instance.prototype={on:function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)this.element.addEventListener(c[d],b,!1);return this},off:function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)this.element.removeEventListener(c[d],b,!1);return this},trigger:function(a,b){var c=d.DOCUMENT.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b;var e=this.element;return d.utils.hasParent(b.target,e)&&(e=b.target),e.dispatchEvent(c),this},enable:function(a){return this.enabled=a,this}};var e=null,f=!1,g=!1;d.event={bindDom:function(a,b,c){for(var d=b.split(" "),e=0;e<d.length;e++)a.addEventListener(d[e],c,!1)},onTouch:function(a,b,c){var h=this;this.bindDom(a,d.EVENT_TYPES[b],function(i){var j=i.type.toLowerCase();if(!j.match(/mouse/)||!g){(j.match(/touch/)||j.match(/pointerdown/)||j.match(/mouse/)&&1===i.which)&&(f=!0),j.match(/touch|pointer/)&&(g=!0);var k=0;f&&(d.HAS_POINTEREVENTS&&b!=d.EVENT_END?k=d.PointerEvent.updatePointer(b,i):j.match(/touch/)?k=i.touches.length:g||(k=j.match(/up/)?0:1),k>0&&b==d.EVENT_END?b=d.EVENT_MOVE:k||(b=d.EVENT_END),k||null===e?e=i:i=e,c.call(d.detection,h.collectEventData(a,b,i)),d.HAS_POINTEREVENTS&&b==d.EVENT_END&&(k=d.PointerEvent.updatePointer(b,i))),k||(e=null,f=!1,g=!1,d.PointerEvent.reset())}})},determineEventTypes:function(){var a;a=d.HAS_POINTEREVENTS?d.PointerEvent.getEvents():d.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],d.EVENT_TYPES[d.EVENT_START]=a[0],d.EVENT_TYPES[d.EVENT_MOVE]=a[1],d.EVENT_TYPES[d.EVENT_END]=a[2]},getTouchList:function(a){return d.HAS_POINTEREVENTS?d.PointerEvent.getTouchList():a.touches?a.touches:[{identifier:1,pageX:a.pageX,pageY:a.pageY,target:a.target}]},collectEventData:function(a,b,c){var e=this.getTouchList(c,b),f=d.POINTER_TOUCH;return(c.type.match(/mouse/)||d.PointerEvent.matchType(d.POINTER_MOUSE,c))&&(f=d.POINTER_MOUSE),{center:d.utils.getCenter(e),timeStamp:(new Date).getTime(),target:c.target,touches:e,eventType:b,pointerType:f,srcEvent:c,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()
},stopDetect:function(){return d.detection.stopDetect()}}}},d.PointerEvent={pointers:{},getTouchList:function(){var a=this,b=[];return Object.keys(a.pointers).sort().forEach(function(c){b.push(a.pointers[c])}),b},updatePointer:function(a,b){return a==d.EVENT_END?this.pointers={}:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b),Object.keys(this.pointers).length},matchType:function(a,b){if(!b.pointerType)return!1;var c={};return c[d.POINTER_MOUSE]=b.pointerType==b.MSPOINTER_TYPE_MOUSE||b.pointerType==d.POINTER_MOUSE,c[d.POINTER_TOUCH]=b.pointerType==b.MSPOINTER_TYPE_TOUCH||b.pointerType==d.POINTER_TOUCH,c[d.POINTER_PEN]=b.pointerType==b.MSPOINTER_TYPE_PEN||b.pointerType==d.POINTER_PEN,c[a]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},d.utils={extend:function(a,c,d){for(var e in c)a[e]!==b&&d||(a[e]=c[e]);return a},hasParent:function(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1},getCenter:function(a){for(var b=[],c=[],d=0,e=a.length;e>d;d++)b.push(a[d].pageX),c.push(a[d].pageY);return{pageX:(Math.min.apply(Math,b)+Math.max.apply(Math,b))/2,pageY:(Math.min.apply(Math,c)+Math.max.apply(Math,c))/2}},getVelocity:function(a,b,c){return{x:Math.abs(b/a)||0,y:Math.abs(c/a)||0}},getAngle:function(a,b){var c=b.pageY-a.pageY,d=b.pageX-a.pageX;return 180*Math.atan2(c,d)/Math.PI},getDirection:function(a,b){var c=Math.abs(a.pageX-b.pageX),e=Math.abs(a.pageY-b.pageY);return c>=e?a.pageX-b.pageX>0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT:a.pageY-b.pageY>0?d.DIRECTION_UP:d.DIRECTION_DOWN},getDistance:function(a,b){var c=b.pageX-a.pageX,d=b.pageY-a.pageY;return Math.sqrt(c*c+d*d)},getScale:function(a,b){return a.length>=2&&b.length>=2?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return a.length>=2&&b.length>=2?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==d.DIRECTION_UP||a==d.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(a,b){var c,d=["webkit","khtml","moz","ms","o",""];if(b&&a.style){for(var e=0;e<d.length;e++)for(var f in b)b.hasOwnProperty(f)&&(c=f,d[e]&&(c=d[e]+c.substring(0,1).toUpperCase()+c.substring(1)),a.style[c]=b[f]);"none"==b.userSelect&&(a.onselectstart=function(){return!1})}}},d.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:d.utils.extend({},b),lastEvent:!1,name:""},this.detect(b))},detect:function(a){if(this.current&&!this.stopped){a=this.extendEventData(a);for(var b=this.current.inst.options,c=0,e=this.gestures.length;e>c;c++){var f=this.gestures[c];if(!this.stopped&&b[f.name]!==!1&&f.handler.call(f,a,this.current.inst)===!1){this.stopDetect();break}}return this.current&&(this.current.lastEvent=a),a.eventType==d.EVENT_END&&!a.touches.length-1&&this.stopDetect(),a}},stopDetect:function(){this.previous=d.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(a){var b=this.current.startEvent;if(b&&(a.touches.length!=b.touches.length||a.touches===b.touches)){b.touches=[];for(var c=0,e=a.touches.length;e>c;c++)b.touches.push(d.utils.extend({},a.touches[c]))}var f=a.timeStamp-b.timeStamp,g=a.center.pageX-b.center.pageX,h=a.center.pageY-b.center.pageY,i=d.utils.getVelocity(f,g,h);return d.utils.extend(a,{deltaTime:f,deltaX:g,deltaY:h,velocityX:i.x,velocityY:i.y,distance:d.utils.getDistance(b.center,a.center),angle:d.utils.getAngle(b.center,a.center),direction:d.utils.getDirection(b.center,a.center),scale:d.utils.getScale(b.touches,a.touches),rotation:d.utils.getRotation(b.touches,a.touches),startEvent:b}),a},register:function(a){var c=a.defaults||{};return c[a.name]===b&&(c[a.name]=!0),d.utils.extend(d.defaults,c,!0),a.index=a.index||1e3,this.gestures.push(a),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}},d.gestures=d.gestures||{},d.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(a,b){switch(a.eventType){case d.EVENT_START:clearTimeout(this.timer),d.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==d.detection.current.name&&b.trigger("hold",a)},b.options.hold_timeout);break;case d.EVENT_MOVE:a.distance>b.options.hold_threshold&&clearTimeout(this.timer);break;case d.EVENT_END:clearTimeout(this.timer)}}},d.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(a,b){if(a.eventType==d.EVENT_END){var c=d.detection.previous,e=!1;if(a.deltaTime>b.options.tap_max_touchtime||a.distance>b.options.tap_max_distance)return;c&&"tap"==c.name&&a.timeStamp-c.lastEvent.timeStamp<b.options.doubletap_interval&&a.distance<b.options.doubletap_distance&&(b.trigger("doubletap",a),e=!0),(!e||b.options.tap_always)&&(d.detection.current.name="tap",b.trigger(d.detection.current.name,a))}}},d.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(a,b){if(a.eventType==d.EVENT_END){if(b.options.swipe_max_touches>0&&a.touches.length>b.options.swipe_max_touches)return;(a.velocityX>b.options.swipe_velocity||a.velocityY>b.options.swipe_velocity)&&(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}}},d.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),this.triggered=!1,void 0;if(!(b.options.drag_max_touches>0&&a.touches.length>b.options.drag_max_touches))switch(a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:if(a.distance<b.options.drag_min_distance&&d.detection.current.name!=this.name)return;d.detection.current.name=this.name,(d.detection.current.lastEvent.drag_locked_to_axis||b.options.drag_lock_to_axis&&b.options.drag_lock_min_distance<=a.distance)&&(a.drag_locked_to_axis=!0);var c=d.detection.current.lastEvent.direction;a.drag_locked_to_axis&&c!==a.direction&&(a.direction=d.utils.isVertical(c)?a.deltaY<0?d.DIRECTION_UP:d.DIRECTION_DOWN:a.deltaX<0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT),this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),b.trigger(this.name+a.direction,a),(b.options.drag_block_vertical&&d.utils.isVertical(a.direction)||b.options.drag_block_horizontal&&!d.utils.isVertical(a.direction))&&a.preventDefault();break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},d.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),this.triggered=!1,void 0;if(!(a.touches.length<2))switch(b.options.transform_always_block&&a.preventDefault(),a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:var c=Math.abs(1-a.scale),e=Math.abs(a.rotation);if(c<b.options.transform_min_scale&&e<b.options.transform_min_rotation)return;d.detection.current.name=this.name,this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),e>b.options.transform_min_rotation&&b.trigger("rotate",a),c>b.options.transform_min_scale&&(b.trigger("pinch",a),b.trigger("pinch"+(a.scale<1?"in":"out"),a));break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},d.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(a,b){return b.options.prevent_mouseevents&&a.pointerType==d.POINTER_MOUSE?(a.stopDetect(),void 0):(b.options.prevent_default&&a.preventDefault(),a.eventType==d.EVENT_START&&b.trigger(this.name,a),void 0)}},d.gestures.Release={name:"release",index:1/0,handler:function(a,b){a.eventType==d.EVENT_END&&b.trigger(this.name,a)}},"object"==typeof module&&"object"==typeof module.exports?module.exports=d:(a.Hammer=d,"function"==typeof a.define&&a.define.amd&&a.define("hammer",[],function(){return d}))}(this),osgViewer.EventProxy=osgViewer.EventProxy||{},osgViewer.EventProxy.LeapMotion=function(a){this._viewer=a,this._type="LeapMotion",this._enable=!0},osgViewer.EventProxy.LeapMotion.prototype={init:function(a){document.getElementById(a.id);var b=this;this._controller=new Leap.Controller({enableGestures:a.gestures||!0,tryReconnectOnDisconnect:!1}),this._controller.on("ready",function(){a.readyCallback&&a.readyCallback(b._controller),b._leapMotionReady=!0,osg.info("leapmotion ready")}),this._controller.loop(this._update.bind(this))},isValid:function(){if(!this._enable)return!1;var a=this._viewer.getManipulator();if(!a)return!1;var b=a.getControllerList();return b[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},_update:function(a){if(a.valid&&this.isValid()){var b=this.getManipulatorController();b.update&&b.update(a)}}},osgViewer.EventProxy=osgViewer.EventProxy||{},osgViewer.EventProxy.GamePad=function(){var a=function(a){this._viewer=a,this._type="GamePad",this._enable=!0};return a.prototype={init:function(){var a=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads;!a},isValid:function(){if(!this._enable)return!1;var a=this._viewer.getManipulator();if(!a)return!1;var b=a.getControllerList();return b[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},webkitGamepadPoll:function(){var a=navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||navigator.webkitGamepads;a&&(a[0]?(this._gamepad||this.onGamepadConnect({gamepad:a[0]}),this._gamepad=a[0]):this._gamepad&&this.onGamepadDisconnect({gamepad:this._gamepad}))},onGamepadConnect:function(a){this._gamepad=a.gamepad,osg.log("Detected new gamepad!",this._gamepad)},onGamepadDisconnect:function(){this._gamepad=!1,osg.log("Gamepad disconnected",this._gamepad)},getGamePad:function(){return this._gamepad},update:function(){if(this.webkitGamepadPoll(),this._gamepad){var a=this.getManipulatorController();a.update&&a.update(this)}}},a}(),osgViewer.EventProxy=osgViewer.EventProxy||{},osgViewer.EventProxy.StandardMouseKeyboard=function(){var a=function(a){this._enable=!0,this._viewer=a,this._type="StandardMouseKeyboard",this._mouseEventNode=void 0,this._wheelEventNode=void 0,this._keyboardEventNode=void 0,this._eventList=["mousedown","mouseup","mousemove","dblclick"],this._mousePosition=[0,0]};return a.prototype={init:function(a){this.removeEventListeners(this._mouseEventNode,this._wheelEventNode,this._keyboardEventNode);var b=a.mouseEventNode,c=a.wheelEventNode||b,d=a.keyboardEventNode||b;this.addEventListeners(b,c,d),this._mouseEventNode=b,this._wheelEventNode=c,this._keyboardEventNode=d},addEventListeners:function(a,b,c){if(a)for(var d=0,e=this._eventList.length;e>d;d++){var f=this._eventList[d];this[f]&&a.addEventListener(f,this[f].bind(this),!1)}b&&(b.addEventListener("DOMMouseScroll",this.mousewheel.bind(this),!1),b.addEventListener("mousewheel",this.mousewheel.bind(this),!1)),c&&(c.addEventListener("keydown",this.keydown.bind(this),!1),c.addEventListener("keyup",this.keyup.bind(this),!1))},removeEventListeners:function(a,b,c){if(a)for(var d=0,e=this._eventList.length;e>d;d++){var f=this._eventList[d];this[f]&&a.removeEventListener(f,this[f])}b&&(b.removeEventListener("DOMMouseScroll",this.mousewheel),b.removeEventListener("mousewheel",this.mousewheel)),c&&(c.removeEventListener("keydown",this.keydown),c.removeEventListener("keyup",this.keyup))},isValid:function(){return this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},keyup:function(a){return this.isValid()?this.getManipulatorController().keyup?this.getManipulatorController().keyup(a):void 0:void 0},keydown:function(a){return this.isValid()?this.getManipulatorController().keydown?this.getManipulatorController().keydown(a):void 0:void 0},mousedown:function(a){return this.isValid()?this.getManipulatorController().mousedown?this.getManipulatorController().mousedown(a):void 0:void 0},mouseup:function(a){return this.isValid()?this.getManipulatorController().mouseup?this.getManipulatorController().mouseup(a):void 0:void 0},mousemove:function(a){return this.isValid()?this.getManipulatorController().mousemove?this.getManipulatorController().mousemove(a):void 0:void 0},dblclick:function(a){return this.isValid()?this.getManipulatorController().dblclick?this.getManipulatorController().dblclick(a):void 0:void 0},mousewheel:function(a){if(this.isValid()){var b=this.getManipulatorController();if(b.mousewheel){var c=a||window.event,d=[].slice.call(arguments,1),e=0,f=0,g=0;return a.type="mousewheel",a.wheelDelta&&(e=a.wheelDelta/120),a.detail&&(e=-a.detail/3),g=e,void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(g=0,f=-1*e),void 0!==c.wheelDeltaY&&(g=c.wheelDeltaY/120),void 0!==c.wheelDeltaX&&(f=-1*c.wheelDeltaX/120),d.unshift(a,e,f,g),this.getManipulatorController().mousewheel.apply(b,d)}}},divGlobalOffset:function(a){var b=0,c=0;b=a.offsetLeft,c=a.offsetTop;for(var d=document.getElementsByTagName("body")[0];a.offsetParent&&a!=d;)b+=a.offsetParent.offsetLeft,c+=a.offsetParent.offsetTop,a=a.offsetParent;return this._mousePosition[0]=b,this._mousePosition[1]=c,this._mousePosition},getPositionRelativeToCanvas:function(a,b){var c,d,e=a.target;a.pageX||a.pageY?(c=a.pageX,d=a.pageY):(a.clientX||a.clientY)&&(c=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);var f=this.divGlobalOffset(e);return c-=f[0],d=e.height-(d-f[1]),isNaN(c)||isNaN(d),void 0===b&&(b=this._mousePosition),b[0]=c,b[1]=d,b},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this)}},a}(),osgViewer.EventProxy=osgViewer.EventProxy||{},osgViewer.EventProxy.Hammer=function(a){this._enable=!0,this._viewer=a,this._type="Hammer",this._eventNode=void 0},osgViewer.EventProxy.Hammer.prototype={init:function(a){var b={prevent_default:!0,drag_max_touches:2,transform_min_scale:.08,transform_min_rotation:180,transform_always_block:!0,hold:!1,release:!1,swipe:!1,tap:!1};this._eventNode=a.eventNode,this._eventNode&&(this._hammer=new Hammer(this._eventNode,b))},isValid:function(){return this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this._hammer)}},osgGA={},Hammer.NO_MOUSEEVENTS=!0,osgGA.Manipulator=function(){this._controllerList={},this._inverseMatrix=new Array(16),osg.Matrix.makeIdentity(this._inverseMatrix)},osgGA.Manipulator.prototype={update:function(){},getInverseMatrix:function(){return this._inverseMatrix},getControllerList:function(){return this._controllerList}},osgGA.getOrbitHammerControllerClass=function(){var a=function(a){this._manipulator=a,this.init()};return a.prototype={init:function(){this._panFactorX=.5,this._panFactorY=-this._panFactorX,this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._pan=!1,this._delay=.15},setEventProxy:function(a){if(void 0!==a&&(void 0===a||a!==this._eventProxy)){this._eventProxy=a;var b=this,c=a,d=function(a){return void 0!==a.touches?a.touches.length:1},e=function(a){return"touches "+d(a)+" distance "+a.distance+" x "+a.deltaX+" y "+a.deltaY};c.on("dragstart",function(a){var c=b._manipulator;if(c&&!b._transformStarted){var f=a.gesture;2===d(f)&&(b._pan=!0),b._dragStarted=!0,b._pan?(c.getPanInterpolator().reset(),c.getPanInterpolator().set(f.center.pageX*b._panFactorX,f.center.pageY*b._panFactorY)):(c.getRotateInterpolator().reset(),c.getRotateInterpolator().set(f.center.pageX*b._rotateFactorX,f.center.pageY*b._rotateFactorY)),osg.debug("drag start, "+e(f))}}),c.on("drag",function(a){var c=b._manipulator;if(c&&b._dragStarted){if(b._transformStarted)return b._dragStarted=!1,void 0;var f=a.gesture;if(b._pan){if(2!==d(f))return;c.getPanInterpolator().setTarget(f.center.pageX*b._panFactorX,f.center.pageY*b._panFactorY),osg.debug("pad, "+e(f))}else c.getRotateInterpolator().setDelay(b._delay),c.getRotateInterpolator().setTarget(f.center.pageX*b._rotateFactorX,f.center.pageY*b._rotateFactorY),osg.debug("rotate, "+e(f))}}),c.on("dragend",function(a){var c=b._manipulator;if(c&&b._dragStarted){b._dragStarted=!1;var d=a.gesture;b._pan=!1,osg.debug("drag end, "+e(d))}});var f;c.on("transformstart",function(a){var d=b._manipulator;if(d){b._transformStarted=!0;var e=a.gesture;f=e.scale;var g=e.scale;d.getZoomInterpolator().reset(),d.getZoomInterpolator().set(e.scale),osg.debug("transform start "+e.scale+" "+g),a.preventDefault(),c.options.drag=!1}}),c.on("transformend",function(a){b._transformStarted=!1,osg.debug("transform end "+a.gesture.scale),c.options.drag=!0}),c.on("transform",function(a){var c=b._manipulator;if(c&&b._transformStarted){var d=a.gesture,e=(d.scale-f)*b._zoomFactor;f=d.scale;var g=c.getZoomInterpolator().getTarget()[0];c.getZoomInterpolator().setTarget(g-e),osg.debug("transform "+d.scale+" "+(g-e))}})}},setManipulator:function(a){this._manipulator=a}},a},osgGA.getOrbitGamePadControllerClass=function(){var a=function(a){this._manipulator=a,this.init()};return a.prototype={init:function(){this._delay=.15,this._threshold=.08,this._mode=0,this._padFactor=10,this._zoomFactor=.5,this._rotateFactor=5},addPan:function(a,b,c){a.setDelay(this._delay),a.addTarget(b*this._padFactor,c*this._padFactor)},addZoom:function(a,b){a.setDelay(this._delay),a.addTarget(b*this._zoomFactor)},addRotate:function(a,b,c){a.setDelay(this._delay),rotateTarget=a.getTarget(),a.addTarget(b*this._rotateFactor,c*this._rotateFactor)},gamepadaxes:function(a){var b=.005,c=this._manipulator.getRotateInterpolator(),d=this._manipulator.getZoomInterpolator(),e=this._manipulator.getPanInterpolator();4==a.length?((Math.abs(a[0])>b||Math.abs(a[1])>b)&&this.addRotate(c,-a[0],a[1]),Math.abs(a[3])>b&&this.addZoom(d,-a[3])):a.length>=5&&((Math.abs(a[0])>b||Math.abs(a[1])>b)&&this.addPan(e,-a[0],a[1]),Math.abs(a[2])>b&&this.addZoom(d,-a[2]),(Math.abs(a[3])>b||Math.abs(a[4])>b)&&this.addRotate(c,a[4],a[3]))},gamepadbuttondown:function(a){if(a.button>=12&&a.button<=15){var b=this._manipulator.getPanInterpolator(),c=b.getTarget(),d={12:[0,-1],13:[0,1],14:[-1,0],15:[1,0]}[a.button];b.setDelay(this._delay),b.setTarget(c[0]-10*d[0],c[1]+10*d[1])}},update:function(a){if(a){var b=a.getGamePad(),c=b.axes,d=b.buttons;this.gamepadaxes(c);for(var e=function(){},f=0;f<d.length;f++)d[f]&&this.gamepadbuttondown({preventDefault:e,gamepad:b,button:f},!!d[f])}}},a},osgGA.getOrbitStandardMouseKeyboardControllerClass=function(){var a={Rotate:0,Pan:1,Zoom:2},b=function(a){this._manipulator=a,this.init()};return b.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=void 0,this._delay=.15},getMode:function(){return this._mode},setMode:function(a){this._mode=a},setEventProxy:function(a){this._eventProxy=a},setManipulator:function(a){this._manipulator=a},mousemove:function(b){if(this._buttonup!==!0){var c=this._eventProxy.getPositionRelativeToCanvas(b),d=this._manipulator;if(isNaN(c[0])===!1&&isNaN(c[1])===!1){var e=this.getMode();if(e===a.Rotate)d.getRotateInterpolator().setDelay(this._delay),d.getRotateInterpolator().setTarget(c[0],c[1]);else if(e===a.Pan)d.getPanInterpolator().setTarget(c[0],c[1]);else if(e===a.Zoom){var f=d.getZoomInterpolator();f.isReset()&&(f._start=c[1],f.set(0));var g=c[1]-f._start;f._start=c[1];var h=f.getTarget()[0];f.setTarget(h-g/20)}}b.preventDefault()}},mousedown:function(b){var c=this._manipulator,d=this.getMode();void 0===d&&(0===b.button?b.shiftKey?this.setMode(a.Pan):b.ctrlKey?this.setMode(a.Zoom):this.setMode(a.Rotate):this.setMode(a.Pan)),this.pushButton();var e=this._eventProxy.getPositionRelativeToCanvas(b);d=this.getMode(),d===osgGA.OrbitManipulator.Rotate?(c.getRotateInterpolator().reset(),c.getRotateInterpolator().set(e[0],e[1])):d===osgGA.OrbitManipulator.Pan?(c.getPanInterpolator().reset(),c.getPanInterpolator().set(e[0],e[1])):d===osgGA.OrbitManipulator.Zoom&&(c.getZoomInterpolator()._start=e[1],c.getZoomInterpolator().set(0)),b.preventDefault()},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(a,b){var c=this._manipulator;a.preventDefault();var d=c.getZoomInterpolator().getTarget()[0]-b;c.getZoomInterpolator().setTarget(d)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(b){32===b.keyCode?this._manipulator.computeHomePosition():b.keyCode===this._panKey&&this.getMode()!==a.Pan?(this.setMode(a.Pan),this._manipulator.getPanInterpolator().reset(),this.pushButton(),b.preventDefault()):b.keyCode===this._zoomKey&&this.getMode()!==a.Zoom?(this.setMode(a.Zoom),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),b.preventDefault()):b.keyCode===this._rotateKey&&this.getMode()!==a.Rotate&&(this.setMode(a.Rotate),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),b.preventDefault())},keyup:function(a){a.keyCode===this._panKey?this.mouseup(a):a.keyCode===this._rotateKey?this.mouseup(a):a.keyCode===this._rotateKey&&this.mouseup(a),this.setMode(void 0)}},b},osgGA.getOrbitLeapMotionControllerClass=function(){var a=function(a){this._manipulator=a,this.init()},b={rotate:{dtx:-1.44,dty:-1.08,delay:.05,method:"getRotateInterpolator"},pan:{dtx:-1.44,dty:-1.08,delay:.05,method:"getPanInterpolator"},zoom:{dtx:0,dty:-.5,delay:.05,method:"getZoomInterpolator"},"zoom-twohands":{dtx:-.05,dty:0,delay:.05,method:"getZoomInterpolator"}};return a.prototype={init:function(){this._virtualCursor=[0,0],this._targetPosition=[0,0],this._previousFrame=void 0,this._displacement=[0,0],this._top=[0,1,0],this._motion=[0,0],this._delay=.05,this._threshold=.08,this._direction_dot_threshold=.5,this._mode="rotate"},update:function(a){if(this._previousFrame||(this._previousFrame=a),0!==a.fingers.length){var c=this._previousFrame.translation(a);if(this._previousFrame=a,0!==a.hands.length&&!(Math.abs(c[0])<this._threshold&&Math.abs(c[1])<this._threshold)){var d=this._mode,e=0;if(a.gestures.length>0)for(var f=0;f<a.gestures.length;f++){var g=a.gestures[f];if("circle"===g.type)return this._manipulator.computeHomePosition(),void 0}if(1===a.hands.length)a.hands[0].fingers.length>=3?(d="zoom",e=a.hands[0].palmPosition[1]/10,e=Math.max(e-4,.01)):d=a.hands[0].fingers.length>1?"pan":"rotate";else if(2===a.hands.length){var h=Math.abs(osg.Vec3.dot(a.hands[0].palmNormal,this._top)),i=Math.abs(osg.Vec3.dot(a.hands[1].palmNormal,this._top));h<this._direction_dot_threshold&&i<this._direction_dot_threshold?d="zoom-twohands":(d=void 0,this.hands_distance_old=void 0)}var j=this._manipulator.getZoomInterpolator();if(void 0!==d){if(d!==this._mode)return osg.info("Switch to mode "+d),this._motion[0]=0,this._motion[1]=0,this._mode=d,("zoom"===d||"zoom-twohands"===d)&&j.isReset()&&(j._start=1,j.set(0)),void 0;var k,l;k=b[d].dtx,l=b[d].dty,this._motion[0]+=c[0]*k,this._motion[1]+=c[1]*l;var m=b[d].delay,n=b[d].method;if(this._manipulator[n]().setDelay(m),"zoom"===d)osg.log(e),j.setTarget(e);else if("zoom-twohands"===d){var o=osg.Vec3.distance(a.hands[0].palmPosition,a.hands[1].palmPosition);if(void 0!==this.hands_distance_old){var p=k*(o-this.hands_distance_old);e=j._target,e[0]+=p}this.hands_distance_old=o}else this._manipulator[n]().addTarget(this._motion[0],this._motion[1]);this._motion[1]=this._motion[0]=0}}}}},a},osgGA.OrbitManipulator=function(){osgGA.Manipulator.call(this),this._tmpInverse=osg.Matrix.makeIdentity([]),this._tmpHomePosition=osg.Vec3.init([]),this.init()},osgGA.OrbitManipulator.Interpolator=function(a,b){this._current=new Array(a),this._target=new Array(a),this._delta=new Array(a),this._delay=void 0!==b?b:.15,this._reset=!1,this.reset()},osgGA.OrbitManipulator.Interpolator.prototype={setDelay:function(a){this._delay=a},reset:function(){for(var a=0,b=this._current.length;b>a;a++)this._current[a]=this._target[a]=0;this._reset=!0},update:function(){for(var a=0,b=this._current.length;b>a;a++){var c=(this._target[a]-this._current[a])*this._delay;this._delta[a]=c,this._current[a]+=c}return this._delta},set:function(){for(var a=0,b=this._current.length;b>a;a++)this._current[a]=this._target[a]=arguments[a];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var a=0,b=this._target.length;b>a;a++)this._target[a]=this._reset?this._current[a]=arguments[a]:arguments[a];this._reset=!1},addTarget:function(){for(var a=0;a<arguments.length;a++)this._target[a]+=arguments[a]},getTarget:function(){return this._target},getDelta:function(){return this._delta}},osgGA.OrbitManipulator.Rotate=0,osgGA.OrbitManipulator.Pan=1,osgGA.OrbitManipulator.Zoom=2,osgGA.OrbitManipulator.AvailableControllerList=["StandardMouseKeyboard","LeapMotion","GamePad","Hammer"],osgGA.OrbitManipulator.ControllerList=["StandardMouseKeyboard","LeapMotion","GamePad","Hammer"],osgGA.OrbitManipulator.prototype=osg.objectInehrit(osgGA.Manipulator.prototype,{init:function(){this._distance=25,this._target=new Array(3),osg.Vec3.init(this._target),this._rotation=osg.Matrix.mult(osg.Matrix.makeRotate(Math.PI,0,0,1,[]),osg.Matrix.makeRotate(-Math.PI/10,1,0,0,[]),[]),this._time=0,this._rotate=new osgGA.OrbitManipulator.Interpolator(2),this._pan=new osgGA.OrbitManipulator.Interpolator(2),this._zoom=new osgGA.OrbitManipulator.Interpolator(1),this._zoom.reset=function(){osgGA.OrbitManipulator.Interpolator.prototype.reset.call(this),this._start=0},this._buttonup=!0,this._scale=10,this._maxDistance=0,this._minDistance=0,this._scaleMouseMotion=1,this._inverseMatrix=new Array(16),this._rotateKey=65,this._zoomKey=83,this._panKey=68;var a=this;osgGA.OrbitManipulator.ControllerList.forEach(function(b){void 0!==osgGA.OrbitManipulator[b]&&(a._controllerList[b]=new osgGA.OrbitManipulator[b](a))})},reset:function(){this.init()},setNode:function(a){this._node=a},setTarget:function(a){osg.Vec3.copy(a,this._target);var b=new Array(3);this.getEyePosition(b),this._distance=osg.Vec3.distance(b,a)},setEyePosition:function(a){var b=this._rotation,c=this._target,d=[0,0,1],e=osg.Vec3.sub(a,c,[]);osg.Vec3.normalize(e,e);var f=osg.Vec3.cross(e,d,[]);osg.Vec3.normalize(f,f);var g=osg.Vec3.cross(f,e,[]);osg.Vec3.normalize(g,g),b[0]=f[0],b[1]=e[0],b[2]=g[0],b[3]=0,b[4]=f[1],b[5]=e[1],b[6]=g[1],b[7]=0,b[8]=f[2],b[9]=e[2],b[10]=g[2],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this._distance=osg.Vec3.distance(a,c)},computeHomePosition:function(){if(void 0!==this._node){var a=this._node.getBound();this.setDistance(1.5*a.radius()),this.setTarget(a.center())}},getHomePosition:function(){var a=this._tmpHomePosition;if(void 0!==this._node){var b=this._node.getBound(),c=1.5*b.radius(),d=b.center();this.computeEyePosition(d,c,a)}return a},setMaxDistance:function(a){this._maxDistance=a},setMinDistance:function(a){this._minDistance=a},setDistance:function(a){this._distance=a},getDistance:function(){return this._distance},computePan:function(a,b){b*=this._distance,a*=this._distance;var c=new Array(16),d=new Array(3),e=new Array(3);osg.Matrix.inverse(this._rotation,c),d[0]=osg.Matrix.get(c,0,0),d[1]=osg.Matrix.get(c,0,1),d[2]=osg.Matrix.get(c,0,2),osg.Vec3.normalize(d,d),e[0]=osg.Matrix.get(c,2,0),e[1]=osg.Matrix.get(c,2,1),e[2]=osg.Matrix.get(c,2,2),osg.Vec3.normalize(e,e),osg.Vec3.mult(d,-a,d),osg.Vec3.mult(e,b,e),osg.Vec3.add(this._target,d,this._target),osg.Vec3.add(this._target,e,this._target)},computeRotation:function(a,b){var c=osg.Matrix.makeRotate(a/10,0,0,1,[]),d=osg.Matrix.mult(this._rotation,c,[]);c=osg.Matrix.makeRotate(b/10,1,0,0,[]);var e=osg.Matrix.mult(c,d,[]),f=[];osg.Matrix.inverse(e,f);var g=osg.Matrix.transformVec3(f,[0,this._distance,0],new Array(3)),h=osg.Vec3.neg(g,[]);osg.Vec3.normalize(h,h);var i=osg.Vec3.dot(h,[0,0,1]);return Math.abs(i)>.95?(this._rotation=d,void 0):(this._rotation=e,void 0)},computeZoom:function(a){this.zoom(a)},zoom:function(a){var b=this._distance*a;this._minDistance>0&&b<this._minDistance&&(b=this._minDistance),this._maxDistance>0&&b>this._maxDistance&&(b=this._maxDistance),this._distance=b},getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getTarget:function(a){return osg.Vec3.copy(this._target,a),a},getEyePosition:function(a){this.computeEyePosition(this._target,this._distance,a)},computeEyePosition:function(a,b,c){var d=this._tmpInverse;osg.Matrix.inverse(this._rotation,this._tmpInverse),osg.Matrix.transformVec3(d,[0,b,0],c),osg.Vec3.add(a,c,c)},update:function(a){var b=a.getFrameStamp().getSimulationTime();void 0===this._lastUpdate&&(this._lastUpdate=b),b-this._lastUpdate,this._lastUpdate=b;var c,d=.1;c=this._rotate.update(),this.computeRotation(-c[0]*d*this._scaleMouseMotion,-c[1]*d*this._scaleMouseMotion);var e=.002;c=this._pan.update(),this.computePan(-c[0]*e,-c[1]*e),c=this._zoom.update(),this.computeZoom(1+c[0]/10);var f=this._target,g=this._distance,h=new Array(3);osg.Matrix.inverse(this._rotation,this._inverseMatrix),osg.Matrix.transformVec3(this._inverseMatrix,[0,g,0],h),osg.Matrix.makeLookAt(osg.Vec3.add(f,h,h),f,[0,0,1],this._inverseMatrix)},getInverseMatrix:function(){return this._inverseMatrix}}),function(a){a.LeapMotion=osgGA.getOrbitLeapMotionControllerClass()}(osgGA.OrbitManipulator),function(a){a.StandardMouseKeyboard=osgGA.getOrbitStandardMouseKeyboardControllerClass()}(osgGA.OrbitManipulator),function(a){a.Hammer=osgGA.getOrbitHammerControllerClass()}(osgGA.OrbitManipulator),function(a){a.GamePad=osgGA.getOrbitGamePadControllerClass()}(osgGA.OrbitManipulator),osgGA.getFirstPersonStandardMouseKeyboardControllerClass=function(){var a=function(a){this._manipulator=a,this.init()};return a.prototype={init:function(){this.releaseButton(),this._delay=.15,this._stepFactor=1},setEventProxy:function(a){this._eventProxy=a},setManipulator:function(a){this._manipulator=a,this._manipulator.setStepFactor(this._stepFactor)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},mousedown:function(a){var b=this._eventProxy.getPositionRelativeToCanvas(a),c=this._manipulator;c.getLookPositionInterpolator().set(b[0],b[1]),this.pushButton()},mouseup:function(){this.releaseButton()},mousemove:function(a){if(this._buttonup!==!0){var b=this._eventProxy.getPositionRelativeToCanvas(a);this._manipulator.getLookPositionInterpolator().setDelay(this._delay),this._manipulator.getLookPositionInterpolator().setTarget(b[0],b[1])}},mousewheel:function(a,b){a.preventDefault(),this._stepFactor=Math.min(Math.max(.001,this._stepFactor+.01*b),4),this._manipulator.setStepFactor(this._stepFactor)},keydown:function(a){var b=this._manipulator;if(32===a.keyCode)b.computeHomePosition();else{if(87===a.keyCode||90===a.keyCode||38===a.keyCode)return b.getFowardInterpolator().setDelay(this._delay),b.getFowardInterpolator().setTarget(1),!1;if(83===a.keyCode||40===a.keyCode)return b.getFowardInterpolator().setDelay(this._delay),b.getFowardInterpolator().setTarget(-1),!1;if(68===a.keyCode||39===a.keyCode)return b.getSideInterpolator().setDelay(this._delay),b.getSideInterpolator().setTarget(1),!1;if(65===a.keyCode||81===a.keyCode||37===a.keyCode)return b.getSideInterpolator().setDelay(this._delay),b.getSideInterpolator().setTarget(-1),!1}},keyup:function(a){var b=this._manipulator;return 87===a.keyCode||90===a.keyCode||38===a.keyCode||83==a.keyCode||40===a.keyCode?(b.getFowardInterpolator().setDelay(this._delay),b.getFowardInterpolator().setTarget(0),!1):68==a.keyCode||39===a.keyCode||65===a.keyCode||81===a.keyCode||37===a.keyCode?(b.getSideInterpolator().setDelay(this._delay),b.getSideInterpolator().setTarget(0),!1):void 0
}},a},osgGA.FirstPersonManipulator=function(){osgGA.Manipulator.call(this),this.init()},osgGA.FirstPersonManipulator.AvailableControllerList=["StandardMouseKeyboard"],osgGA.FirstPersonManipulator.ControllerList=["StandardMouseKeyboard"],osgGA.FirstPersonManipulator.prototype=osg.objectInehrit(osgGA.Manipulator.prototype,{setNode:function(a){this._node=a,this.computeHomePosition()},computeHomePosition:function(){if(void 0!==this._node){var a=this._node.getBound();this._radius=a.radius(),this._eye=[0,1.5*-a.radius(),0]}},init:function(){this._direction=[0,1,0],this._eye=[0,25,10],this._up=[0,0,1],this._radius=1,this._forward=new osgGA.OrbitManipulator.Interpolator(1),this._side=new osgGA.OrbitManipulator.Interpolator(1),this._lookPosition=new osgGA.OrbitManipulator.Interpolator(2),this._stepFactor=1,this._target=new Array(3),osg.Vec3.init(this._target),this._angleVertical=0,this._angleHorizontal=0,this._tmpComputeRotation1=osg.Matrix.makeIdentity([]),this._tmpComputeRotation2=osg.Matrix.makeIdentity([]),this._tmpComputeRotation3=osg.Matrix.makeIdentity([]),this._tmpGetTargetDir=osg.Vec3.init([]);var a=this;this._controllerList={},osgGA.FirstPersonManipulator.ControllerList.forEach(function(b){void 0!==osgGA.FirstPersonManipulator[b]&&(a._controllerList[b]=new osgGA.FirstPersonManipulator[b](a))})},getEyePosition:function(a){return a[0]=this._eye[0],a[1]=this._eye[1],a[2]=this._eye[2],a},setEyePosition:function(a){return this._eye[0]=a[0],this._eye[1]=a[1],this._eye[2]=a[2],this},getTarget:function(a,b){void 0===b&&(b=25);var c=osg.Vec3.mult(this._direction,b,this._tmpGetTargetDir);osg.Vec3.add(this._eye,c,a)},setTarget:function(a){this._target[0]=a[0],this._target[1]=a[1],this._target[2]=a[2];var b=this._tmpGetTargetDir;osg.Vec3.sub(a,this._eye,b),b[2]=0,osg.Vec3.normalize(b,b),this._angleHorizontal=Math.acos(b[1]),b[0]<0&&(this._angleHorizontal=-this._angleHorizontal),osg.Vec3.sub(a,this._eye,b),osg.Vec3.normalize(b,b),this._angleVertical=-Math.asin(b[2]),osg.Vec3.copy(b,this._direction)},getLookPositionInterpolator:function(){return this._lookPosition},getSideInterpolator:function(){return this._side},getFowardInterpolator:function(){return this._forward},computeRotation:function(a,b){this._angleVertical+=.01*b,this._angleHorizontal-=.01*a;var c=this._tmpComputeRotation1,d=this._tmpComputeRotation2,e=this._tmpComputeRotation3;osg.Matrix.makeRotate(this._angleVertical,1,0,0,c),osg.Matrix.makeRotate(this._angleHorizontal,0,0,1,d),osg.Matrix.mult(d,c,e),this._direction=osg.Matrix.transformVec3(e,[0,1,0],this._direction),osg.Vec3.normalize(this._direction,this._direction),this._up=osg.Matrix.transformVec3(e,[0,0,1],this._up)},reset:function(){this.init()},setStepFactor:function(a){this._stepFactor=a},update:function(a){var b=a.getFrameStamp().getSimulationTime();void 0===this._lastUpdate&&(this._lastUpdate=b);var c=b-this._lastUpdate;this._lastUpdate=b,this._forward.update(),this._side.update();var d=this._lookPosition.update();this.computeRotation(.5*-d[0],.5*-d[1]);var e=new Array(2);e[0]=this._forward.getCurrent()[0],e[1]=this._side.getCurrent()[0],osg.Vec2.length(e)>1&&osg.Vec2.normalize(e,e);var f=this._radius;this._radius<.001&&(f=1),this.moveForward(e[0]*f*this._stepFactor*c),this.strafe(e[1]*f*this._stepFactor*c);var g=osg.Vec3.add(this._eye,this._direction,[]);this._target=g,osg.Matrix.makeLookAt(this._eye,g,this._up,this._inverseMatrix)},getInverseMatrix:function(){return this._inverseMatrix},moveForward:function(a){var b=osg.Vec3.mult(osg.Vec3.normalize(this._direction,[]),a,[]);this._eye=osg.Vec3.add(this._eye,b,[])},strafe:function(a){var b=osg.Vec3.cross(this._direction,this._up,[]),c=osg.Vec3.mult(osg.Vec3.normalize(b,b),a,[]);this._eye=osg.Vec3.add(this._eye,c,[])}}),function(a){a.StandardMouseKeyboard=osgGA.getFirstPersonStandardMouseKeyboardControllerClass()}(osgGA.FirstPersonManipulator),osgGA.SwitchManipulator=function(){this._manipulatorList=[],this._currentManipulator=void 0},osgGA.SwitchManipulator.prototype={update:function(a){var b=this.getCurrentManipulator();return void 0!==b?b.update(a):void 0},setNode:function(a){var b=this.getCurrentManipulator();return void 0===b.setNode?(osg.log("manipulator has not setNode method"),void 0):(b.setNode(a),void 0)},getControllerList:function(){return this.getCurrentManipulator().getControllerList()},getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(a){this._manipulatorList.push(a),void 0===this._currentManipulator&&this.setManipulatorIndex(0)},getManipulatorList:function(){return this._manipulatorList},setManipulatorIndex:function(a){this._currentManipulator=a},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:function(){var a=this._manipulatorList[this._currentManipulator];return a},reset:function(){this.getCurrentManipulator().reset()},computeHomePosition:function(){var a=this.getCurrentManipulator();void 0!==a&&a.computeHomePosition()},getInverseMatrix:function(){var a=this.getCurrentManipulator();return void 0!==a?a.getInverseMatrix():void 0}},osgDB.ObjectWrapper.serializers.osg={},osgDB.ObjectWrapper.serializers.osg.Object=function(a,b){var c=a.getJSON(),d=function(){return!0};if(d(c)){if(c.Name&&b.setName(c.Name),c.UserDataContainer){var e=a.setJSON(c.UserDataContainer).readUserDataContainer();void 0!==e&&b.setUserData(e)}return b}},osgDB.ObjectWrapper.serializers.osg.Node=function(a,b){var c=a.getJSON(),d=function(){return!0};if(d(c)){osgDB.ObjectWrapper.serializers.osg.Object(a,b);var e=[],f=function(c){var d=a.setJSON(c).readObject(),f=osgDB.Promise.defer();e.push(f.promise),osgDB.Promise.when(d).then(function(a){a&&b.addUpdateCallback(a),f.resolve()})};if(c.UpdateCallbacks)for(var g=0,h=c.UpdateCallbacks.length;h>g;g++)f(c.UpdateCallbacks[g]);if(c.StateSet){var i=a.setJSON(c.StateSet).readObject(),j=osgDB.Promise.defer();e.push(j.promise),osgDB.Promise.when(i).then(function(a){b.setStateSet(a),j.resolve()})}var k=function(c){var d=a.setJSON(c).readObject(),f=osgDB.Promise.defer();e.push(f.promise),osgDB.Promise.when(d).then(function(a){a&&b.addChild(a),f.resolve(a)})};if(c.Children)for(var l=0,m=c.Children.length;m>l;l++)k(c.Children[l]);var n=osgDB.Promise.defer();return osgDB.Promise.all(e).then(function(){n.resolve(b)}),n.promise}},osgDB.ObjectWrapper.serializers.osg.StateSet=function(a,b){var c=a.getJSON(),d=function(){return!0};if(d(c)){osgDB.ObjectWrapper.serializers.osg.Object(a,b),void 0!==c.RenderingHint&&b.setRenderingHint(c.RenderingHint);var e=function(c){var d=a.setJSON(c).readObject(),e=osgDB.Promise.defer();f.push(e.promise),osgDB.Promise.when(d).then(function(a){void 0!==a&&b.setAttributeAndMode(a),e.resolve()})},f=[];if(void 0!==c.AttributeList)for(var g=0,h=c.AttributeList.length;h>g;g++)e(c.AttributeList[g]);var i=function(c,d){var e=a.setJSON(d).readObject(),g=osgDB.Promise.defer();f.push(g.promise),osgDB.Promise.when(e).then(function(a){a&&b.setTextureAttributeAndMode(c,a),g.resolve()})};if(c.TextureAttributeList)for(var j=c.TextureAttributeList,k=0,l=j.length;l>k;k++)for(var m=j[k],n=0,o=m.length;o>n;n++)i(k,m[n]);var p=osgDB.Promise.defer();return osgDB.Promise.all(f).then(function(){p.resolve(b)}),p.promise}},osgDB.ObjectWrapper.serializers.osg.Material=function(a,b){var c=a.getJSON(),d=function(a){return void 0!==a.Diffuse&&void 0!==a.Emission&&void 0!==a.Specular&&void 0!==a.Shininess?!0:!1};return d(c)?(osgDB.ObjectWrapper.serializers.osg.Object(a,b),b.setAmbient(c.Ambient),b.setDiffuse(c.Diffuse),b.setEmission(c.Emission),b.setSpecular(c.Specular),b.setShininess(c.Shininess),b):void 0},osgDB.ObjectWrapper.serializers.osg.BlendFunc=function(a,b){var c=a.getJSON(),d=function(a){return a.SourceRGB&&a.SourceAlpha&&a.DestinationRGB&&a.DestinationAlpha?!0:!1};return d(c)?(osgDB.ObjectWrapper.serializers.osg.Object(a,b),b.setSourceRGB(c.SourceRGB),b.setSourceAlpha(c.SourceAlpha),b.setDestinationRGB(c.DestinationRGB),b.setDestinationAlpha(c.DestinationAlpha),b):void 0},osgDB.ObjectWrapper.serializers.osg.CullFace=function(a,b){var c=a.getJSON(),d=function(a){return void 0!==a.Mode?!0:!1};return d(c)?(osgDB.ObjectWrapper.serializers.osg.Object(a,b),b.setMode(c.Mode),b):void 0},osgDB.ObjectWrapper.serializers.osg.BlendColor=function(a,b){var c=a.getJSON(),d=function(a){return void 0!==a.ConstantColor?!0:!1};return d(c)?(osgDB.ObjectWrapper.serializers.osg.Object(a,b),b.setConstantColor(c.ConstantColor),b):void 0},osgDB.ObjectWrapper.serializers.osg.Light=function(a,b){var c=a.getJSON(),d=function(a){return void 0!==a.LightNum&&void 0!==a.Ambient&&void 0!==a.Diffuse&&void 0!==a.Direction&&void 0!==a.Position&&void 0!==a.Specular&&void 0!==a.SpotCutoff&&void 0!==a.LinearAttenuation&&void 0!==a.ConstantAttenuation&&void 0!==a.QuadraticAttenuation?!0:!1};return d(c)?(osgDB.ObjectWrapper.serializers.osg.Object(a,b),b.setAmbient(c.Ambient),b.setConstantAttenuation(c.ConstantAttenuation),b.setDiffuse(c.Diffuse),b.setDirection(c.Direction),b.setLightNumber(c.LightNum),b.setLinearAttenuation(c.LinearAttenuation),b.setPosition(c.Position),b.setQuadraticAttenuation(c.QuadraticAttenuation),b.setSpecular(c.Specular),b.setSpotCutoff(c.SpotCutoff),b.setSpotBlend(.01),void 0!==c.SpotExponent&&b.setSpotBlend(c.SpotExponent/128),b):void 0},osgDB.ObjectWrapper.serializers.osg.Texture=function(a,b){var c=a.getJSON(),d=function(){return!0};if(d(c)){osgDB.ObjectWrapper.serializers.osg.Object(a,b),void 0!==c.MinFilter&&b.setMinFilter(c.MinFilter),void 0!==c.MagFilter&&b.setMagFilter(c.MagFilter),void 0!==c.WrapT&&b.setWrapT(c.WrapT),void 0!==c.WrapS&&b.setWrapS(c.WrapS);var e=c.File;void 0===e&&(e="no-image-provided");var f=osgDB.Promise.defer();return osgDB.Promise.when(a.readImageURL(e)).then(function(a){b.setImage(a),f.resolve(b)}),f.promise}},osgDB.ObjectWrapper.serializers.osg.Projection=function(a,b){var c=a.getJSON(),d=function(a){return void 0!==a.Matrix?!0:!1};if(d(c)){var e=osgDB.ObjectWrapper.serializers.osg.Node(a,b);return void 0!==c.Matrix&&b.setMatrix(c.Matrix),e}},osgDB.ObjectWrapper.serializers.osg.MatrixTransform=function(a,b){var c=a.getJSON(),d=function(a){return a.Matrix?!0:!1};if(d(c)){var e=osgDB.ObjectWrapper.serializers.osg.Node(a,b);return void 0!==c.Matrix&&b.setMatrix(c.Matrix),e}},osgDB.ObjectWrapper.serializers.osg.LightSource=function(a,b){var c=a.getJSON(),d=function(a){return void 0!==a.Light?!0:!1};if(d(c)){var e=osgDB.Promise.defer(),f=osgDB.ObjectWrapper.serializers.osg.Node(a,b);return osgDB.Promise.all([a.setJSON(c.Light).readObject(),f]).then(function(a){var c=a[0];a[1],b.setLight(c),e.resolve(b)}),e.promise}},osgDB.ObjectWrapper.serializers.osg.Geometry=function(a,b){var c=a.getJSON(),d=function(a){return void 0!==a.PrimitiveSetList&&void 0!==a.VertexAttributeList?!0:!1};if(d(c)){var e=[];e.push(osgDB.ObjectWrapper.serializers.osg.Node(a,b));for(var f=function(c){var d=osgDB.Promise.defer();e.push(d.promise);var f=a.setJSON(c).readPrimitiveSet();osgDB.Promise.when(f).then(function(a){void 0!==a&&b.getPrimitives().push(a),d.resolve(a)})},g=0,h=c.PrimitiveSetList.length;h>g;g++){var i=c.PrimitiveSetList[g];f(i)}var j=function(c,d){var f=osgDB.Promise.defer();e.push(f.promise);var g=a.setJSON(d).readBufferArray();osgDB.Promise.when(g).then(function(a){void 0!==a&&(b.getVertexAttributeList()[c]=a),f.resolve(a)})};for(var k in c.VertexAttributeList)c.VertexAttributeList.hasOwnProperty(k)&&j(k,c.VertexAttributeList[k]);var l=osgDB.Promise.defer();return osgDB.Promise.all(e).then(function(){l.resolve(b)}),l.promise}},osgDB.ObjectWrapper.serializers.osgAnimation={},osgDB.ObjectWrapper.serializers.osgAnimation.Animation=function(a,b){var c=a.getJSON(),d=function(a){return a.Name&&a.Channels&&a.Channels.length>0?!0:a.Name?!1:(osg.log("animation has field Name, error"),!1)};if(d(c)&&osgDB.ObjectWrapper.serializers.osg.Object(a,b)){for(var e=0,f=c.Channels.length;f>e;e++)osgDB.Promise.when(a.setJSON(c.Channels[e]).readObject()).then(function(a){a&&b.getChannels().push(a)});return b}},osgDB.ObjectWrapper.serializers.osgAnimation.Vec3LerpChannel=function(a,b){var c=a.getJSON(),d=function(a){return a.KeyFrames&&a.TargetName&&a.Name?!0:!1};if(d(c)&&osgDB.ObjectWrapper.serializers.osg.Object(a,b)){b.setTargetName(c.TargetName);for(var e=b.getSampler().getKeyframes(),f=0,g=c.KeyFrames.length;g>f;f++){var h=c.KeyFrames[f],i=h.slice(1);i.t=h[0],e.push(i)}return b}},osgDB.ObjectWrapper.serializers.osgAnimation.QuatLerpChannel=function(a,b){return osgDB.ObjectWrapper.serializers.osgAnimation.Vec3LerpChannel(a,b)},osgDB.ObjectWrapper.serializers.osgAnimation.QuatSlerpChannel=function(a,b){return osgDB.ObjectWrapper.serializers.osgAnimation.Vec3LerpChannel(a,b)},osgDB.ObjectWrapper.serializers.osgAnimation.FloatLerpChannel=function(a,b){var c=a.getJSON(),d=function(a){return a.KeyFrames&&a.TargetName&&a.Name?!0:!1};if(d(c)&&osgDB.ObjectWrapper.serializers.osg.Object(a,b)){b.setTargetName(c.TargetName);for(var e=b.getSampler().getKeyframes(),f=0,g=c.KeyFrames.length;g>f;f++){var h=c.KeyFrames[f],i=h.slice(1);i.t=h[0],e.push(i)}return b}},osgDB.ObjectWrapper.serializers.osgAnimation.BasicAnimationManager=function(a,b){var c=a.getJSON(),d=function(a){return a.Animations?!0:!1};if(d(c)){for(var e=0,f=c.Animations.length;f>e;e++){var g=c.Animations[e],h=a.setJSON(g).readObject();h&&b.registerAnimation(h)}return b}},osgDB.ObjectWrapper.serializers.osgAnimation.UpdateMatrixTransform=function(a,b){var c=a.getJSON(),d=function(a){return a.Name&&a.StackedTransforms?!0:!1};if(d(c)&&void 0!==osgDB.ObjectWrapper.serializers.osg.Object(a,b)){for(var e=0,f=c.StackedTransforms.length;f>e;e++){var g=c.StackedTransforms[e],h=a.setJSON(g).readObject();h&&b.getStackedTransforms().push(h)}return b}},osgDB.ObjectWrapper.serializers.osgAnimation.StackedTranslate=function(a,b){var c=a.getJSON(),d=function(a){return a.Name?!0:!1};return d(c)&&osgDB.ObjectWrapper.serializers.osg.Object(a,b)?(c.Translate&&b.setTranslate(c.Translate),b):void 0},osgDB.ObjectWrapper.serializers.osgAnimation.StackedQuaternion=function(a,b){var c=a.getJSON(),d=function(a){return a.Name?!0:!1};return d(c)&&osgDB.ObjectWrapper.serializers.osg.Object(a,b)?(c.Quaternion&&b.setQuaternion(c.Quaternion),b):void 0},osgDB.ObjectWrapper.serializers.osgAnimation.StackedRotateAxis=function(a,b){var c=a.getJSON(),d=function(a){return a.Axis?!0:!1};return d(c)&&osgDB.ObjectWrapper.serializers.osg.Object(a,b)?(c.Angle&&b.setAngle(c.Angle),b.setAxis(c.Axis),b):void 0};
//# sourceMappingURL=build/source-map.js